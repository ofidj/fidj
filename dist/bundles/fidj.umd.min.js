!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common")):"function"==typeof define&&define.amd?define("fidj",["exports","@angular/core","@angular/common"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).fidj={},e.ng.core,e.ng.common)}(this,(function(e,t,n){"use strict";function i(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var i=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var r,o=i(t),s=function(){function e(){}return e.encode=function(e){return e?("undefined"!=typeof window?window.btoa:require("btoa"))(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,(function(e,t){return String.fromCharCode(parseInt("0x"+t,16))}))):null},e.decode=function(e){if(!e)return null;var t="undefined"!=typeof window?window.atob:require("atob");return decodeURIComponent(t(e).split("").map((function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join(""))},e}(),c=function(){function e(e,t){if(this.storageKey=t,this.version="0.1",this.storage=e||window.localStorage,!this.storage)throw new Error("fidj.LocalStorageFactory needs a storageService!")}return e.prototype.set=function(e,t){e=this.storageKey+e,this.checkKey(e);var n=typeof t;if("undefined"===n)t="null";else if(null===t)t="null";else if("string"===n)t=JSON.stringify({string:t});else if("number"===n)t=JSON.stringify({number:t});else if("boolean"===n)t=JSON.stringify({bool:t});else{if("object"!==n)throw new TypeError("Value type "+n+" is invalid. It must be null, undefined, xml, string, number, boolean or object");t=JSON.stringify({json:t})}return this.storage.setItem(e,t),t},e.prototype.get=function(e,t){e=this.storageKey+e,this.checkKey(e);var n=this.storage.getItem(e);if(null!==n){if("null"===n)return null;var i=JSON.parse(n);return"string"in i?i.string:"number"in i?i.number.valueOf():"bool"in i?i.bool.valueOf():i.json}return t||null},e.prototype.remove=function(e){e=this.storageKey+e,this.checkKey(e);var t=null!==this.storage.getItem(e);return this.storage.removeItem(e),t},e.prototype.clear=function(){var e=this.storage.length>0;return this.storage.clear(),e},e.prototype.size=function(){return this.storage.length},e.prototype.foreach=function(e,t){for(var n=this.storage.length,i=0;i<n;i++){var r=this.storage.key(i),o=this.get(r);t?e.call(t,o):e(o)}return n},e.prototype.checkKey=function(e){if(!e||"string"!=typeof e)throw new TypeError("Key type must be string");return!0},e}(),a=function(){function e(){}return e.encrypt=function(t,n){var i="";t=e.header+t;for(var r=0;r<t.length;r++)i+=String.fromCharCode(t[r].charCodeAt(0).toString(10)^e.keyCharAt(n,r));return i=s.encode(i)},e.decrypt=function(t,n,i){var r="";t=s.decode(t);for(var o=0;o<t.length;o++)r+=String.fromCharCode(t[o].charCodeAt(0).toString(10)^e.keyCharAt(n,o));return i||e.header===r.substring(0,e.header.length)?(i||(r=r.substring(e.header.length)),r):null},e.keyCharAt=function(e,t){return e[Math.floor(t%e.length)].charCodeAt(0).toString(10)},e}();a.header="artemis-lotsum",e.LoggerLevelEnum=void 0,(r=e.LoggerLevelEnum||(e.LoggerLevelEnum={}))[r.INFO=1]="INFO",r[r.WARN=2]="WARN",r[r.ERROR=3]="ERROR",r[r.NONE=4]="NONE";var u=function(){function e(e,t){this.code=e,this.reason=t}return e.prototype.equals=function(e){return this.code===e.code&&this.reason===e.reason},e.prototype.toString=function(){var e="string"==typeof this.reason?this.reason:JSON.stringify(this.reason);return this.code+" - "+e},e}(),d=function(){};d.decorators=[{type:t.NgModule,args:[{imports:[n.CommonModule],declarations:[],exports:[]}]}],d.ctorParameters=function(){return[]};function h(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{a(i.next(e))}catch(e){o(e)}}function c(e){try{a(i.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}a((i=i.apply(e,t||[])).next())}))}function l(e,t){var n,i,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}}Object.create;Object.create;var f,p=function(e,t,n){this.id=e,this.type=t,this.data=n},g=function(e,t,n,i){this.username=e,this.accessToken=t,this.idToken=n,this.refreshToken=i},v=function(e,t,n,i){this.id=e,this.username=t,this.roles=n};!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.TIMEOUT=1]="TIMEOUT",e[e.STATUS=2]="STATUS"}(f||(f={}));var y=function(){function e(){this.xhr=require("axios")}return e.formatResponseData=function(e){for(var t=e;t&&t.data;)t=t.data;try{t=JSON.parse(t+"")}catch(e){}return t},e.formatError=function(e){var t={reason:f.UNKNOWN,status:-1,code:-1,message:""};return e.status&&(t.reason=f.STATUS,t.status=parseInt(e.status,10),t.code=parseInt(e.status,10)),e.response?(t.message=e.response,e.response.status?(t.reason=f.STATUS,t.status=parseInt(e.response.status,10),t.code=parseInt(e.response.status,10)):null===e.response.status&&(t.reason=f.TIMEOUT,t.status=408,t.code=408)):e.request?t.message=e.request:e.message&&(t.message=e.message),t},e.prototype.post=function(t){var n={method:"POST",url:t.url,data:JSON.stringify(t.data)};return t.headers&&(n.headers=t.headers),this.xhr.post(n.url,n.data,{headers:n.headers}).then((function(t){return t.status&&(parseInt(t.status,10)<200||parseInt(t.status,10)>=300)?Promise.reject(e.formatError(t)):Promise.resolve(e.formatResponseData(t))})).catch((function(t){return Promise.reject(e.formatError(t))}))},e.prototype.put=function(t){var n={method:"PUT",url:t.url,data:JSON.stringify(t.data)};return t.headers&&(n.headers=t.headers),this.xhr.put(n.url,n.data,{headers:n.headers,timeout:1e4}).then((function(t){return t.status&&(parseInt(t.status,10)<200||parseInt(t.status,10)>=300)?Promise.reject(e.formatError(t)):Promise.resolve(e.formatResponseData(t))})).catch((function(t){return Promise.reject(e.formatError(t))}))},e.prototype.delete=function(t){var n={method:"DELETE",url:t.url,data:JSON.stringify(t.data)};return t.headers&&(n.headers=t.headers),this.xhr.delete(n.url,{headers:n.headers,timeout:1e4}).then((function(t){return t.status&&(parseInt(t.status,10)<200||parseInt(t.status,10)>=300)?Promise.reject(e.formatError(t)):Promise.resolve(e.formatResponseData(t))})).catch((function(t){return Promise.reject(e.formatError(t))}))},e.prototype.get=function(t){var n={method:"GET",url:t.url};return t.data&&(n.data=t.data),t.headers&&(n.headers=t.headers),this.xhr.get(n.url,{headers:n.headers,timeout:1e4}).then((function(t){return t.status&&(parseInt(t.status,10)<200||parseInt(t.status,10)>=300)?Promise.reject(e.formatError(t)):Promise.resolve(e.formatResponseData(t))})).catch((function(t){return Promise.reject(e.formatError(t))}))},e}(),j=function(){function e(t,n,i,r){this.appId=t,this.URI=n,this.storage=i,this.sdk=r;var o=this.storage.get(e._clientUuid)||"uuid-"+Math.random(),s="_clientInfo";"undefined"!=typeof window&&window.navigator&&(s=window.navigator.appName+"@"+window.navigator.appVersion+"-"+window.navigator.userAgent),"undefined"!=typeof window&&window.device&&window.device.uuid&&(o=window.device.uuid),this.setClientUuid(o),this.setClientInfo(s),this.clientId=this.storage.get(e._clientId),e.refreshCount=this.storage.get(e._refreshCount)||e.refreshCountInitial}return e.prototype.setClientId=function(t){this.clientId=""+t,this.storage.set(e._clientId,this.clientId)},e.prototype.setClientUuid=function(t){this.clientUuid=""+t,this.storage.set(e._clientUuid,this.clientUuid)},e.prototype.setClientInfo=function(e){this.clientInfo=""+e},e.prototype.login=function(e,t,n){return h(this,void 0,void 0,(function(){var n,i,r,o,c,a,u;return l(this,(function(d){switch(d.label){case 0:return this.URI?(n=this.URI+"/users",i={name:e,username:e,email:e,password:t},[4,(new y).post({url:n,data:i,headers:{"Content-Type":"application/json",Accept:"application/json"}})]):(console.error("no api uri"),[2,Promise.reject({code:408,reason:"no-api-uri"})]);case 1:return d.sent().user,this.setClientId(e),r=this.URI+"/apps/"+this.appId+"/tokens",o={grant_type:"access_token",client_udid:this.clientUuid,client_info:this.clientInfo,scope:JSON.stringify(this.sdk)},[4,(new y).post({url:r,data:o,headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:"Basic "+s.encode(e+":"+t)}})];case 2:return c=d.sent().token,o.grant_type="id_token",[4,(new y).post({url:r,data:o,headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer "+c.data}})];case 3:return a=d.sent().token,o.grant_type="refresh_token",[4,(new y).post({url:r,data:o,headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer "+c.data}})];case 4:return u=d.sent().token,[2,new g(e,c,a,u)]}}))}))},e.prototype.reAuthenticate=function(t){return h(this,void 0,void 0,(function(){var n,i,r;return l(this,(function(o){switch(o.label){case 0:return this.URI?(n=this.URI+"/apps/"+this.appId+"/tokens",i={grant_type:"refresh_token",client_udid:this.clientUuid,client_info:this.clientInfo,scope:JSON.stringify(this.sdk),refresh_token:t,refreshCount:e.refreshCount},[4,(new y).post({url:n,data:i,headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer "+t}})]):(console.error("no api uri"),[2,Promise.reject({code:408,reason:"no-api-uri"})]);case 1:return r=o.sent(),e.refreshCount++,this.storage.set(e._refreshCount,e.refreshCount),[2,r]}}))}))},e.prototype.logout=function(t){if(!this.URI)return console.error("no api uri"),Promise.reject({code:408,reason:"no-api-uri"});if(this.storage.remove(e._clientId),this.storage.remove(e._refreshCount),e.refreshCount=e.refreshCountInitial,!t||!this.clientId)return Promise.resolve();var n=this.URI+"/apps/"+this.appId+"/tokens";return(new y).delete({url:n,headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer "+t}})},e.prototype.isReady=function(){return!!this.URI},e}();j.refreshCountInitial=1,j.refreshCount=j.refreshCountInitial,j._clientUuid="v2.clientUuid",j._clientId="v2.clientId",j._refreshCount="v2.refreshCount";var m,b=function(){function e(t,n,i){this._sdk=t,this._storage=n,this._logger=i,this.client=null,this.user=null,this.cryptoSalt=this._storage.get(e._cryptoSalt)||null,this.cryptoSaltNext=this._storage.get(e._cryptoSaltNext)||null,this.accessToken=this._storage.get(e._accessToken)||null,this.accessTokenPrevious=this._storage.get("v2.accessTokenPrevious")||null,this.idToken=this._storage.get(e._idToken)||null,this.refreshToken=this._storage.get(e._refreshToken)||null,this.states=this._storage.get(e._states)||{},this.apis=[]}return e.prototype.isReady=function(){return!!this.client&&this.client.isReady()},e.prototype.destroy=function(t){return h(this,void 0,void 0,(function(){return l(this,(function(n){switch(n.label){case 0:return this._storage.remove(e._accessToken),this._storage.remove(e._idToken),this._storage.remove(e._refreshToken),this._storage.remove(e._states),this.accessToken&&(this.accessTokenPrevious=this.accessToken,this._storage.set(e._accessTokenPrevious,this.accessTokenPrevious)),t&&(this._storage.remove(e._cryptoSalt),this._storage.remove(e._cryptoSaltNext),this._storage.remove(e._accessTokenPrevious)),this.user=null,this.client?[4,this.client.logout()]:[3,2];case 1:n.sent(),n.label=2;case 2:return this.accessToken=null,this.idToken=null,this.refreshToken=null,this.states={},[2]}}))}))},e.prototype.setClient=function(e){this.client=e},e.prototype.setUser=function(e){this.user=e,this.client&&this.user.id&&this.client.setClientId(this.user.id)},e.prototype.getUser=function(){return this.user},e.prototype.getClient=function(){return this.client},e.prototype.setCryptoSalt=function(t){this.cryptoSalt!==t&&this.cryptoSaltNext!==t&&(this.cryptoSaltNext=t,this._storage.set(e._cryptoSaltNext,this.cryptoSaltNext)),this.cryptoSalt||this.setCryptoSaltAsVerified()},e.prototype.setCryptoSaltAsVerified=function(){this.cryptoSaltNext&&(this.cryptoSalt=this.cryptoSaltNext,this._storage.set(e._cryptoSalt,this.cryptoSalt)),this.cryptoSaltNext=null,this._storage.remove(e._cryptoSaltNext)},e.prototype.encrypt=function(e){if("string"!=typeof e)e=JSON.stringify(e);else{var t={string:e};e=JSON.stringify(t)}if(this.fidjCrypto&&this.cryptoSalt){var n=this.cryptoSalt;return a.encrypt(e,n)}return e},e.prototype.decrypt=function(e){var t=null;try{if(this.fidjCrypto&&this.cryptoSaltNext){var n=this.cryptoSaltNext;t=a.decrypt(e,n),t=JSON.parse(t)}}catch(e){t=null}try{if(!t&&this.fidjCrypto&&this.cryptoSalt){n=this.cryptoSalt;t=a.decrypt(e,n),t=JSON.parse(t)}}catch(e){t=null}try{if(!t&&this.fidjCrypto&&this.cryptoSalt){n=this.cryptoSalt;t=a.decrypt(e,n,!0),t=JSON.parse(t)}}catch(e){t=null}try{t||(t=JSON.parse(e)),t&&t.string&&(t=t.string)}catch(e){t=null}return t},e.prototype.isLogin=function(){var e=!0;try{var t=this.refreshToken.split(".")[1],n=JSON.parse(s.decode(t));e=(new Date).getTime()/1e3>=n.exp}catch(e){}return!e},e.prototype.logout=function(){return h(this,void 0,void 0,(function(){return l(this,(function(e){return[2,this.getClient().logout(this.refreshToken)]}))}))},e.prototype.getClientId=function(){return this.client?this.client.clientId:null},e.prototype.getIdToken=function(){return h(this,void 0,void 0,(function(){return l(this,(function(e){return[2,this.idToken]}))}))},e.prototype.getIdPayload=function(e){return h(this,void 0,void 0,(function(){var t,n;return l(this,(function(i){switch(i.label){case 0:return[4,this.getIdToken()];case 1:t=i.sent();try{if(n=void 0,t&&(n=t.split(".")[1]),n)return[2,s.decode(n)]}catch(t){this._logger.log("fidj.connection.getIdPayload pb: ",e,t)}return e?("string"!=typeof e&&(e=JSON.stringify(e)),[2,e]):[2,null]}}))}))},e.prototype.getAccessPayload=function(e){return h(this,void 0,void 0,(function(){var t;return l(this,(function(n){e&&"string"!=typeof e&&(e=JSON.stringify(e));try{if(t=this.accessToken.split(".")[1])return[2,s.decode(t)]}catch(e){}return[2,e||null]}))}))},e.prototype.getPreviousAccessPayload=function(e){e&&"string"!=typeof e&&(e=JSON.stringify(e));try{var t=this.accessTokenPrevious.split(".")[1];if(t)return s.decode(t)}catch(e){}return e||null},e.prototype.refreshConnection=function(){return h(this,void 0,void 0,(function(){var t,n,i,r,o,c,a,d;return l(this,(function(h){switch(h.label){case 0:if(this._storage.set(e._states,this.states),this.accessToken&&(n=this.accessToken.split(".")[1],i=s.decode(n),t=(new Date).getTime()/1e3<JSON.parse(i).exp,this._logger.log("fidj.connection.connection.refreshConnection : token not expired ? ",t),t))return[2,Promise.resolve(this.getUser())];if(this.refreshToken&&(n=this.refreshToken.split(".")[1],i=s.decode(n),r=(new Date).getTime()/1e3>=JSON.parse(i).exp,this._logger.log("fidj.connection.connection.refreshConnection : refreshToken not expired ? ",r),r&&this._storage.remove(e._refreshToken)),this.accessTokenPrevious=this.accessToken,this._storage.set("v2.accessTokenPrevious",this.accessTokenPrevious),this._storage.remove(e._accessToken),this._storage.remove(e._idToken),this.accessToken=null,this.idToken=null,this._logger.log("fidj.connection.connection.refreshConnection : refresh authentication."),!this.getClient())throw new u(400,"Need an initialized client.");return[4,this.getClient().reAuthenticate(this.refreshToken)];case 1:return o=h.sent(),c=new p(this.getClientId(),"idToken",this.idToken),a=new p(this.getClientId(),"accessToken",this.accessToken),d=new g(this.getClientId(),c,a,o),[4,this.setConnection(d)];case 2:return h.sent(),[2,this.getUser()]}}))}))},e.prototype.setConnection=function(t){return h(this,void 0,void 0,(function(){var n,i,r,o,s,c,a,u,d,h;return l(this,(function(l){switch(l.label){case 0:return t.accessToken?(this.accessToken=t.accessToken.data,this._storage.set(e._accessToken,this.accessToken),r=(i=JSON).parse,[4,this.getAccessPayload({salt:""})]):[3,2];case 1:(n=r.apply(i,[l.sent()]).salt)&&this.setCryptoSalt(n),l.label=2;case 2:return t.idToken&&(this.idToken=t.idToken.data,this._storage.set(e._idToken,this.idToken)),t.refreshToken&&(this.refreshToken=t.refreshToken.data,this._storage.set(e._refreshToken,this.refreshToken)),this._storage.set(e._states,this.states),s=v.bind,c=[void 0,t.username,t.username],u=(a=JSON).parse,[4,this.getIdPayload({roles:[]})];case 3:return c=c.concat([u.apply(a,[l.sent()]).roles]),h=(d=JSON).parse,[4,this.getIdPayload({message:""})];case 4:return o=new(s.apply(v,c.concat([h.apply(d,[l.sent()]).message]))),this.setUser(o),[2]}}))}))},e.prototype.setConnectionOffline=function(t){return h(this,void 0,void 0,(function(){var n,i,r,o,s,c,a;return l(this,(function(u){switch(u.label){case 0:return t.accessToken&&(this.accessToken=t.accessToken,this._storage.set(e._accessToken,this.accessToken)),t.idToken&&(this.idToken=t.idToken,this._storage.set(e._idToken,this.idToken)),t.refreshToken&&(this.refreshToken=t.refreshToken,this._storage.set(e._refreshToken,this.refreshToken)),n=this.setUser,i=v.bind,r=[void 0,"demo","demo"],s=(o=JSON).parse,[4,this.getIdPayload({roles:[]})];case 1:return r=r.concat([s.apply(o,[u.sent()]).roles]),a=(c=JSON).parse,[4,this.getIdPayload({message:""})];case 2:return n.apply(this,[new(i.apply(v,r.concat([a.apply(c,[u.sent()]).message])))]),[2]}}))}))},e.prototype.getApiEndpoints=function(e){return h(this,void 0,void 0,(function(){var t,n,i,r,o,s,c,a;return l(this,(function(u){switch(u.label){case 0:return t=[{key:"fidj.default",url:"https://api.fidj.ovh/v3",blocked:!1}],n=[],this._sdk.prod||(t=[{key:"fidj.default",url:"http://localhost:3201/v3",blocked:!1},{key:"fidj.default",url:"https://fidj-sandbox.herokuapp.com/v3",blocked:!1}]),this.accessToken?[4,this.getAccessPayload({apis:[]})]:[3,2];case 1:i=u.sent(),(r=JSON.parse(i).apis)&&r.length&&(t=[],r.forEach((function(e){e.url&&t.push(e)}))),u.label=2;case 2:if(this.accessTokenPrevious&&(r=JSON.parse(this.getPreviousAccessPayload({apis:[]})).apis)&&r.length&&r.forEach((function(e){e.url&&0===t.filter((function(t){return t.url===e.url})).length&&t.push(e)})),this._logger.log("fidj.sdk.connection.getApiEndpoints : ",t),o=!0,this.states&&Object.keys(this.states).length)for(c=0;c<t.length&&o;c++)this.states[t[c].url]||(o=!1);else o=!1;if(e&&e.filter)if(o&&"theBestOne"===e.filter)for(c=0;c<t.length&&0===n.length;c++)a=t[c],this.states[a.url]&&this.states[a.url].state&&n.push(a);else if(o&&"theBestOldOne"===e.filter){for(s=void 0,c=0;c<t.length;c++)a=t[c],this.states[a.url]&&this.states[a.url].lastTimeWasOk&&(!s||this.states[a.url].lastTimeWasOk>this.states[s.url].lastTimeWasOk)&&(s=a);s&&n.push(s)}else t.length&&n.push(t[0]);else n=t;return[2,n]}}))}))},e.prototype.getDBs=function(e){return h(this,void 0,void 0,(function(){var t,n,i,r,o,s,c,a;return l(this,(function(u){switch(u.label){case 0:return this.accessToken?(t=Math.random()%2,r=(i=JSON).parse,[4,this.getAccessPayload({dbs:[]})]):[2,[]];case 1:if(n=r.apply(i,[u.sent()]).dbs||[],0===t?n=n.sort():1===t&&(n=n.reverse()),o=[],s=!0,this.states&&Object.keys(this.states).length)for(c=0;c<n.length&&s;c++)this.states[n[c].url]||(s=!1);else s=!1;if(s&&e&&"theBestOne"===e.filter)for(c=0;c<n.length&&0===o.length;c++)a=n[c],this.states[a.url]&&this.states[a.url].state&&o.push(a);else if(s&&e&&"theBestOnes"===e.filter)for(c=0;c<n.length;c++)a=n[c],this.states[a.url]&&this.states[a.url].state&&o.push(a);else e&&"theBestOne"===e.filter&&n.length?o.push(n[0]):o=n;return[2,o]}}))}))},e.prototype.verifyApiState=function(e,t){return h(this,void 0,void 0,(function(){var n,i,r,o;return l(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),this._logger.log("fidj.sdk.connection.verifyApiState : ",e,t),[4,(new y).get({url:t+"/status?isOk="+this._sdk.version,headers:{"Content-Type":"application/json",Accept:"application/json"}})];case 1:return n=s.sent(),i=!1,n&&n.isOk&&(i=!0),this.states[t]={state:i,time:e,lastTimeWasOk:e},this._logger.log("fidj.sdk.connection.verifyApiState > states : ",this.states),[3,3];case 2:return r=s.sent(),o=0,this.states[t]&&(o=this.states[t].lastTimeWasOk),this.states[t]={state:!1,time:e,lastTimeWasOk:o},this._logger.log("fidj.sdk.connection.verifyApiState > catch pb  - states : ",r,this.states),[3,3];case 3:return[2]}}))}))},e.prototype.verifyDbState=function(e,t){return h(this,void 0,void 0,(function(){var n;return l(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,(new y).get({url:t,headers:{"Content-Type":"application/json",Accept:"application/json"}})];case 1:return i.sent(),this.states[t]={state:!0,time:e,lastTimeWasOk:e},[3,3];case 2:return i.sent(),n=0,this.states[t]&&(n=this.states[t].lastTimeWasOk),this.states[t]={state:!1,time:e,lastTimeWasOk:n},[3,3];case 3:return[2]}}))}))},e.prototype.verifyConnectionStates=function(){return h(this,void 0,void 0,(function(){var e,t,n,i=this;return l(this,(function(r){switch(r.label){case 0:return e=(new Date).getTime(),t=[],n=this,[4,this.getApiEndpoints()];case 1:return n.apis=r.sent(),this.apis.forEach((function(n){var r=n.url;r||(r=n.toString()),t.push(i.verifyApiState(e,r))})),[4,this.getDBs()];case 2:return r.sent().forEach((function(n){var r=n.url;r||(r=n.toString()),t.push(i.verifyDbState(e,r))})),[2,Promise.all(t)]}}))}))},e}();if(b._accessToken="v2.accessToken",b._accessTokenPrevious="v2.accessTokenPrevious",b._idToken="v2.idToken",b._refreshToken="v2.refreshToken",b._states="v2.states",b._cryptoSalt="v2.cryptoSalt",b._cryptoSaltNext="v2.cryptoSalt.next","undefined"!=typeof window){m=window.PouchDB?window.PouchDB:require("pouchdb").default;var k=require("pouchdb-adapter-cordova-sqlite");m.plugin(k)}var w=function(){function e(){this.db=null,this.dbRecordCount=0,this.dbLastSync=null,this.remoteDb=null,this.dbs=[]}return e.prototype.isReady=function(){return!!this.db},e.prototype.create=function(e,t){var n=this;return!t&&this.db?Promise.resolve(this.db):(this.dbRecordCount=0,this.dbLastSync=null,this.db=null,e=e||"default","undefined"==typeof window?Promise.resolve(this.db):new Promise((function(t,i){var r={location:"default"};try{window.cordova&&(r={location:"default",adapter:"cordova-sqlite"}),n.db=new m("fidj_db_"+e,r),n.db.info().then((function(e){return t(n.db)})).catch((function(e){i(new u(400,e))}))}catch(e){i(new u(500,e))}})))},e.prototype.destroy=function(){return h(this,void 0,void 0,(function(){var e=this;return l(this,(function(t){return this.db?this.db&&!this.db.destroy?[2,Promise.reject(new u(408,"Need a valid db"))]:[2,new Promise((function(t,n){e.db.destroy((function(i,r){i?n(new u(500,i)):(e.dbRecordCount=0,e.dbLastSync=null,e.db=null,t())}))}))]:(this.dbRecordCount=0,this.dbLastSync=null,[2])}))}))},e.prototype.setRemote=function(e){this.dbs=e},e.prototype.sync=function(e){var t=this;return this.db?this.dbs&&this.dbs.length?new Promise((function(n,i){try{t.remoteDb&&t.remoteUri===t.dbs[0].url||(t.remoteUri=t.dbs[0].url,t.remoteDb=new m(t.remoteUri)),t.db.replicate.to(t.remoteDb).on("complete",(function(r){return t.remoteDb.replicate.to(t.db,{filter:function(t){return!!e&&!!t&&t.fidjUserId===e}}).on("complete",(function(){n()})).on("denied",(function(e){return i({code:403,reason:{second:e}})})).on("error",(function(e){return i({code:401,reason:{second:e}})}))})).on("denied",(function(e){return i({code:403,reason:{first:e}})})).on("error",(function(e){return i({code:401,reason:{first:e}})}))}catch(e){i(new u(500,e))}})):Promise.reject(new u(408,"need a remote db")):Promise.reject(new u(408,"need db"))},e.prototype.put=function(t,n,i,r,o,s){var c=this;if(!this.db)return Promise.reject(new u(408,"need db"));if(!(t&&n&&i&&r&&o))return Promise.reject(new u(400,"need formated data"));var a=JSON.parse(JSON.stringify(t)),d={_id:n,fidjUserId:i,fidjOrgId:r,fidjAppVersion:o};a._rev&&(d._rev=""+a._rev),delete a._id,delete a._rev,delete a.fidjUserId,delete a.fidjOrgId,delete a.fidjAppVersion,delete a.fidjData;var h=e.write(e.value(a));return s?(h=s.obj[s.method](h),d.fidjDacr=h):d.fidjData=h,new Promise((function(e,n){c.db.put(d,(function(i,r){r&&r.ok&&r.id&&r.rev?(c.dbRecordCount++,"object"==typeof t?(t._rev=r.rev,t._id=r.id,e(t)):e(r.id)):n(new u(500,i))}))}))},e.prototype.remove=function(e){var t=this;return this.db?new Promise((function(n,i){t.db.get(e).then((function(e){return e._deleted=!0,t.db.put(e)})).then((function(e){n()})).catch((function(e){i(e)}))})):Promise.reject(new u(408,"need db"))},e.prototype.get=function(t,n){var i=this;return this.db?new Promise((function(r,o){i.db.get(t).then((function(t){if(t&&(t.fidjDacr||t.fidjData)){var s=t.fidjDacr;n&&s?s=n.obj[n.method](s):t.fidjData&&(s=JSON.parse(t.fidjData));var c=e.extractJson(s);c?(c._id=t._id,c._rev=t._rev,r(JSON.parse(JSON.stringify(c)))):(i.remove(t._id),o(new u(400,"Bad encoding")))}else o(new u(400,"No data found"))})).catch((function(e){return o(new u(500,e))}))})):Promise.reject(new u(408,"Need db"))},e.prototype.getAll=function(t){var n=this;return this.db&&this.db.allDocs?new Promise((function(i,r){n.db.allDocs({include_docs:!0,descending:!0}).then((function(r){var o=[];r.rows.forEach((function(i){if(i&&i.doc._id&&(i.doc.fidjDacr||i.doc.fidjData)){var r=i.doc.fidjDacr;t&&r?r=t.obj[t.method](r):i.doc.fidjData&&(r=JSON.parse(i.doc.fidjData));var s=e.extractJson(r);s?(s._id=i.doc._id,s._rev=i.doc._rev,o.push(JSON.parse(JSON.stringify(s)))):(console.error("Bad encoding : delete row"),n.remove(i.doc._id))}else console.error("Bad encoding")})),i(o)})).catch((function(e){return r(new u(400,e))}))})):Promise.reject(new u(408,"Need a valid db"))},e.prototype.isEmpty=function(){var e=this;return this.db&&this.db.allDocs?new Promise((function(t,n){e.db.allDocs({}).then((function(i){i?(e.dbRecordCount=i.total_rows,i.total_rows&&i.total_rows>0?t(!1):t(!0)):n(new u(400,"No response"))})).catch((function(e){return n(new u(400,e))}))})):Promise.reject(new u(408,"No db"))},e.prototype.info=function(){return this.db?this.db.info():Promise.reject(new u(408,"No db"))},e.write=function(e){var t="null",n=typeof e;return"undefined"===n||null===t?t="null":"string"===n?t=JSON.stringify({string:e}):"number"===n?t=JSON.stringify({number:e}):"boolean"===n?t=JSON.stringify({bool:e}):"object"===n&&(t=JSON.stringify({json:e})),t},e.value=function(e){var t=e;return"object"!=typeof e||("string"in e?t=e.string:"number"in e?t=e.number.valueOf():"bool"in e?t=e.bool.valueOf():"json"in e&&"object"!=typeof(t=e.json)&&(t=JSON.parse(t))),t},e.extractJson=function(e){var t=e;return e?("object"==typeof e&&"json"in e&&(t=e.json),"string"==typeof t&&(t=JSON.parse(t)),"object"==typeof t&&"json"in t&&(t=t.json),"object"!=typeof t&&(t=null),t):null},e}(),S=function(){function t(t){this.level=t,t||(this.level=e.LoggerLevelEnum.ERROR),"undefined"==typeof console&&(this.level=e.LoggerLevelEnum.NONE)}return t.prototype.log=function(t,n){this.level===e.LoggerLevelEnum.INFO&&console.log(t,n)},t.prototype.warn=function(t,n){this.level!==e.LoggerLevelEnum.INFO&&this.level!==e.LoggerLevelEnum.WARN||console.warn(t,n)},t.prototype.error=function(t,n){this.level!==e.LoggerLevelEnum.INFO&&this.level!==e.LoggerLevelEnum.WARN&&this.level!==e.LoggerLevelEnum.ERROR||console.error(t,n)},t.prototype.setLevel=function(e){this.level=e},t}(),_=require("url-join"),T=function(){function t(e,t,n){var i;this.sdk={org:"fidj",version:"3.3.6",prod:!1,useDB:!0},t&&(this.promise=t),this.logger=e||new S,n&&n.logLevel&&this.logger.setLevel(n.logLevel),this.logger.log("fidj.sdk.service : constructor"),"undefined"!=typeof window?i=window.localStorage:"undefined"!=typeof global&&(require("localstorage-polyfill"),i=global.localStorage),this.storage=new c(i,"fidj."),this.session=new w,this.connection=new b(this.sdk,this.storage,this.logger)}return t.prototype.fidjInit=function(t,n){return h(this,void 0,void 0,(function(){var i,r,o,s,c,a;return l(this,(function(d){switch(d.label){case 0:if(n&&n.logLevel?this.logger.setLevel(n.logLevel):this.logger.setLevel(e.LoggerLevelEnum.NONE),this.logger.log("fidj.sdk.service.fidjInit : ",n),!t)return this.logger.error("fidj.sdk.service.fidjInit : bad init"),[2,this.promise.reject(new u(400,"Need a fidjId"))];this.sdk.prod=!n||n.prod,this.sdk.useDB=!!n&&n.useDB,this.connection.fidjId=t,this.connection.fidjVersion=this.sdk.version,this.connection.fidjCrypto=!(!n||!n.hasOwnProperty("crypto"))&&n.crypto,d.label=1;case 1:return d.trys.push([1,5,,6]),[4,this.connection.verifyConnectionStates()];case 2:return d.sent(),[4,this.connection.getApiEndpoints({filter:"theBestOne"})];case 3:return i=d.sent(),[4,this.connection.getApiEndpoints({filter:"theBestOldOne"})];case 4:return r=d.sent(),[3,6];case 5:throw o=d.sent(),this.logger.error("fidj.sdk.service.fidjInit: ",o),new u(500,o.toString());case 6:if(!i||!r||0===i.length&&0===r.length)throw new u(404,"Need one connection - or too old SDK version (check update)");return s=i[0],c=r[0],a=this.fidjIsLogin(),this.logger.log("fidj.sdk.service.fidjInit > verifyConnectionStates : ",s,c,a),s?this.connection.setClient(new j(this.connection.fidjId,s.url,this.storage,this.sdk)):this.connection.setClient(new j(this.connection.fidjId,c.url,this.storage,this.sdk)),[2]}}))}))},t.prototype.fidjLogin=function(e,t){return h(this,void 0,void 0,(function(){var n,i,r;return l(this,(function(o){switch(o.label){case 0:if(this.logger.log("fidj.sdk.service.fidjLogin"),!this.connection.isReady())throw new u(404,"Need an initialized FidjService");o.label=1;case 1:return o.trys.push([1,7,,8]),[4,this._removeAll()];case 2:return o.sent(),[4,this.connection.verifyConnectionStates()];case 3:return o.sent(),[4,this._createSession(this.connection.fidjId)];case 4:return o.sent(),[4,this._loginInternal(e,t)];case 5:return n=o.sent(),[4,this.connection.setConnection(n)];case 6:return o.sent(),[3,8];case 7:throw i=o.sent(),new u(500,i.toString());case 8:if(!this.sdk.useDB)return[2,this.connection.getUser()];o.label=9;case 9:return o.trys.push([9,11,,12]),[4,this.session.sync(this.connection.getClientId())];case 10:return o.sent(),[3,12];case 11:return r=o.sent(),this.logger.warn("fidj.sdk.service.fidjLogin: sync -not blocking- issue  ",r.toString()),[3,12];case 12:return[2,this.connection.getUser()]}}))}))},t.prototype.fidjLoginInDemoMode=function(e){return h(this,void 0,void 0,(function(){var t,n,i,r,o,c,a=this;return l(this,(function(u){return t=this,e&&e.accessToken||((n=new Date).setDate(n.getDate()+1),i=n.getTime(),r=s.encode(JSON.stringify({roles:[],message:"demo",apis:[],endpoints:[],dbs:[],exp:i})),o=s.encode(JSON.stringify({})),e={accessToken:c=o+"."+r+"."+o,idToken:c,refreshToken:c}),[2,new t.promise((function(n,i){t._removeAll().then((function(){return t._createSession(t.connection.fidjId)})).then((function(){return h(a,void 0,void 0,(function(){return l(this,(function(i){switch(i.label){case 0:return[4,t.connection.setConnectionOffline(e)];case 1:return i.sent(),n(t.connection.getUser()),[2]}}))}))})).catch((function(e){t.logger.error("fidj.sdk.service.fidjLoginInDemoMode error: ",e),i(e)}))}))]}))}))},t.prototype.fidjIsLogin=function(){return this.connection.isLogin()},t.prototype.fidjGetEndpoints=function(e){return h(this,void 0,void 0,(function(){var t,n;return l(this,(function(i){switch(i.label){case 0:return e||(e={showBlocked:!1}),[4,this.connection.getAccessPayload({endpoints:[]})];case 1:return t=i.sent(),(n=JSON.parse(t).endpoints)&&Array.isArray(n)?[2,n=n.filter((function(t){var n=!0;return n&&e.key&&(n=t.key===e.key),n&&!e.showBlocked&&(n=!t.blocked),n}))]:[2,[]]}}))}))},t.prototype.fidjRoles=function(){return h(this,void 0,void 0,(function(){var e,t;return l(this,(function(n){switch(n.label){case 0:return t=(e=JSON).parse,[4,this.connection.getIdPayload({roles:[]})];case 1:return[2,t.apply(e,[n.sent()]).roles]}}))}))},t.prototype.fidjMessage=function(){return h(this,void 0,void 0,(function(){var e,t;return l(this,(function(n){switch(n.label){case 0:return t=(e=JSON).parse,[4,this.connection.getIdPayload({message:""})];case 1:return[2,t.apply(e,[n.sent()]).message]}}))}))},t.prototype.fidjLogout=function(e){return h(this,void 0,void 0,(function(){var t,n=this;return l(this,(function(i){return(t=this).connection.getClient()||e?[2,t.connection.logout().then((function(){return t._removeAll()})).catch((function(){return t._removeAll()})).then((function(){return n.session.create(t.connection.fidjId,!0)}))]:[2,t._removeAll().then((function(){return n.session.create(t.connection.fidjId,!0)}))]}))}))},t.prototype.fidjSync=function(e,t){return h(this,void 0,void 0,(function(){var n,i,r=this;return l(this,(function(o){return(n=this).logger.log("fidj.sdk.service.fidjSync"),n.sdk.useDB?(i=null===n.session.dbLastSync,[2,new n.promise((function(o,s){n._createSession(n.connection.fidjId).then((function(){return n.session.sync(n.connection.getClientId())})).then((function(){return n.logger.log("fidj.sdk.service.fidjSync resolved"),n.session.isEmpty()})).catch((function(e){return n.logger.warn("fidj.sdk.service.fidjSync warn: ",e),n.session.isEmpty()})).then((function(r){return n.logger.log("fidj.sdk.service.fidjSync isEmpty : ",r,i),new n.promise((function(o,c){if(r&&i&&e){var a=e(t);a&&a.catch instanceof Function&&a.then(o).catch(s),"string"==typeof a&&n.logger.log(a)}o()}))})).then((function(e){return n.logger.log("fidj.sdk.service.fidjSync fnInitFirstData resolved: ",e),n.session.dbLastSync=(new Date).getTime(),n.session.info()})).then((function(e){return n.session.dbRecordCount=0,e&&e.doc_count&&(n.session.dbRecordCount=e.doc_count),n.logger.log("fidj.sdk.service.fidjSync _dbRecordCount : "+n.session.dbRecordCount),n.connection.refreshConnection()})).then((function(e){n.logger.log("fidj.sdk.service.fidjSync refreshConnection done : ",e),o()})).catch((function(e){if(n.logger.warn("fidj.sdk.service.fidjSync refreshConnection failed : ",e),!e||403!==e.code&&410!==e.code)if(e&&e.code)o();else{var t="Error during synchronisation: "+e.toString();n.logger.error(t),s({code:500,reason:t})}else r.fidjLogout().then((function(){s({code:403,reason:"Synchronization unauthorized : need to login again."})})).catch((function(){s({code:403,reason:"Synchronization unauthorized : need to login again.."})}))}))}))]):(n.logger.log("fidj.sdk.service.fidjSync: you ar not using DB - no sync available."),[2,Promise.resolve()])}))}))},t.prototype.fidjPutInDb=function(e){return h(this,void 0,void 0,(function(){var t,n,i;return l(this,(function(r){return(t=this).logger.log("fidj.sdk.service.fidjPutInDb: ",e),t.sdk.useDB?t.connection.getClientId()?t.session.isReady()?(e&&"object"==typeof e&&Object.keys(e).indexOf("_id")&&(n=e._id),n||(n=t._generateObjectUniqueId(t.connection.fidjId)),t.connection.fidjCrypto&&(i={obj:t.connection,method:"encrypt"}),[2,t.session.put(e,n,t.connection.getClientId(),t.sdk.org,t.connection.fidjVersion,i)]):[2,t.promise.reject(new u(400,"Need to be synchronised."))]:[2,t.promise.reject(new u(401,"DB put impossible. Need a user logged in."))]:(t.logger.log("fidj.sdk.service.fidjPutInDb: you are not using DB - no put available."),[2,Promise.resolve("NA")])}))}))},t.prototype.fidjRemoveInDb=function(e){return h(this,void 0,void 0,(function(){var t;return l(this,(function(n){return(t=this).logger.log("fidj.sdk.service.fidjRemoveInDb ",e),t.sdk.useDB?t.session.isReady()?e&&"string"==typeof e?[2,t.session.remove(e)]:[2,t.promise.reject(new u(400,"DB remove impossible. Need the data._id."))]:[2,t.promise.reject(new u(400,"Need to be synchronised."))]:(t.logger.log("fidj.sdk.service.fidjRemoveInDb: you are not using DB - no remove available."),[2,Promise.resolve()])}))}))},t.prototype.fidjFindInDb=function(e){return h(this,void 0,void 0,(function(){var t,n;return l(this,(function(i){return(t=this).sdk.useDB?t.connection.getClientId()?t.session.isReady()?(t.connection.fidjCrypto&&(n={obj:t.connection,method:"decrypt"}),[2,t.session.get(e,n)]):[2,t.promise.reject(new u(400," Need to be synchronised."))]:[2,t.promise.reject(new u(401,"Find pb : need a user logged in."))]:(t.logger.log("fidj.sdk.service.fidjFindInDb: you are not using DB - no find available."),[2,Promise.resolve()])}))}))},t.prototype.fidjFindAllInDb=function(){return h(this,void 0,void 0,(function(){var e,t;return l(this,(function(n){return(e=this).sdk.useDB?e.connection.getClientId()?e.session.isReady()?(e.connection.fidjCrypto&&(t={obj:e.connection,method:"decrypt"}),[2,e.session.getAll(t).then((function(t){return e.connection.setCryptoSaltAsVerified(),e.promise.resolve(t)}))]):[2,e.promise.reject(new u(400,"Need to be synchronised."))]:[2,e.promise.reject(new u(401,"Need a user logged in."))]:(e.logger.log("fidj.sdk.service.fidjFindAllInDb: you are not using DB - no find available."),[2,Promise.resolve([])])}))}))},t.prototype.fidjSendOnEndpoint=function(e){return h(this,void 0,void 0,(function(){var t,n,i,r,o,s;return l(this,(function(c){switch(c.label){case 0:return t=e.key?{key:e.key}:null,[4,this.fidjGetEndpoints(t)];case 1:if(!(n=c.sent())||1!==n.length)throw new u(400,"fidj.sdk.service.fidjSendOnEndpoint : endpoint does not exist.");return i=n[0].url,e.relativePath&&(i=_(i,e.relativePath)),[4,this.connection.getIdToken()];case 2:switch(r=c.sent(),s=new y,e.verb){case"POST":o=s.post({url:i,headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer "+r},data:e.data?e.data:{}});break;case"PUT":o=s.put({url:i,headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer "+r},data:e.data?e.data:{}});break;case"DELETE":o=s.delete({url:i,headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer "+r}});break;default:o=s.get({url:i,headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer "+r}})}return[2,o]}}))}))},t.prototype.fidjForgotPasswordRequest=function(e){return h(this,void 0,void 0,(function(){var t;return l(this,(function(n){switch(n.label){case 0:return[4,this.connection.getApiEndpoints({filter:"theBestOne"})];case 1:if(!(t=n.sent())||1!==t.length)throw new u(400,"fidj.sdk.service.fidjForgotPasswordRequest : api endpoint does not exist.");return[4,(new y).post({url:t[0].url+"/me/forgot",headers:{"Content-Type":"application/json",Accept:"application/json"},data:{email:e}})];case 2:return n.sent(),[2]}}))}))},t.prototype.fidjGetIdToken=function(){return h(this,void 0,void 0,(function(){return l(this,(function(e){return[2,this.connection.getIdToken()]}))}))},t.prototype._loginInternal=function(e,t,n){return h(this,void 0,void 0,(function(){var i;return l(this,(function(r){switch(r.label){case 0:if(this.logger.log("fidj.sdk.service._loginInternal"),!this.connection.isReady())throw new u(403,"Need an initialized FidjService");return[4,this.connection.logout()];case 1:r.sent(),r.label=2;case 2:return r.trys.push([2,3,,5]),i=this.connection.getClient().login(e,t,n),[3,5];case 3:return r.sent(),[4,this.connection.getClient().login(e,t,n)];case 4:return i=r.sent(),[3,5];case 5:return[2,i]}}))}))},t.prototype._removeAll=function(){return h(this,void 0,void 0,(function(){return l(this,(function(e){switch(e.label){case 0:return[4,this.connection.destroy()];case 1:return e.sent(),[4,this.session.destroy()];case 2:return e.sent(),[2]}}))}))},t.prototype._createSession=function(e){return h(this,void 0,void 0,(function(){var t;return l(this,(function(n){switch(n.label){case 0:return[4,this.connection.getDBs({filter:"theBestOnes"})];case 1:return(t=n.sent())&&0!==t.length||this.logger.warn("Seems that you are in Demo mode or using Node (no remote DB)."),this.session.setRemote(t),[2,this.session.create(e)]}}))}))},t.prototype._testPromise=function(e){return h(this,void 0,void 0,(function(){return l(this,(function(t){return e?[2,this.promise.resolve("test promise ok "+e)]:[2,new this.promise((function(e,t){e("test promise ok")}))]}))}))},t.prototype._generateObjectUniqueId=function(e,n,i){var r=new Date,o=""+r.getFullYear()+r.getMonth()+r.getDate()+r.getHours()+r.getMinutes(),s=++t._srvDataUniqId,c="";return e&&e.charAt(0)&&(c+=e.charAt(0)+""),n&&n.length>3&&(c+=n.substring(0,4)),i&&i.length>3&&(c+=i.substring(0,4)),c+=o+""+s},t}();T._srvDataUniqId=0;var I=function(){function t(){this.logger=new S(e.LoggerLevelEnum.ERROR),this.promise=Promise,this.fidjService=null}return t.prototype.init=function(e,t){return h(this,void 0,void 0,(function(){return l(this,(function(n){return this.fidjService||(this.fidjService=new T(this.logger,this.promise)),[2,this.fidjService.fidjInit(e,t)]}))}))},t.prototype.login=function(e,t){return h(this,void 0,void 0,(function(){return l(this,(function(n){return this.fidjService?[2,this.fidjService.fidjLogin(e,t)]:[2,this.promise.reject(new u(303,"fidj.sdk.angular.login : not initialized."))]}))}))},t.prototype.loginAsDemo=function(e){return h(this,void 0,void 0,(function(){return l(this,(function(t){return this.fidjService?[2,this.fidjService.fidjLoginInDemoMode(e)]:[2,this.promise.reject(new u(303,"fidj.sdk.angular.loginAsDemo : not initialized."))]}))}))},t.prototype.isLoggedIn=function(){return!!this.fidjService&&this.fidjService.fidjIsLogin()},t.prototype.getRoles=function(){return h(this,void 0,void 0,(function(){return l(this,(function(e){switch(e.label){case 0:return this.fidjService?[4,this.fidjService.fidjRoles()]:[2,[]];case 1:return[2,e.sent()]}}))}))},t.prototype.getEndpoints=function(){return h(this,void 0,void 0,(function(){return l(this,(function(e){return this.fidjService?[2,this.fidjService.fidjGetEndpoints()]:[2,[]]}))}))},t.prototype.sendOnEndpoint=function(e){return h(this,void 0,void 0,(function(){return l(this,(function(t){return this.fidjService?[2,this.fidjService.fidjSendOnEndpoint(e)]:[2,this.promise.reject(new u(303,"fidj.sdk.angular.loginAsDemo : not initialized."))]}))}))},t.prototype.forgotPasswordRequest=function(e){return h(this,void 0,void 0,(function(){return l(this,(function(t){return this.fidjService?[2,this.fidjService.fidjForgotPasswordRequest(e)]:[2,this.promise.reject(new u(303,"fidj.sdk.angular.loginAsDemo : not initialized."))]}))}))},t.prototype.getIdToken=function(){return h(this,void 0,void 0,(function(){return l(this,(function(e){return this.fidjService?[2,this.fidjService.fidjGetIdToken()]:[2]}))}))},t.prototype.getMessage=function(){return h(this,void 0,void 0,(function(){return l(this,(function(e){return this.fidjService?[2,this.fidjService.fidjMessage()]:[2,""]}))}))},t.prototype.logout=function(e){return h(this,void 0,void 0,(function(){return l(this,(function(t){return e||!this.fidjService?[2,this.promise.reject(new u(303,"fidj.sdk.angular.logout : not initialized."))]:[2,this.fidjService.fidjLogout(e)]}))}))},t.prototype.sync=function(e){return h(this,void 0,void 0,(function(){return l(this,(function(t){return this.fidjService?[2,this.fidjService.fidjSync(e,this)]:[2,this.promise.reject(new u(401,"fidj.sdk.angular.sync : not initialized."))]}))}))},t.prototype.put=function(e){return h(this,void 0,void 0,(function(){return l(this,(function(t){return this.fidjService?[2,this.fidjService.fidjPutInDb(e)]:[2,this.promise.reject(new u(401,"fidj.sdk.angular.put : not initialized."))]}))}))},t.prototype.remove=function(e){return h(this,void 0,void 0,(function(){return l(this,(function(t){return this.fidjService?[2,this.fidjService.fidjRemoveInDb(e)]:[2,this.promise.reject(new u(401,"fidj.sdk.angular.remove : not initialized."))]}))}))},t.prototype.find=function(e){return h(this,void 0,void 0,(function(){return l(this,(function(t){return this.fidjService?[2,this.fidjService.fidjFindInDb(e)]:[2,this.promise.reject(new u(401,"fidj.sdk.angular.find : not initialized."))]}))}))},t.prototype.findAll=function(){return h(this,void 0,void 0,(function(){return l(this,(function(e){return this.fidjService?[2,this.fidjService.fidjFindAllInDb()]:[2,this.promise.reject(new u(401,"fidj.sdk.angular.findAll : not initialized."))]}))}))},t}();I.ɵprov=o.ɵɵdefineInjectable({factory:function(){return new I},token:I,providedIn:"root"}),I.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],I.ctorParameters=function(){return[]},e.Base64=s,e.Error=u,e.FidjModule=d,e.FidjService=I,e.LocalStorage=c,e.Xor=a,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=fidj.umd.min.js.map