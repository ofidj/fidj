{"version":3,"sources":["ng://fidj/tools/base64.ts","ng://fidj/tools/storage.ts","ng://fidj/tools/xor.ts","ng://fidj/sdk/interfaces.ts","ng://fidj/version/index.ts","ng://fidj/connection/xhrpromise.ts","ng://fidj/connection/ajax.ts","ng://fidj/connection/client.ts","ng://fidj/sdk/error.ts","ng://fidj/connection/connection.ts","ng://fidj/session/session.ts","ng://fidj/sdk/internal.service.ts","ng://fidj/sdk/angular.service.ts","ng://fidj/sdk/fidj.module.ts"],"names":["Base64","encode","input","btoa","encodeURIComponent","replace","match","p1","String","fromCharCode","parseInt","decode","decodeURIComponent","atob","split","map","c","charCodeAt","toString","slice","join","LocalStorage","storageService","storageKey","this","storage","window","localStorage","Error","prototype","set","key","value","checkKey","t","JSON","stringify","string","number","bool","TypeError","json","setItem","get","def","item","getItem","parse","valueOf","remove","existed","removeItem","clear","length","size","foreach","f","context","n","i","call","Xor","encrypt","result","header","keyCharAt","decrypt","oldStyle","substring","Math","floor","LOG","WARN","ERROR","NONE","XHRPromise","send","options","defaults","_this","method","data","headers","async","username","password","withCredentials","Object","assign","Promise","resolve","reject","e","ref","xhr","XMLHttpRequest","url","_xhr","onload","responseText","_detachWindowUnload","_getResponseText","_error","_handleError","_getResponseUrl","status","statusText","_getHeaders","onerror","ontimeout","onabort","_attachWindowUnload","open","DEFAULT_CONTENT_TYPE","hasOwnProperty","setRequestHeader","getXHR","_unloadHandler","_handleWindowUnload","bind","attachEvent","detachEvent","_parseHeaders","getAllResponseHeaders","getResponseHeader","responseURL","test","reason","code","abort","trim","str","isArray","arg","forEach","list","iterator","forEachArray","forEachString","forEachObject","array","len","charAt","object","k","row","index","indexOf","_this_1","toLowerCase","push","Ajax","post","args","opt","then","res","catch","err","put","delete","Client","appId","URI","sdk","uuid","_clientUuid","random","info","navigator","appName","appVersion","userAgent","setClientUuid","setClientInfo","clientId","_clientId","refreshCount","_refreshCount","setClientId","clientUuid","clientInfo","login","updateProperties","console","error","urlLogin","dataLogin","name","email","Content-Type","Accept","createdUser","_id","urlToken","dataToken","grant_type","client_id","client_secret","client_udid","client_info","audience","scope","reAuthenticate","refreshToken","refresh_token","refresh_extra","obj","logout","token","isReady","equals","msg","Connection","_sdk","_storage","client","user","cryptoSalt","_cryptoSalt","cryptoSaltNext","_cryptoSaltNext","accessToken","_accessToken","accessTokenPrevious","idToken","_idToken","_refreshToken","states","_states","apis","destroy","force","_accessTokenPrevious","setClient","_name","getIdPayload","setUser","getUser","getClient","setCryptoSalt","setCryptoSaltAsVerified","dataAsObj","fidjCrypto","decrypted","isLogin","exp","payload","decoded","Date","getTime","getClientId","getIdToken","getAccessPayload","getPreviousAccessPayload","refreshConnection","setConnection","clientUser","access_token","salt","id_token","roles","message","setConnectionOffline","getApiEndpoints","ea","blocked","filteredEa","prod","apiEndpoints","val","endpoint","filter","r","couldCheckStates","keys","state","bestOldOne","lastTimeWasOk","getDBs","dbs","sort","reverse","filteredDBs","verifyConnectionStates","currentTime","promises","endpointObj","endpointUrl","version","isok","time","dbEndpointObj","dbEndpoint","all","FidjPouch","require","default","PouchAdapterCordovaSqlite","plugin","Session","db","dbRecordCount","dbLastSync","remoteDb","create","uid","opts","location","adapter","setRemote","sync","userId","remoteUri","replicate","to","on","doc","fidjUserId","second","first","oid","ave","crypto","dataWithoutIds","toStore","fidjOrgId","fidjAppVersion","_rev","fidjData","resultAsString","write","fidjDacr","response","ok","id","rev","data_id","_deleted","resultAsJson","extractJson","getAll","allDocs","include_docs","descending","rows","isEmpty","total_rows","InternalService","logger","promise","org","LoggerService","log","tools.LocalStorage","session","session.Session","connection","connection.Connection","fidjInit","fidjId","self","logLevel","setLevel","fidjVersion","theBestUrl","theBestOldUrl","fidjIsLogin","connection.Client","fidjLogin","_removeAll","_createSession","_loginInternal","fidjLoginInDemoMode","now","setDate","getDate","tomorrow","tools.Base64","endpoints","jwtSign","fidjGetEndpoints","showBlocked","fidjRoles","fidjMessage","fidjLogout","fidjSync","fnInitFirstData","fnInitFirstData_Arg","firstSync","warn","resolveEmpty","rejectEmptyNotUsed","ret","Function","doc_count","errMessage","fidjPutInDb","_generateObjectUniqueId","fidjRemoveInDb","fidjFindInDb","fidjFindAllInDb","results","fidjPostOnEndpoint","jwt","Authorization","fidjGetIdToken","loginUser","_testPromise","a","type","simpleDate","getFullYear","getMonth","getHours","getMinutes","sequId","_srvDataUniqId","UId","FidjService","fidjService","init","FidjError","loginAsDemo","isLoggedIn","getRoles","getEndpoints","postOnEndpoint","getMessage","find","findAll","Injectable","level","LoggerLevelEnum","FidjModule","NgModule","imports","CommonModule","declarations","exports","providers"],"mappings":"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","sourcesContent":["export class Base64 {\n\n    constructor() {\n    };\n\n    /**\n     * Decodes string from Base64 string\n     */\n    public static encode(input: string): string {\n\n        if (!input) {\n            return null;\n        }\n\n        return btoa(encodeURIComponent(input).replace(/%([0-9A-F]{2})/g,\n            function toSolidBytes(match, p1) {\n                return String.fromCharCode(parseInt('0x' + p1, 16));\n            }));\n\n    }\n\n    public static decode(input: string): string {\n\n        if (!input) {\n            return null;\n        }\n\n        return decodeURIComponent(atob(input).split('').map((c) => {\n            return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);\n        }).join(''));\n\n    }\n}\n","/**\n * localStorage class factory\n * Usage : var LocalStorage = fidj.LocalStorageFactory(window.localStorage); // to create a new class\n * Usage : var localStorageService = new LocalStorage(); // to create a new instance\n */\nexport class LocalStorage {\n\n    public version = '0.1';\n    private storage;\n\n    // Constructor\n    constructor(storageService, private storageKey) {\n        this.storage = storageService || window.localStorage;\n        if (!this.storage) {\n            throw new Error('fidj.LocalStorageFactory needs a storageService!');\n        }\n        // todo LocalStorage refacto\n        //            if (!fidj.Xml) {\n        //                throw new Error('fidj.Xml needs to be loaded before fidj.LocalStorage!');\n        //            }\n        //            if (!fidj.Json) {\n        //                throw new Error('fidj.Json needs to be loaded before fidj.LocalStorage!');\n        //            }\n        //            if (!fidj.Xml.isXml || !fidj.Xml.xml2String || !fidj.Xml.string2Xml) {\n        //                throw new Error('fidj.Xml with isXml(), xml2String()\n        // and string2Xml() needs to be loaded before fidj.LocalStorage!');\n        //            }\n        //            if (!fidj.Json.object2String || !fidj.Json.string2Object) {\n        //                throw new Error('fidj.Json with object2String()\n        // and string2Object() needs to be loaded before fidj.LocalStorage!');\n        //            }\n        //\n    }\n\n    // Public API\n\n    /**\n     * Sets a key's value.\n     *\n     * @param key - Key to set. If this value is not set or not\n     *              a string an exception is raised.\n     * @param value - Value to set. This can be any value that is JSON\n     *              compatible (Numbers, Strings, Objects etc.).\n     * @returns the stored value which is a container of user value.\n     */\n    set(key: string, value) {\n\n        key = this.storageKey + key;\n        this.checkKey(key);\n        // clone the object before saving to storage\n        const t = typeof(value);\n        if (t === 'undefined') {\n            value = 'null';\n        } else if (value === null) {\n            value = 'null';\n        } else if (t === 'string') {\n            value = JSON.stringify({string: value})\n        } else if (t === 'number') {\n            value = JSON.stringify({number: value});\n        } else if (t === 'boolean') {\n            value = JSON.stringify({bool: value});\n        } else if (t === 'object') {\n            value = JSON.stringify({json: value});\n        } else {\n            // reject and do not insert\n            // if (typeof value == \"function\") for example\n            throw new TypeError('Value type ' + t + ' is invalid. It must be null, undefined, xml, string, number, boolean or object');\n        }\n        this.storage.setItem(key, value);\n        return value;\n    };\n\n    /**\n     * Looks up a key in cache\n     *\n     * @param key - Key to look up.\n     * @param def - Default value to return, if key didn't exist.\n     * @returns the key value, default value or <null>\n     */\n    get(key: string, def?) {\n        key = this.storageKey + key;\n        this.checkKey(key);\n        const item = this.storage.getItem(key);\n        if (item !== null) {\n            if (item === 'null') {\n                return null;\n            }\n            const value = JSON.parse(item);\n\n            // var value = fidj.Json.string2Object(item);\n            // if ('xml' in value) {\n            //     return fidj.Xml.string2Xml(value.xml);\n            // } else\n            if ('string' in value) {\n                return value.string;\n            } else if ('number' in value) {\n                return value.number.valueOf();\n            } else if ('bool' in value) {\n                return value.bool.valueOf();\n            } else {\n                return value.json;\n            }\n        }\n        return !def ? null : def;\n    };\n\n    /**\n     * Deletes a key from cache.\n     *\n     * @param  key - Key to delete.\n     * @returns true if key existed or false if it didn't\n     */\n    remove(key: string) {\n        key = this.storageKey + key;\n        this.checkKey(key);\n        const existed = (this.storage.getItem(key) !== null);\n        this.storage.removeItem(key);\n        return existed;\n    };\n\n    /**\n     * Deletes everything in cache.\n     *\n     * @return true\n     */\n    clear() {\n        const existed = (this.storage.length > 0);\n        this.storage.clear();\n        return existed;\n    };\n\n    /**\n     * How much space in bytes does the storage take?\n     *\n     * @returns Number\n     */\n    size() {\n        return this.storage.length;\n    };\n\n    /**\n     * Call function f on the specified context for each element of the storage\n     * from index 0 to index length-1.\n     * WARNING : You should not modify the storage during the loop !!!\n     *\n     * @param f - Function to call on every item.\n     * @param  context - Context (this for example).\n     * @returns Number of items in storage\n     */\n    foreach(f, context) {\n        const n = this.storage.length;\n        for (let i = 0; i < n; i++) {\n            const key = this.storage.key(i);\n            const value = this.get(key);\n            if (context) {\n                // f is an instance method on instance context\n                f.call(context, value);\n            } else {\n                // f is a function or class method\n                f(value);\n            }\n        }\n        return n;\n    };\n\n    // Private API\n    // helper functions and variables hidden within this function scope\n\n    private checkKey(key) {\n        if (!key || (typeof key !== 'string')) {\n            throw new TypeError('Key type must be string');\n        }\n        return true;\n    }\n}\n","import {Base64} from './base64';\n\nexport class Xor {\n\n    static header = 'artemis-lotsum';\n\n    constructor() {\n    };\n\n\n    public static encrypt(value: string, key: string): string {\n\n        let result = '';\n\n        value = Xor.header + value;\n\n        for (let i = 0; i < value.length; i++) {\n            result += String.fromCharCode((value[i].charCodeAt(0).toString(10) as any) ^ Xor.keyCharAt(key, i));\n        }\n        result = Base64.encode(result);\n        return result;\n    };\n\n    public static decrypt(value: string, key: string, oldStyle?: boolean): string {\n        let result = '';\n        value = Base64.decode(value);\n        for (let i = 0; i < value.length; i++) {\n            result += String.fromCharCode((value[i].charCodeAt(0).toString(10) as any) ^ Xor.keyCharAt(key, i));\n        }\n\n        if (!oldStyle && Xor.header !== result.substring(0, Xor.header.length)) {\n            return null;\n        }\n\n        if (!oldStyle) {\n            result = result.substring(Xor.header.length);\n        }\n        return result;\n    }\n\n    public static keyCharAt(key, i) {\n        return key[Math.floor(i % key.length)].charCodeAt(0).toString(10);\n    }\n\n\n}\n","// export namespace fidj {\n// }\nexport interface ErrorInterface {\n    code: number;\n    reason: string;\n}\n\nexport interface EndpointInterface {\n    key: string;\n    url: string;\n    blocked: boolean;\n}\n\nexport interface EndpointFilterInterface {\n    key?: string;\n    showBlocked?: boolean;\n}\n\n/**\n * Interface used by all InternalService wrappers (angular.js, angular.io)\n *\n * @see FidjModule\n * @see FidjModule, FidjAngularService\n */\nexport interface ModuleServiceInterface {\n\n    init(fidjId: string, options?: ModuleServiceInitOptionsInterface): Promise<void | ErrorInterface>;\n\n    login(login: string, password: string): Promise<any | ErrorInterface>;\n\n    loginAsDemo(options?: ModuleServiceLoginOptionsInterface): Promise<any | ErrorInterface>;\n\n    isLoggedIn(): boolean;\n\n    getRoles(): Array<string>;\n\n    getEndpoints(): Array<EndpointInterface>;\n\n    postOnEndpoint(key: string, data: any): Promise<any | ErrorInterface>;\n\n    getIdToken(): string;\n\n    getMessage(): string;\n\n    logout(force?: boolean): Promise<void | ErrorInterface>;\n\n    sync(fnInitFirstData?: any): Promise<any | ErrorInterface>;\n\n    put(data: any): Promise<any | ErrorInterface>;\n\n    remove(dataId: any): Promise<any | ErrorInterface>;\n\n    find(id: string): Promise<any | ErrorInterface>;\n\n    findAll(): Promise<any | ErrorInterface>;\n}\n\n\nexport interface ModuleServiceInitOptionsInterface {\n    prod: boolean,\n    // forcedEndpoint?: string,\n    // forcedDBEndpoint?: string,\n    crypto?: boolean,\n    logLevel?: LoggerLevelEnum\n}\n\nexport interface ModuleServiceLoginOptionsInterface {\n    accessToken?: string,\n    idToken?: string,\n    refreshToken?: string,\n}\n\nexport interface SdkInterface {\n    org: string,\n    version: string,\n    prod: boolean\n}\n\nexport enum LoggerLevelEnum {\n    LOG = 1,\n    WARN = 2,\n    ERROR = 3,\n    NONE = 4\n}\n\nexport interface LoggerInterface {\n    setLevel: (LoggerLevelEnum) => void;\n\n    log: (a?, b?, c?, d?, e?, f?) => any;\n    warn: (a?, b?, c?, d?, e?, f?) => any;\n    error: (a?, b?, c?, d?, e?, f?) => any;\n}\n","// bumped version via gulp\nexport const version = '2.1.20';\n","export class XHRPromise {\n\n    public DEFAULT_CONTENT_TYPE = 'application/x-www-form-urlencoded; charset=UTF-8';\n    private _xhr;\n    private _unloadHandler: any;\n\n    constructor() {\n    };\n\n    /*\n     * XHRPromise.send(options) -> Promise\n     * - options (Object): URL, method, data, etc.\n     *\n     * Create the XHR object and wire up event handlers to use a promise.\n     */\n    send(options): Promise<any> {\n        let defaults;\n        if (options == null) {\n            options = {};\n        }\n        defaults = {\n            method: 'GET',\n            data: null,\n            headers: {},\n            async: true,\n            username: null,\n            password: null,\n            withCredentials: false\n        };\n        options = Object.assign({}, defaults, options);\n        return new Promise(( (_this: XHRPromise) => {\n            return  (resolve, reject) => {\n                let e, header, ref, value, xhr;\n                if (!XMLHttpRequest) {\n                    _this._handleError('browser', reject, null, 'browser doesn\\'t support XMLHttpRequest');\n                    return;\n                }\n                if (typeof options.url !== 'string' || options.url.length === 0) {\n                    _this._handleError('url', reject, null, 'URL is a required parameter');\n                    return;\n                }\n                _this._xhr = xhr = new XMLHttpRequest;\n                xhr.onload =  ()  => {\n                    let responseText;\n                    _this._detachWindowUnload();\n                    try {\n                        responseText = _this._getResponseText();\n                    } catch (_error) {\n                        _this._handleError('parse', reject, null, 'invalid JSON response');\n                        return;\n                    }\n                    return resolve({\n                        url: _this._getResponseUrl(),\n                        status: xhr.status,\n                        statusText: xhr.statusText,\n                        responseText: responseText,\n                        headers: _this._getHeaders(),\n                        xhr: xhr\n                    });\n                };\n                xhr.onerror =  () => {\n                    return _this._handleError('error', reject);\n                };\n                xhr.ontimeout =  () => {\n                    return _this._handleError('timeout', reject);\n                };\n                xhr.onabort =  () => {\n                    return _this._handleError('abort', reject);\n                };\n                _this._attachWindowUnload();\n                xhr.open(options.method, options.url, options.async, options.username, options.password);\n                if (options.withCredentials) {\n                    xhr.withCredentials = true;\n                }\n                if ((options.data != null) && !options.headers['Content-Type']) {\n                    options.headers['Content-Type'] = _this.DEFAULT_CONTENT_TYPE;\n                }\n                ref = options.headers;\n                for (header in ref) {\n                    if (ref.hasOwnProperty(header)) {\n                        value = ref[header];\n                        xhr.setRequestHeader(header, value);\n                    }\n                }\n                try {\n                    return xhr.send(options.data);\n                } catch (_error) {\n                    e = _error;\n                    return _this._handleError('send', reject, null, e.toString());\n                }\n            };\n        })(this));\n    };\n\n\n    /*\n     * XHRPromise.getXHR() -> XMLHttpRequest\n     */\n    getXHR() {\n        return this._xhr;\n    };\n\n\n    /*\n     * XHRPromise._attachWindowUnload()\n     *\n     * Fix for IE 9 and IE 10\n     * Internet Explorer freezes when you close a webpage during an XHR request\n     * https://support.microsoft.com/kb/2856746\n     *\n     */\n    private _attachWindowUnload() {\n        this._unloadHandler = this._handleWindowUnload.bind(this);\n        if ((window as any).attachEvent) {\n            return (window as any).attachEvent('onunload', this._unloadHandler);\n        }\n    };\n\n\n    /*\n     * XHRPromise._detachWindowUnload()\n     */\n    private _detachWindowUnload() {\n        if ((window as any).detachEvent) {\n            return (window as any).detachEvent('onunload', this._unloadHandler);\n        }\n    };\n\n\n    /*\n     * XHRPromise._getHeaders() -> Object\n     */\n    private _getHeaders() {\n        return this._parseHeaders(this._xhr.getAllResponseHeaders());\n    };\n\n\n    /*\n     * XHRPromise._getResponseText() -> Mixed\n     *\n     * Parses response text JSON if present.\n     */\n    private _getResponseText() {\n        let responseText;\n        responseText = typeof this._xhr.responseText === 'string' ? this._xhr.responseText : '';\n        switch ((this._xhr.getResponseHeader('Content-Type') || '').split(';')[0]) {\n            case 'application/json':\n            case 'text/javascript':\n                responseText = JSON.parse(responseText + '');\n        }\n        return responseText;\n    };\n\n\n    /*\n     * XHRPromise._getResponseUrl() -> String\n     *\n     * Actual response URL after following redirects.\n     */\n    private _getResponseUrl() {\n        if (this._xhr.responseURL != null) {\n            return this._xhr.responseURL;\n        }\n        if (/^X-Request-URL:/m.test(this._xhr.getAllResponseHeaders())) {\n            return this._xhr.getResponseHeader('X-Request-URL');\n        }\n        return '';\n    };\n\n\n    /*\n     * XHRPromise._handleError(reason, reject, status, statusText)\n     * - reason (String)\n     * - reject (Function)\n     * - status (String)\n     * - statusText (String)\n     */\n    private _handleError(reason, reject, status?, statusText?) {\n        this._detachWindowUnload();\n\n        // _this._handleError('browser', reject, null, 'browser doesn\\'t support XMLHttpRequest');\n        // _this._handleError('url', reject, null, 'URL is a required parameter');\n        // _this._handleError('parse', reject, null, 'invalid JSON response');\n        // return _this._handleError('error', reject);\n        // return _this._handleError('timeout', reject);\n        // return _this._handleError('abort', reject);\n        // return _this._handleError('send', reject, null, e.toString());\n        // console.log('_handleError:', reason, this._xhr.status);\n        let code = 404;\n        if (reason === 'timeout') {\n            code = 408;\n        } else if (reason === 'abort') {\n            code = 408;\n        }\n\n        return reject({\n            reason: reason,\n            status: status || this._xhr.status || code,\n            code: status || this._xhr.status || code,\n            statusText: statusText || this._xhr.statusText,\n            xhr: this._xhr\n        });\n    };\n\n\n    /*\n     * XHRPromise._handleWindowUnload()\n     */\n    private _handleWindowUnload() {\n        return this._xhr.abort();\n    };\n\n\n    private trim(str) {\n        return str.replace(/^\\s*|\\s*$/g, '');\n    }\n\n    private isArray(arg) {\n        return Object.prototype.toString.call(arg) === '[object Array]';\n    }\n\n\n    private forEach(list, iterator) {\n        if (toString.call(list) === '[object Array]') {\n            this.forEachArray(list, iterator, this)\n        } else if (typeof list === 'string') {\n            this.forEachString(list, iterator, this)\n        } else {\n            this.forEachObject(list, iterator, this)\n        }\n    }\n\n    private forEachArray(array, iterator, context) {\n        for (let i = 0, len = array.length; i < len; i++) {\n            if (array.hasOwnProperty(i)) {\n                iterator.call(context, array[i], i, array)\n            }\n        }\n    }\n\n    private forEachString(string, iterator, context) {\n        for (let i = 0, len = string.length; i < len; i++) {\n            // no such thing as a sparse string.\n            iterator.call(context, string.charAt(i), i, string)\n        }\n    }\n\n    private forEachObject(object, iterator, context) {\n        for (const k in object) {\n            if (object.hasOwnProperty(k)) {\n                iterator.call(context, object[k], k, object)\n            }\n        }\n    }\n\n    private _parseHeaders(headers) {\n        if (!headers) {\n            return {};\n        }\n\n        const result = {};\n\n        this.forEach(\n            this.trim(headers).split('\\n')\n            , (row) => {\n                const index = row.indexOf(':')\n                    , key = this.trim(row.slice(0, index)).toLowerCase()\n                    , value = this.trim(row.slice(index + 1));\n\n                if (typeof(result[key]) === 'undefined') {\n                    result[key] = value\n                } else if (this.isArray(result[key])) {\n                    result[key].push(value)\n                } else {\n                    result[key] = [result[key], value]\n                }\n            }\n        );\n\n        return result;\n    }\n\n\n}\n","import {XHRPromise} from './xhrpromise';\n\nexport interface XhrOptionsInterface {\n    url: string,\n    data?: any,\n    headers?: any,\n    async?: boolean,\n    username?: string,\n    password?: string,\n    withCredentials?: boolean\n}\n\nexport class Ajax {\n\n    // private static xhr: XHRPromise = new XHRPromise();\n    private xhr: XHRPromise;\n\n    constructor() {\n        this.xhr = new XHRPromise();\n    };\n\n    public post(args: XhrOptionsInterface): Promise<any> {\n\n        const opt: any = {\n            method: 'POST',\n            url: args.url,\n            data: JSON.stringify(args.data)\n        };\n        if (args.headers) {\n            opt.headers = args.headers;\n        }\n\n        return this.xhr\n            .send(opt)\n            .then(res => {\n                if (res.status &&\n                    (parseInt(res.status, 10) < 200 || parseInt(res.status, 10) >= 300)) {\n                    res.reason = 'status';\n                    res.code = parseInt(res.status, 10);\n                    return Promise.reject(res);\n                }\n                return Promise.resolve(res.responseText);\n            })\n            .catch(err => {\n\n                // _this._handleError('browser', reject, null, 'browser doesn\\'t support XMLHttpRequest');\n                // _this._handleError('url', reject, null, 'URL is a required parameter');\n                // _this._handleError('parse', reject, null, 'invalid JSON response');\n                // return _this._handleError('error', reject);\n                // return _this._handleError('timeout', reject);\n                // return _this._handleError('abort', reject);\n                // return _this._handleError('send', reject, null, e.toString());\n\n                // if (err.reason === 'timeout') {\n                //     err.code = 408;\n                // } else {\n                //     err.code = 404;\n                // }\n                return Promise.reject(err);\n            });\n    }\n\n    public put(args: XhrOptionsInterface): Promise<any> {\n        const opt: any = {\n            method: 'PUT',\n            url: args.url,\n            data: JSON.stringify(args.data)\n        };\n        if (args.headers) {\n            opt.headers = args.headers;\n        }\n        return this.xhr\n            .send(opt)\n            .then(res => {\n                if (res.status &&\n                    (parseInt(res.status, 10) < 200 || parseInt(res.status, 10) >= 300)) {\n                    res.reason = 'status';\n                    res.code = parseInt(res.status, 10);\n                    return Promise.reject(res);\n                }\n                return Promise.resolve(res.responseText);\n            })\n            .catch(err => {\n                // if (err.reason === 'timeout') {\n                //     err.code = 408;\n                // } else {\n                //     err.code = 404;\n                // }\n                return Promise.reject(err);\n            });\n    }\n\n    public delete(args: XhrOptionsInterface): Promise<any> {\n        const opt: any = {\n            method: 'DELETE',\n            url: args.url,\n            data: JSON.stringify(args.data)\n        };\n        if (args.headers) {\n            opt.headers = args.headers;\n        }\n        return this.xhr\n            .send(opt)\n            .then(res => {\n                if (res.status &&\n                    (parseInt(res.status, 10) < 200 || parseInt(res.status, 10) >= 300)) {\n                    res.reason = 'status';\n                    res.code = parseInt(res.status, 10);\n                    return Promise.reject(res);\n                }\n                return Promise.resolve(res.responseText);\n            })\n            .catch(err => {\n                // if (err.reason === 'timeout') {\n                //     err.code = 408;\n                // } else {\n                //     err.code = 404;\n                // }\n                return Promise.reject(err);\n            });\n    }\n\n    public get(args: XhrOptionsInterface): Promise<any> {\n        const opt: any = {\n            method: 'GET',\n            url: args.url\n        };\n        if (args.data) {\n            opt.data = args.data;\n        }\n        if (args.headers) {\n            opt.headers = args.headers;\n        }\n        return this.xhr\n            .send(opt)\n            .then(res => {\n                if (res.status &&\n                    (parseInt(res.status, 10) < 200 || parseInt(res.status, 10) >= 300)) {\n                    res.reason = 'status';\n                    res.code = parseInt(res.status, 10);\n                    return Promise.reject(res);\n                }\n                return Promise.resolve(res.responseText);\n            })\n            .catch(err => {\n                // if (err.reason === 'timeout') {\n                //     err.code = 408;\n                // } else {\n                //     err.code = 404;\n                // }\n                return Promise.reject(err);\n            });\n    }\n}\n","import {Ajax} from './ajax';\nimport {LocalStorage} from '../tools';\nimport {SdkInterface, ErrorInterface} from '../sdk/interfaces';\n\nexport class Client {\n\n    public clientId: string;\n    private clientUuid: string;\n    private clientInfo: string;\n    private refreshToken: string;\n    private static refreshCount = 0;\n    private static _clientUuid = 'v2.clientUuid';\n    private static _clientId = 'v2.clientId';\n    private static _refreshCount = 'v2.refreshCount';\n\n    constructor(private appId: string,\n                private URI: string,\n                private storage: LocalStorage,\n                private sdk: SdkInterface) {\n\n        let uuid: string = this.storage.get(Client._clientUuid) || 'uuid-' + Math.random();\n        let info = '_clientInfo'; // this.storage.get(Client._clientInfo);\n        if (window && window.navigator) {\n            info = window.navigator.appName + '@' + window.navigator.appVersion + '-' + window.navigator.userAgent;\n        }\n        if (window && window['device'] && window['device'].uuid) {\n            uuid = window['device'].uuid;\n        }\n        this.setClientUuid(uuid);\n        this.setClientInfo(info);\n        this.clientId = this.storage.get(Client._clientId);\n        Client.refreshCount = this.storage.get(Client._refreshCount) || 0;\n    };\n\n    public setClientId(value: string) {\n        this.clientId = '' + value;\n        this.storage.set(Client._clientId, this.clientId);\n    }\n\n    public setClientUuid(value: string) {\n        this.clientUuid = '' + value;\n        this.storage.set(Client._clientUuid, this.clientUuid);\n    }\n\n    public setClientInfo(value: string) {\n        this.clientInfo = '' + value;\n        // this.storage.set('clientInfo', this.clientInfo);\n    }\n\n    public login(login: string, password: string, updateProperties?: any): Promise<any | ErrorInterface> {\n\n        if (!this.URI) {\n            console.error('no api uri');\n            return Promise.reject({code: 408, reason: 'no-api-uri'});\n        }\n\n        const urlLogin = this.URI + '/users';\n        const dataLogin = {\n            name: login,\n            username: login,\n            email: login,\n            password: password\n        };\n\n        return new Ajax()\n            .post({\n                url: urlLogin,\n                data: dataLogin,\n                headers: {'Content-Type': 'application/json', 'Accept': 'application/json'}\n            })\n            .then(createdUser => {\n\n                this.setClientId(createdUser._id);\n                const urlToken = this.URI + '/oauth/token';\n                const dataToken = {\n                    grant_type: 'client_credentials',\n                    client_id: this.clientId,\n                    client_secret: password,\n                    client_udid: this.clientUuid,\n                    client_info: this.clientInfo,\n                    audience: this.appId,\n                    scope: JSON.stringify(this.sdk)\n                };\n                return new Ajax()\n                    .post({\n                        url: urlToken,\n                        data: dataToken,\n                        headers: {'Content-Type': 'application/json', 'Accept': 'application/json'}\n                    });\n            });\n    }\n\n    public reAuthenticate(refreshToken: string): Promise<any | ErrorInterface> {\n\n        if (!this.URI) {\n            console.error('no api uri');\n            return Promise.reject({code: 408, reason: 'no-api-uri'});\n        }\n\n        const url = this.URI + '/oauth/token';\n        const data = {\n            grant_type: 'refresh_token',\n            client_id: this.clientId,\n            client_udid: this.clientUuid,\n            client_info: this.clientInfo,\n            audience: this.appId,\n            scope: JSON.stringify(this.sdk),\n            refresh_token: refreshToken,\n            refresh_extra: Client.refreshCount,\n        };\n\n        return new Ajax()\n            .post({\n                url: url,\n                data: data,\n                headers: {'Content-Type': 'application/json', 'Accept': 'application/json'}\n            })\n            .then((obj: any) => {\n                Client.refreshCount++;\n                this.storage.set(Client._refreshCount, Client.refreshCount);\n                return Promise.resolve(obj);\n            });\n    }\n\n    public logout(refreshToken?: string): Promise<void | ErrorInterface> {\n\n        if (!this.URI) {\n            console.error('no api uri');\n            return Promise.reject({code: 408, reason: 'no-api-uri'});\n        }\n\n        // delete this.clientUuid;\n        // delete this.clientId;\n        // this.storage.remove(Client._clientUuid);\n        this.storage.remove(Client._clientId);\n        this.storage.remove(Client._refreshCount);\n        Client.refreshCount = 0;\n\n        if (!refreshToken || !this.clientId) {\n            return Promise.resolve();\n        }\n\n        const url = this.URI + '/oauth/revoke';\n        const data = {\n            token: refreshToken,\n            client_id: this.clientId,\n            client_udid: this.clientUuid,\n            client_info: this.clientInfo,\n            audience: this.appId,\n            scope: JSON.stringify(this.sdk)\n        };\n\n        return new Ajax()\n            .post({\n                url: url,\n                data: data,\n                headers: {'Content-Type': 'application/json', 'Accept': 'application/json'}\n            });\n    }\n\n    public isReady(): boolean {\n        return !!this.URI;\n    }\n}\n","import {ErrorInterface} from './interfaces';\n\nexport class Error implements ErrorInterface {\n\n    constructor(public code: number, public reason: string) {\n    };\n\n    equals(err: Error) {\n        return this.code === err.code && this.reason === err.reason;\n    }\n\n    toString(): string {\n        const msg: string = (typeof this.reason === 'string') ? this.reason : JSON.stringify(this.reason);\n        return '' + this.code + ' - ' + msg;\n    }\n\n}\n","import {Client} from './client';\nimport {ModuleServiceLoginOptionsInterface, SdkInterface, ErrorInterface, EndpointInterface} from '../sdk/interfaces';\nimport {Base64, LocalStorage, Xor} from '../tools';\nimport {Ajax} from './ajax';\nimport {ConnectionFindOptionsInterface} from './interfaces';\n\nexport class Connection {\n\n    public fidjId: string;\n    public fidjVersion: string;\n    public fidjCrypto: boolean;\n    public accessToken: string;\n    public accessTokenPrevious: string;\n    public idToken: string;\n    public refreshToken: string;\n    public states: { [s: string]: { state: boolean, time: number, lastTimeWasOk: number }; }; // Map<string, boolean>;\n    public apis: Array<EndpointInterface>;\n\n    private cryptoSalt: string;\n    private cryptoSaltNext: string;\n    private client: Client;\n    private user: any;\n\n    private static _accessToken = 'v2.accessToken';\n    private static _accessTokenPrevious = 'v2.accessTokenPrevious';\n    private static _idToken = 'v2.idToken';\n    private static _refreshToken = 'v2.refreshToken';\n    private static _states = 'v2.states';\n    private static _cryptoSalt = 'v2.cryptoSalt';\n    private static _cryptoSaltNext = 'v2.cryptoSalt.next';\n\n    constructor(private _sdk: SdkInterface,\n                private _storage: LocalStorage) {\n        this.client = null;\n        this.user = null;\n        this.cryptoSalt = this._storage.get(Connection._cryptoSalt) || null;\n        this.cryptoSaltNext = this._storage.get(Connection._cryptoSaltNext) || null;\n        this.accessToken = this._storage.get(Connection._accessToken) || null;\n        this.accessTokenPrevious = this._storage.get('v2.accessTokenPrevious') || null;\n        this.idToken = this._storage.get(Connection._idToken) || null;\n        this.refreshToken = this._storage.get(Connection._refreshToken) || null;\n        this.states = this._storage.get(Connection._states) || {};\n        this.apis = [];\n    };\n\n    isReady(): boolean {\n        return !!this.client && this.client.isReady();\n    }\n\n    destroy(force?: boolean): void {\n\n        this._storage.remove(Connection._accessToken);\n        this._storage.remove(Connection._idToken);\n        this._storage.remove(Connection._refreshToken);\n        this._storage.remove(Connection._states);\n\n        if (this.accessToken) {\n            this.accessTokenPrevious = this.accessToken;\n            this._storage.set(Connection._accessTokenPrevious, this.accessTokenPrevious);\n        }\n\n        if (force) {\n            this._storage.remove(Connection._cryptoSalt);\n            this._storage.remove(Connection._cryptoSaltNext);\n            this._storage.remove(Connection._accessTokenPrevious);\n        }\n\n        this.user = null;\n        if (this.client) {\n            // this.client.setClientId(null);\n            this.client.logout();\n        }\n        this.accessToken = null;\n        this.idToken = null;\n        this.refreshToken = null;\n        this.states = {}; // new Map<string, boolean>();\n    }\n\n    setClient(client: Client): void {\n\n        this.client = client;\n        if (!this.user) {\n            this.user = {};\n        }\n\n        // this._user._id = this._client.clientId;\n        this.user._name = JSON.parse(this.getIdPayload({name: ''})).name;\n    }\n\n    setUser(user: any): void {\n        this.user = user;\n        if (this.user._id) {\n            this.client.setClientId(this.user._id);\n\n            // store only clientId\n            delete this.user._id;\n        }\n    }\n\n    getUser(): any {\n        return this.user;\n    }\n\n    getClient(): Client {\n        return this.client;\n    }\n\n    setCryptoSalt(value: string) {\n        if (this.cryptoSalt !== value && this.cryptoSaltNext !== value) {\n            this.cryptoSaltNext = value;\n            this._storage.set(Connection._cryptoSaltNext, this.cryptoSaltNext);\n        }\n\n        if (!this.cryptoSalt) {\n            this.setCryptoSaltAsVerified();\n        }\n    }\n\n    setCryptoSaltAsVerified() {\n        if (this.cryptoSaltNext) {\n            this.cryptoSalt = this.cryptoSaltNext;\n            this._storage.set(Connection._cryptoSalt, this.cryptoSalt);\n        }\n        this.cryptoSaltNext = null;\n        this._storage.remove(Connection._cryptoSaltNext);\n    }\n\n    encrypt(data: any): string {\n\n        if (typeof data !== 'string') {\n            data = JSON.stringify(data);\n        } else {\n            const dataAsObj = {string: data};\n            data = JSON.stringify(dataAsObj);\n        }\n\n        if (this.fidjCrypto && this.cryptoSalt) {\n            const key = this.cryptoSalt;\n            return Xor.encrypt(data, key);\n        } else {\n            return data;\n        }\n    }\n\n    decrypt(data: string): any {\n        let decrypted = null;\n\n        try {\n            if (!decrypted && this.fidjCrypto && this.cryptoSaltNext) {\n                const key = this.cryptoSaltNext;\n                decrypted = Xor.decrypt(data, key);\n                decrypted = JSON.parse(decrypted);\n                // if (decrypted) {\n                //    this.setCryptoSaltAsVerified();\n                // }\n            }\n        } catch (err) {\n            decrypted = null;\n        }\n\n        try {\n            if (!decrypted && this.fidjCrypto && this.cryptoSalt) {\n                const key = this.cryptoSalt;\n                decrypted = Xor.decrypt(data, key);\n                decrypted = JSON.parse(decrypted);\n            }\n        } catch (err) {\n            decrypted = null;\n        }\n\n        try {\n            if (!decrypted && this.fidjCrypto && this.cryptoSalt) {\n                const key = this.cryptoSalt;\n                decrypted = Xor.decrypt(data, key, true);\n                decrypted = JSON.parse(decrypted);\n            }\n        } catch (err) {\n            decrypted = null;\n        }\n\n\n        try {\n\n            if (!decrypted) {\n                decrypted = JSON.parse(data);\n            }\n\n            if (decrypted && decrypted.string) {\n                decrypted = decrypted.string;\n            }\n\n        } catch (err) {\n            decrypted = null;\n        }\n\n        return decrypted;\n    }\n\n    isLogin(): boolean {\n        let exp = true;\n        try {\n            const payload = this.refreshToken.split('.')[1];\n            const decoded = JSON.parse(Base64.decode(payload));\n            exp = ((new Date().getTime() / 1000) >= decoded.exp);\n\n        } catch (e) {\n        }\n        return !exp;\n    }\n\n    // todo reintegrate client.login()\n\n    logout(): Promise<void | ErrorInterface> {\n        return this.getClient().logout(this.refreshToken);\n    }\n\n    getClientId(): string {\n        if (!this.client) {\n            return null;\n        }\n        return this.client.clientId;\n    }\n\n    getIdToken(): string {\n        return this.idToken;\n    }\n\n    getIdPayload(def?: any): string {\n        if (def && typeof def !== 'string') {\n            def = JSON.stringify(def);\n        }\n\n        try {\n            const payload = this.getIdToken().split('.')[1];\n            if (payload) {\n                return Base64.decode(payload);\n            }\n        } catch (e) {\n        }\n        return def ? def : null;\n    }\n\n    getAccessPayload(def?: any): string {\n        if (def && typeof def !== 'string') {\n            def = JSON.stringify(def);\n        }\n\n        try {\n            const payload = this.accessToken.split('.')[1];\n            if (payload) {\n                return Base64.decode(payload);\n            }\n        } catch (e) {\n        }\n        return def ? def : null;\n    }\n\n    getPreviousAccessPayload(def?: any): string {\n        if (def && typeof def !== 'string') {\n            def = JSON.stringify(def);\n        }\n\n        try {\n            const payload = this.accessTokenPrevious.split('.')[1];\n            if (payload) {\n                return Base64.decode(payload);\n            }\n        } catch (e) {\n        }\n        return def ? def : null;\n    }\n\n    refreshConnection(): Promise<any | ErrorInterface> {\n\n        // store states\n        this._storage.set(Connection._states, this.states);\n\n        // token not expired : ok\n        if (this.accessToken) {\n            const payload = this.accessToken.split('.')[1];\n            const decoded = Base64.decode(payload);\n            // console.log('new Date().getTime() < JSON.parse(decoded).exp :', (new Date().getTime() / 1000), JSON.parse(decoded).exp);\n            if ((new Date().getTime() / 1000) < JSON.parse(decoded).exp) {\n                return Promise.resolve(this.getUser());\n            }\n        }\n\n        // remove expired refreshToken\n        if (this.refreshToken) {\n            const payload = this.refreshToken.split('.')[1];\n            const decoded = Base64.decode(payload);\n            if ((new Date().getTime() / 1000) >= JSON.parse(decoded).exp) {\n                this._storage.remove(Connection._refreshToken);\n            }\n        }\n\n        // remove expired accessToken & idToken & store it as Previous one\n        this.accessTokenPrevious = this.accessToken;\n        this._storage.set('v2.accessTokenPrevious', this.accessTokenPrevious);\n        this._storage.remove(Connection._accessToken);\n        this._storage.remove(Connection._idToken);\n        this.accessToken = null;\n        this.idToken = null;\n\n        // refresh authentication\n        return new Promise((resolve, reject) => {\n            this.getClient().reAuthenticate(this.refreshToken)\n                .then(user => {\n                    this.setConnection(user);\n                    resolve(this.getUser());\n                })\n                .catch(err => {\n\n                    // if (err && err.code === 408) {\n                    //     code = 408; // no api uri or basic timeout : offline\n                    // } else if (err && err.code === 404) {\n                    //     code = 404; // page not found : offline\n                    // } else if (err && err.code === 410) {\n                    //     code = 403; // token expired or device not sure : need relogin\n                    // } else if (err) {\n                    //     code = 403; // forbidden : need relogin\n                    // }\n\n                    // resolve(code);\n                    reject(err);\n                });\n        });\n    };\n\n    setConnection(clientUser: any): void {\n\n        // only in private storage\n        if (clientUser.access_token) {\n            this.accessToken = clientUser.access_token;\n            this._storage.set(Connection._accessToken, this.accessToken);\n            delete clientUser.access_token;\n\n            const salt: string = JSON.parse(this.getAccessPayload({salt: ''})).salt;\n            if (salt) {\n                this.setCryptoSalt(salt);\n            }\n        }\n        if (clientUser.id_token) {\n            this.idToken = clientUser.id_token;\n            this._storage.set(Connection._idToken, this.idToken);\n            delete clientUser.id_token;\n        }\n        if (clientUser.refresh_token) {\n            this.refreshToken = clientUser.refresh_token;\n            this._storage.set(Connection._refreshToken, this.refreshToken);\n            delete clientUser.refresh_token;\n        }\n\n        // store changed states\n        this._storage.set(Connection._states, this.states);\n\n        // expose roles, message\n        // clientUser.roles = self.fidjRoles();\n        // clientUser.message = self.fidjMessage();\n        clientUser.roles = JSON.parse(this.getIdPayload({roles: []})).roles;\n        clientUser.message = JSON.parse(this.getIdPayload({message: ''})).message;\n        this.setUser(clientUser);\n    };\n\n    setConnectionOffline(options: ModuleServiceLoginOptionsInterface): void {\n\n        if (options.accessToken) {\n            this.accessToken = options.accessToken;\n            this._storage.set(Connection._accessToken, this.accessToken);\n        }\n        if (options.idToken) {\n            this.idToken = options.idToken;\n            this._storage.set(Connection._idToken, this.idToken);\n        }\n        if (options.refreshToken) {\n            this.refreshToken = options.refreshToken;\n            this._storage.set(Connection._refreshToken, this.refreshToken);\n        }\n\n        this.setUser({\n            roles: JSON.parse(this.getIdPayload({roles: []})).roles,\n            message: JSON.parse(this.getIdPayload({message: ''})).message,\n            _id: 'demo'\n        });\n    }\n\n    getApiEndpoints(options?: ConnectionFindOptionsInterface): Array<EndpointInterface> {\n\n        // todo : let ea = ['https://fidj/api', 'https://fidj-proxy.herokuapp.com/api'];\n        let ea: EndpointInterface[] = [\n            {key: 'fidj.default', url: 'https://fidj.ovh/api', blocked: false}];\n        let filteredEa = [];\n\n        if (!this._sdk.prod) {\n            ea = [\n                {key: 'fidj.default', url: 'http://localhost:3201/api', blocked: false},\n                {key: 'fidj.default', url: 'https://fidj-sandbox.herokuapp.com/api', blocked: false}\n            ];\n        }\n\n        if (this.accessToken) {\n            const val = this.getAccessPayload({apis: []});\n            const apiEndpoints: EndpointInterface[] = JSON.parse(val).apis;\n            if (apiEndpoints && apiEndpoints.length) {\n                ea = [];\n                apiEndpoints.forEach((endpoint) => {\n                    if (endpoint.url) {\n                        ea.push(endpoint);\n                    }\n                });\n            }\n        }\n\n        if (this.accessTokenPrevious) {\n            const apiEndpoints: EndpointInterface[] = JSON.parse(this.getPreviousAccessPayload({apis: []})).apis;\n            if (apiEndpoints && apiEndpoints.length) {\n                apiEndpoints.forEach((endpoint) => {\n                    if (endpoint.url && ea.filter((r) => r.url === endpoint.url).length === 0) {\n                        ea.push(endpoint);\n                    }\n                });\n            }\n        }\n\n        let couldCheckStates = true;\n        if (this.states && Object.keys(this.states).length) {\n            for (let i = 0; (i < ea.length) && couldCheckStates; i++) {\n                if (!this.states[ea[i].url]) {\n                    couldCheckStates = false;\n                }\n            }\n        } else {\n            couldCheckStates = false;\n        }\n\n        if (options && options.filter) {\n\n            if (couldCheckStates && options.filter === 'theBestOne') {\n                for (let i = 0; (i < ea.length) && (filteredEa.length === 0); i++) {\n                    const endpoint = ea[i];\n                    if (this.states[endpoint.url] &&\n                        this.states[endpoint.url].state) {\n                        filteredEa.push(endpoint);\n                    }\n                }\n            } else if (couldCheckStates && options.filter === 'theBestOldOne') {\n                let bestOldOne: EndpointInterface;\n                for (let i = 0; (i < ea.length); i++) {\n                    const endpoint = ea[i];\n                    if (this.states[endpoint.url] &&\n                        this.states[endpoint.url].lastTimeWasOk &&\n                        (!bestOldOne || this.states[endpoint.url].lastTimeWasOk > this.states[bestOldOne.url].lastTimeWasOk)) {\n\n                        bestOldOne = endpoint;\n                    }\n                }\n                if (bestOldOne) {\n                    filteredEa.push(bestOldOne);\n                }\n            } else if (ea.length) {\n                filteredEa.push(ea[0]);\n            }\n        } else {\n            filteredEa = ea;\n        }\n\n        return filteredEa;\n    };\n\n    getDBs(options?: ConnectionFindOptionsInterface): EndpointInterface[] {\n\n        if (!this.accessToken) {\n            return [];\n        }\n\n        // todo test random DB connection\n        const random = Math.random() % 2;\n        let dbs = JSON.parse(this.getAccessPayload({dbs: []})).dbs || [];\n\n        // need to synchronize db\n        if (random === 0) {\n            dbs = dbs.sort();\n        } else if (random === 1) {\n            dbs = dbs.reverse();\n        }\n\n        let filteredDBs = [];\n        let couldCheckStates = true;\n        if (this.states && Object.keys(this.states).length) {\n            for (let i = 0; (i < dbs.length) && couldCheckStates; i++) {\n                if (!this.states[dbs[i].url]) {\n                    couldCheckStates = false;\n                }\n            }\n        } else {\n            couldCheckStates = false;\n        }\n\n        if (couldCheckStates && options && options.filter === 'theBestOne') {\n            for (let i = 0; (i < dbs.length) && (filteredDBs.length === 0); i++) {\n                const endpoint = dbs[i];\n                if (this.states[endpoint.url] &&\n                    this.states[endpoint.url].state) {\n                    filteredDBs.push(endpoint);\n                }\n            }\n        } else if (couldCheckStates && options && options.filter === 'theBestOnes') {\n            for (let i = 0; (i < dbs.length); i++) {\n                const endpoint = dbs[i];\n                if (this.states[endpoint.url] &&\n                    this.states[endpoint.url].state) {\n                    filteredDBs.push(endpoint);\n                }\n            }\n        } else if (options && options.filter === 'theBestOne' && dbs.length) {\n            filteredDBs.push(dbs[0]);\n        } else {\n            filteredDBs = dbs;\n        }\n\n        return filteredDBs;\n    };\n\n    verifyConnectionStates(): Promise<any | ErrorInterface> {\n\n        const currentTime = new Date().getTime();\n\n        // todo need verification ? not yet (cache)\n        // if (Object.keys(this.states).length > 0) {\n        //     const time = this.states[Object.keys(this.states)[0]].time;\n        //     if (currentTime < time) {\n        //         return Promise.resolve();\n        //     }\n        // }\n\n        // verify via GET status on Endpoints & DBs\n        const promises = [];\n        // this.states = {};\n        this.apis = this.getApiEndpoints();\n        this.apis.forEach((endpointObj) => {\n            let endpointUrl: string = endpointObj.url;\n            if (!endpointUrl) {\n                endpointUrl = endpointObj.toString();\n            }\n            promises.push(new Promise((resolve, reject) => {\n                new Ajax()\n                    .get({\n                        url: endpointUrl + '/status?isok=' + this._sdk.version,\n                        headers: {'Content-Type': 'application/json', 'Accept': 'application/json'}\n                    })\n                    .then(data => {\n                        let state = false;\n                        if (data && data.isok) {\n                            state = true;\n                        }\n                        this.states[endpointUrl] = {state: state, time: currentTime, lastTimeWasOk: currentTime};\n                        resolve();\n                    })\n                    .catch(err => {\n                        let lastTimeWasOk = 0;\n                        if (this.states[endpointUrl]) {\n                            lastTimeWasOk = this.states[endpointUrl].lastTimeWasOk;\n                        }\n                        this.states[endpointUrl] = {state: false, time: currentTime, lastTimeWasOk: lastTimeWasOk};\n                        resolve();\n                    });\n            }));\n        });\n\n        const dbs = this.getDBs();\n        dbs.forEach((dbEndpointObj) => {\n            let dbEndpoint: string = dbEndpointObj.url;\n            if (!dbEndpoint) {\n                dbEndpoint = dbEndpointObj.toString();\n            }\n            promises.push(new Promise((resolve, reject) => {\n                new Ajax()\n                    .get({\n                        url: dbEndpoint,\n                        headers: {'Content-Type': 'application/json', 'Accept': 'application/json'}\n                    })\n                    .then(data => {\n                        this.states[dbEndpoint] = {state: true, time: currentTime, lastTimeWasOk: currentTime};\n                        resolve();\n                    })\n                    .catch(err => {\n                        let lastTimeWasOk = 0;\n                        if (this.states[dbEndpoint]) {\n                            lastTimeWasOk = this.states[dbEndpoint].lastTimeWasOk;\n                        }\n                        this.states[dbEndpoint] = {state: false, time: currentTime, lastTimeWasOk: lastTimeWasOk};\n                        resolve();\n                    });\n            }));\n        });\n        return Promise.all(promises);\n    };\n\n}\n","// import PouchDB from 'pouchdb';\n// let PouchDB: any;\n\nimport PouchDB from 'pouchdb/dist/pouchdb.js';\nimport {Error} from '../sdk/error';\nimport {EndpointInterface, ErrorInterface} from '../sdk/interfaces';\n\nconst FidjPouch = window['PouchDB'] ? window['PouchDB'] : require('pouchdb').default; // .default;\n\n// load cordova adapter : https://github.com/pouchdb-community/pouchdb-adapter-cordova-sqlite/issues/22\nconst PouchAdapterCordovaSqlite = require('pouchdb-adapter-cordova-sqlite');\nFidjPouch.plugin(PouchAdapterCordovaSqlite);\n\nexport interface SessionCryptoInterface {\n    obj: Object,\n    method: string\n}\n\nexport class Session {\n\n    public dbRecordCount: number;\n    public dbLastSync: number; // Date().getTime();\n\n    private db: PouchDB; // PouchDB\n    private remoteDb: PouchDB; // PouchDB;\n    private remoteUri: string;\n    private dbs: Array<EndpointInterface>;\n\n    constructor() {\n        this.db = null;\n        this.dbRecordCount = 0;\n        this.dbLastSync = null;\n        this.remoteDb = null;\n        this.dbs = [];\n    };\n\n    public isReady(): boolean {\n        return !!this.db;\n    }\n\n\n    public create(uid: string, force?: boolean): Promise<void | ErrorInterface> {\n\n        if (!force && this.db) {\n            return Promise.resolve();\n        }\n\n        this.dbRecordCount = 0;\n        this.dbLastSync = null; // new Date().getTime();\n        this.db = null;\n        uid = uid || 'default';\n\n        return new Promise((resolve, reject) => {\n\n            let opts: any = {location: 'default'};\n            try {\n                if (window['cordova']) {\n                    opts = {location: 'default', adapter: 'cordova-sqlite'};\n                    //    const plugin = require('pouchdb-adapter-cordova-sqlite');\n                    //    if (plugin) { Pouch.plugin(plugin); }\n                    //    this.db = new Pouch('fidj_db', {adapter: 'cordova-sqlite'});\n                }\n                // } else {\n                this.db = new FidjPouch('fidj_db_' + uid, opts); // , {adapter: 'websql'} ???\n                // }\n\n                this.db.info()\n                    .then((info) => {\n\n                        // todo if (info.adapter !== 'websql') {\n                        return resolve(this.db);\n                        // }\n\n                        // const newopts: any = opts || {};\n                        // newopts.adapter = 'idb';\n                        //\n                        // const newdb = new Pouch('fidj_db', opts);\n                        // this.db.replicate.to(newdb)\n                        //     .then(() => {\n                        //         this.db = newdb;\n                        //         resolve();\n                        //     })\n                        //     .catch((err) => {\n                        //         reject(new Error(400, err.toString()))\n                        //     });\n\n                    }).catch((err) => {\n                    reject(new Error(400, err))\n                });\n            } catch (err) {\n                reject(new Error(500, err));\n            }\n        });\n    }\n\n    public destroy(): Promise<void | ErrorInterface> {\n\n        if (!this.db) {\n            this.dbRecordCount = 0;\n            this.dbLastSync = null;\n            return Promise.resolve();\n        }\n\n        if (this.db && !this.db.destroy) {\n            return Promise.reject(new Error(408, 'Need a valid db'));\n        }\n\n        return new Promise((resolve, reject) => {\n            this.db.destroy((err, info) => {\n                if (err) {\n                    reject(new Error(500, err));\n                } else {\n                    this.dbRecordCount = 0;\n                    this.dbLastSync = null;\n                    this.db = null;\n                    resolve();\n                }\n            });\n        });\n    };\n\n    public setRemote(dbs: Array<EndpointInterface>): void {\n        this.dbs = dbs;\n    }\n\n    public sync(userId: string): Promise<void | ErrorInterface> {\n\n        if (!this.db) {\n            return Promise.reject(new Error(408, 'need db'));\n        }\n        if (!this.dbs || !this.dbs.length) {\n            return Promise.reject(new Error(408, 'need a remote db'));\n        }\n\n        return new Promise((resolve, reject) => {\n            try {\n\n                if (!this.remoteDb || this.remoteUri !== this.dbs[0].url) {\n                    this.remoteUri = this.dbs[0].url;\n                    this.remoteDb = new FidjPouch(this.remoteUri);\n                    // todo , {headers: {'Authorization': 'Bearer ' + id_token}});\n                }\n\n                this.db.replicate.to(this.remoteDb)\n                    .on('complete', (info) => {\n                        return this.remoteDb.replicate.to(this.db,\n                            {\n                                filter: (doc) => {\n                                    return (!!userId && !!doc && doc.fidjUserId === userId);\n                                }\n                            })\n                            .on('complete', () => {\n                                // this.logger\n                                resolve();\n                            })\n                            .on('denied', (err) => reject({code: 403, reason: {second: err}}))\n                            .on('error', (err) => reject({code: 401, reason:  {second: err}}));\n\n                    })\n                    .on('denied', (err) => reject({code: 403, reason:  {first: err}}))\n                    .on('error', (err) => reject({code: 401, reason:  {first: err}}));\n\n            } catch (err) {\n                reject(new Error(500, err));\n            }\n        });\n    }\n\n    public put(data: any,\n               _id: string,\n               uid: string,\n               oid: string,\n               ave: string,\n               crypto?: SessionCryptoInterface): Promise<any | ErrorInterface> {\n\n        if (!this.db) {\n            return Promise.reject(new Error(408, 'need db'));\n        }\n\n        if (!data || !_id || !uid || !oid || !ave) {\n            return Promise.reject(new Error(400, 'need formated data'));\n        }\n\n        const dataWithoutIds = JSON.parse(JSON.stringify(data));\n        const toStore: any = {\n            _id: _id,\n            fidjUserId: uid,\n            fidjOrgId: oid,\n            fidjAppVersion: ave\n        };\n        if (dataWithoutIds._rev) {\n            toStore._rev = '' + dataWithoutIds._rev;\n        }\n        delete dataWithoutIds._id;\n        delete dataWithoutIds._rev;\n        delete dataWithoutIds.fidjUserId;\n        delete dataWithoutIds.fidjOrgId;\n        delete dataWithoutIds.fidjAppVersion;\n        delete dataWithoutIds.fidjData;\n\n        let resultAsString = Session.write(Session.value(dataWithoutIds));\n        if (crypto) {\n            resultAsString = crypto.obj[crypto.method](resultAsString);\n            toStore.fidjDacr = resultAsString;\n        } else {\n            toStore.fidjData = resultAsString;\n        }\n\n        return new Promise((resolve, reject) => {\n            this.db.put(toStore, (err, response) => {\n                if (response && response.ok && response.id && response.rev) {\n                    this.dbRecordCount++;\n\n                    // propagate _rev & _id\n                    if (typeof data === 'object') {\n                        (data as any)._rev = response.rev;\n                        (data as any)._id = response.id;\n                        resolve(data);\n                    } else {\n                        resolve(response.id);\n                    }\n\n                } else {\n                    reject(new Error(500, err));\n                }\n            });\n        });\n    }\n\n    public remove(data_id: string): Promise<void | ErrorInterface> {\n\n        if (!this.db) {\n            return Promise.reject(new Error(408, 'need db'));\n        }\n\n        return new Promise((resolve, reject) => {\n            this.db.get(data_id)\n                .then((doc) => {\n                    doc._deleted = true;\n                    return this.db.put(doc);\n                })\n                .then((result) => {\n                    resolve();\n                })\n                .catch((err) => {\n                    reject(err);\n                });\n        });\n    }\n\n    public get(data_id: string, crypto?: SessionCryptoInterface): Promise<any | ErrorInterface> {\n\n        if (!this.db) {\n            return Promise.reject(new Error(408, 'Need db'));\n        }\n\n        return new Promise((resolve, reject) => {\n            this.db.get(data_id)\n                .then(row => {\n                    if (!!row && (!!row.fidjDacr || !!row.fidjData)) {\n                        let data = row.fidjDacr;\n                        if (crypto && data) {\n                            data = crypto.obj[crypto.method](data);\n                        } else if (row.fidjData) {\n                            data = JSON.parse(row.fidjData);\n                        }\n                        const resultAsJson = Session.extractJson(data);\n                        if (resultAsJson) {\n                            resultAsJson._id = row._id;\n                            resultAsJson._rev = row._rev;\n                            resolve(JSON.parse(JSON.stringify(resultAsJson)));\n                        } else {\n                            // row._deleted = true;\n                            this.remove(row._id);\n                            reject(new Error(400, 'Bad encoding'));\n                        }\n                    } else {\n                        reject(new Error(400, 'No data found'));\n                    }\n                })\n                .catch(err => reject(new Error(500, err)));\n        });\n    }\n\n    public getAll(crypto?: SessionCryptoInterface): Promise<Array<any> | ErrorInterface> {\n\n        if (!this.db || !(this.db as any).allDocs) {\n            return Promise.reject(new Error(408, 'Need a valid db'));\n        }\n\n        return new Promise((resolve, reject) => {\n            (this.db as any).allDocs({include_docs: true, descending: true})\n                .then(rows => {\n                    const all = [];\n                    rows.rows.forEach(row => {\n                        if (!!row && !!row.doc._id && (!!row.doc.fidjDacr || !!row.doc.fidjData)) {\n                            let data = row.doc.fidjDacr;\n                            if (crypto && data) {\n                                data = crypto.obj[crypto.method](data);\n                            } else if (row.doc.fidjData) {\n                                data = JSON.parse(row.doc.fidjData);\n                            }\n                            const resultAsJson = Session.extractJson(data);\n                            if (resultAsJson) {\n                                resultAsJson._id = row.doc._id;\n                                resultAsJson._rev = row.doc._rev;\n                                all.push(JSON.parse(JSON.stringify(resultAsJson)));\n                            } else {\n                                console.error('Bad encoding : delete row');\n                                // resultAsJson = {};\n                                // resultAsJson._id = row.doc._id;\n                                // resultAsJson._rev = row.doc._rev;\n                                // resultAsJson._deleted = true;\n                                // all.push(resultAsJson);\n                                this.remove(row.doc._id);\n                            }\n                        } else {\n                            console.error('Bad encoding');\n                        }\n                    });\n                    resolve(all);\n                })\n                .catch(err => reject(new Error(400, err)));\n        });\n    }\n\n    public isEmpty(): Promise<boolean | ErrorInterface> {\n\n        if (!this.db || !(this.db as any).allDocs) {\n            return Promise.reject(new Error(408, 'No db'));\n        }\n\n        return new Promise((resolve, reject) => {\n            (this.db as any).allDocs({\n                // filter:  (doc) => {\n                //    if (!self.connection.user || !self.connection.user._id) return doc;\n                //    if (doc.fidjUserId === self.connection.user._id) return doc;\n                // }\n            })\n                .then((response) => {\n                    if (!response) {\n                        reject(new Error(400, 'No response'));\n                    } else {\n                        this.dbRecordCount = response.total_rows;\n                        if (response.total_rows && response.total_rows > 0) {\n                            resolve(false);\n                        } else {\n                            resolve(true);\n                        }\n                    }\n                })\n                .catch((err) => reject(new Error(400, err)));\n        });\n    }\n\n    public info(): Promise<any> {\n        if (!this.db) {\n            return Promise.reject(new Error(408, 'No db'));\n        }\n        return this.db.info();\n    }\n\n    static write(item: any): string {\n        let value = 'null';\n        const t = typeof (item);\n        if (t === 'undefined') {\n            value = 'null';\n        } else if (value === null) {\n            value = 'null';\n        } else if (t === 'string') {\n            value = JSON.stringify({string: item})\n        } else if (t === 'number') {\n            value = JSON.stringify({number: item});\n        } else if (t === 'boolean') {\n            value = JSON.stringify({bool: item});\n        } else if (t === 'object') {\n            value = JSON.stringify({json: item});\n        }\n        return value;\n    }\n\n    static value(item: any): any {\n        let result = item;\n        if (typeof (item) !== 'object') {\n            // return item;\n        } else if ('string' in item) {\n            result = item.string;\n        } else if ('number' in item) {\n            result = item.number.valueOf();\n        } else if ('bool' in item) {\n            result = item.bool.valueOf();\n        } else if ('json' in item) {\n            result = item.json;\n            if (typeof (result) !== 'object') {\n                result = JSON.parse(result);\n            }\n        }\n        return result;\n    }\n\n    static extractJson(item: any): any {\n        let result = item;\n        if (!item) {\n            return null;\n        }\n        if (typeof (item) === 'object' && 'json' in item) {\n            result = item.json;\n        }\n        if (typeof (result) === 'string') {\n            result = JSON.parse(result);\n        }\n        if (typeof (result) === 'object' && 'json' in result) {\n            result = (result as any).json;\n        }\n        if (typeof result !== 'object') {\n            result = null;\n        }\n        return result;\n    }\n\n}\n","// import PouchDB from 'pouchdb';\n// import * as PouchDB from 'pouchdb/dist/pouchdb.js';\n// import PouchDB from 'pouchdb/dist/pouchdb.js';\nimport * as version from '../version';\nimport * as tools from '../tools';\nimport * as connection from '../connection';\nimport * as session from '../session';\nimport {\n    LoggerInterface,\n    ModuleServiceInitOptionsInterface,\n    ModuleServiceLoginOptionsInterface,\n    SdkInterface,\n    ErrorInterface, EndpointInterface, EndpointFilterInterface\n} from './interfaces';\nimport {SessionCryptoInterface} from '../session/session';\nimport {Error} from './error';\nimport {Ajax} from '../connection/ajax';\nimport {LoggerService} from './angular.service';\n\n// const PouchDB = window['PouchDB'] || require('pouchdb').default;\n\n/**\n * please use its angular.js or angular.io wrapper\n * usefull only for fidj dev team\n */\nexport class InternalService {\n\n    private sdk: SdkInterface;\n    private logger: LoggerInterface;\n    private promise: PromiseConstructor;\n    private storage: tools.LocalStorage;\n    private session: session.Session;\n    private connection: connection.Connection;\n\n    constructor(logger: LoggerInterface, promise: PromiseConstructor) {\n\n        this.sdk = {\n            org: 'fidj',\n            version: version.version,\n            prod: false\n        };\n        if (promise) {\n            this.promise = promise;\n        }\n        if (logger) {\n            this.logger = logger;\n        } else {\n            this.logger = new LoggerService();\n        }\n        this.logger.log('fidj.sdk.service : constructor');\n        this.storage = new tools.LocalStorage(window.localStorage, 'fidj.');\n        this.session = new session.Session();\n        this.connection = new connection.Connection(this.sdk, this.storage);\n    }\n\n    /**\n     * Init connection & session\n     * Check uri\n     * Done each app start\n     *\n     * @param options Optional settings\n     * @param options.fidjId  required use your customized endpoints\n     * @param options.fidjSalt required use your customized endpoints\n     * @param options.fidjVersion required use your customized endpoints\n     * @param options.devMode optional default false, use your customized endpoints\n     * @returns\n     */\n    public fidjInit(fidjId: string, options?: ModuleServiceInitOptionsInterface): Promise<void | ErrorInterface> {\n\n        const self = this;\n        /*\n        if (options && options.forcedEndpoint) {\n            this.fidjService.setAuthEndpoint(options.forcedEndpoint);\n        }\n        if (options && options.forcedDBEndpoint) {\n            this.fidjService.setDBEndpoint(options.forcedDBEndpoint);\n        }*/\n        if (options && options.logLevel) {\n            self.logger.setLevel(options.logLevel);\n        }\n\n        self.logger.log('fidj.sdk.service.fidjInit : ', options);\n        if (!fidjId) {\n            self.logger.error('fidj.sdk.service.fidjInit : bad init');\n            return self.promise.reject(new Error(400, 'Need a fidjId'));\n        }\n\n        self.sdk.prod = !options ? true : options.prod;\n        self.connection.fidjId = fidjId;\n        self.connection.fidjVersion = self.sdk.version;\n        self.connection.fidjCrypto = (!options || !options.hasOwnProperty('crypto')) ? true : options.crypto;\n\n        return new self.promise((resolve, reject) => {\n            self.connection.verifyConnectionStates()\n                .then(() => {\n\n                    let theBestUrl: any = self.connection.getApiEndpoints({filter: 'theBestOne'})[0];\n                    let theBestOldUrl: any = self.connection.getApiEndpoints({filter: 'theBestOldOne'})[0];\n                    const isLogin = self.fidjIsLogin();\n\n                    if (theBestUrl && theBestUrl.url) {\n                        theBestUrl = theBestUrl.url;\n                    }\n                    if (theBestOldUrl && theBestOldUrl.url) {\n                        theBestOldUrl = theBestOldUrl.url;\n                    }\n\n                    if (theBestUrl) {\n                        self.connection.setClient(new connection.Client(self.connection.fidjId, theBestUrl, self.storage, self.sdk));\n                        resolve();\n                    } else if (isLogin && theBestOldUrl) {\n                        self.connection.setClient(new connection.Client(self.connection.fidjId, theBestOldUrl, self.storage, self.sdk));\n                        resolve();\n                    } else {\n                        reject(new Error(404, 'Need one connection - or too old SDK version (check update)'));\n                    }\n\n                })\n                .catch((err) => {\n                    self.logger.error('fidj.sdk.service.fidjInit: ', err);\n                    reject(new Error(500, err.toString()));\n                });\n        });\n    };\n\n    /**\n     * Call it if fidjIsLogin() === false\n     * Erase all (db & storage)\n     *\n     * @param login\n     * @param password\n     * @returns\n     */\n    public fidjLogin(login: string, password: string): Promise<any | ErrorInterface> {\n        const self = this;\n        self.logger.log('fidj.sdk.service.fidjLogin');\n        if (!self.connection.isReady()) {\n            return self.promise.reject(new Error(404, 'Need an intialized FidjService'));\n        }\n\n        return new self.promise((resolve, reject) => {\n            self._removeAll()\n                .then(() => {\n                    return self.connection.verifyConnectionStates();\n                })\n                .then(() => {\n                    return self._createSession(self.connection.fidjId);\n                })\n                .then(() => {\n                    return self._loginInternal(login, password);\n                })\n                .then((user) => {\n                    self.connection.setConnection(user);\n                    self.session.sync(self.connection.getClientId())\n                        .then(() => resolve(self.connection.getUser()))\n                        .catch((err) => resolve(self.connection.getUser()));\n                })\n                .catch((err) => {\n                    self.logger.error('fidj.sdk.service.fidjLogin: ', err.toString());\n                    reject(err);\n                });\n        });\n    };\n\n    /**\n     *\n     * @param options\n     * @param options.accessToken optional\n     * @param options.idToken  optional\n     * @returns\n     */\n    public fidjLoginInDemoMode(options?: ModuleServiceLoginOptionsInterface): Promise<any | ErrorInterface> {\n        const self = this;\n\n        // generate one day tokens if not set\n        if (!options || !options.accessToken) {\n            const now = new Date();\n            now.setDate(now.getDate() + 1);\n            const tomorrow = now.getTime();\n            const payload = tools.Base64.encode(JSON.stringify({\n                roles: [],\n                message: 'demo',\n                apis: [],\n                endpoints: {},\n                dbs: [],\n                exp: tomorrow\n            }));\n            const jwtSign = tools.Base64.encode(JSON.stringify({}));\n            const token = jwtSign + '.' + payload + '.' + jwtSign;\n            options = {\n                accessToken: token,\n                idToken: token,\n                refreshToken: token\n            };\n        }\n\n        return new self.promise((resolve, reject) => {\n            self._removeAll()\n                .then(() => {\n                    return self._createSession(self.connection.fidjId);\n                })\n                .then(() => {\n                    self.connection.setConnectionOffline(options);\n                    resolve(self.connection.getUser());\n                })\n                .catch((err) => {\n                    self.logger.error('fidj.sdk.service.fidjLoginInDemoMode error: ', err);\n                    reject(err);\n                });\n        });\n    };\n\n    public fidjGetEndpoints(filter?: EndpointFilterInterface): Array<EndpointInterface> {\n\n        if (!filter) {\n            filter = {showBlocked: false};\n        }\n        let endpoints = JSON.parse(this.connection.getAccessPayload({endpoints: []})).endpoints;\n        if (!endpoints) {\n            return [];\n        }\n\n        endpoints = endpoints.filter((endpoint: EndpointInterface) => {\n            let ok = true;\n            if (ok && filter.key) {\n                ok = (endpoint.key === filter.key);\n            }\n            if (ok && !filter.showBlocked) {\n                ok = !endpoint.blocked;\n            }\n            return ok;\n        });\n        return endpoints;\n    };\n\n    public fidjRoles(): Array<string> {\n        return JSON.parse(this.connection.getIdPayload({roles: []})).roles;\n    };\n\n    public fidjMessage(): string {\n        return JSON.parse(this.connection.getIdPayload({message: ''})).message;\n    };\n\n    public fidjIsLogin(): boolean {\n        return this.connection.isLogin();\n    };\n\n    public fidjLogout(force?: boolean): Promise<void | ErrorInterface> {\n        const self = this;\n        if (!self.connection.getClient() && !force) {\n            return self._removeAll()\n                .then(() => {\n                    return this.session.create(self.connection.fidjId, true);\n                });\n        }\n\n        return self.connection.logout()\n            .then(() => {\n                return self._removeAll();\n            })\n            .catch(() => {\n                return self._removeAll();\n            })\n            .then(() => {\n                return this.session.create(self.connection.fidjId, true);\n            });\n    };\n\n    /**\n     * Synchronize DB\n     *\n     *\n     * @param fnInitFirstData a function with db as input and that return promise: call if DB is empty\n     * @param fnInitFirstData_Arg arg to set to fnInitFirstData()\n     * @returns  promise\n     */\n    public fidjSync(fnInitFirstData?, fnInitFirstData_Arg?): Promise<void | ErrorInterface> {\n        const self = this;\n        self.logger.log('fidj.sdk.service.fidjSync');\n        // if (!self.session.isReady()) {\n        //    return self.promise.reject('fidj.sdk.service.fidjSync : DB sync impossible. Did you login ?');\n        // }\n\n        const firstSync = (self.session.dbLastSync === null);\n\n        return new self.promise((resolve, reject) => {\n\n            self._createSession(self.connection.fidjId)\n                .then(() => {\n                    return self.session.sync(self.connection.getClientId());\n                })\n                .then(() => {\n                    self.logger.log('fidj.sdk.service.fidjSync resolved');\n                    return self.session.isEmpty();\n                })\n                .catch((err) => {\n                    self.logger.warn('fidj.sdk.service.fidjSync warn: ', err);\n                    return self.session.isEmpty();\n                })\n                .then((isEmpty) => {\n                    self.logger.log('fidj.sdk.service.fidjSync isEmpty : ', isEmpty, firstSync);\n\n                    return new self.promise((resolveEmpty, rejectEmptyNotUsed) => {\n                        if (isEmpty && firstSync && fnInitFirstData) {\n                            const ret = fnInitFirstData(fnInitFirstData_Arg);\n                            if (ret && ret['catch'] instanceof Function) {\n                                ret.then(resolveEmpty).catch(reject);\n                            }\n                            if (typeof ret === 'string') {\n                                self.logger.log(ret);\n                            }\n                        }\n                        resolveEmpty(); // self.connection.getUser());\n                    });\n                })\n                .then((info) => {\n                    self.logger.log('fidj.sdk.service.fidjSync fnInitFirstData resolved: ', info);\n                    self.session.dbLastSync = new Date().getTime();\n                    return self.session.info();\n                })\n                .then((result: any) => {\n                    self.session.dbRecordCount = 0;\n                    if (result && result.doc_count) {\n                        self.session.dbRecordCount = result.doc_count;\n                    }\n                    self.logger.log('fidj.sdk.service.fidjSync _dbRecordCount : ' + self.session.dbRecordCount);\n\n                    return self.connection.refreshConnection();\n                })\n                .then((user) => {\n                    resolve(); // self.connection.getUser()\n                })\n                .catch((err: ErrorInterface) => {\n                    // console.error(err);\n\n                    if (err && (err.code === 403 || err.code === 410)) {\n                        this.fidjLogout()\n                            .then(() => {\n                                reject({code: 403, reason: 'Synchronization unauthorized : need to login again.'});\n                            })\n                            .catch(() => {\n                                reject({code: 403, reason: 'Synchronization unauthorized : need to login again.'});\n                            });\n                    } else if (err && err.code) {\n                        // todo what to do with this err ?\n                        resolve();\n                    } else {\n                        const errMessage = 'Error during syncronisation: ' + err.toString();\n                        // self.logger.error(errMessage);\n                        reject({code: 500, reason: errMessage});\n                    }\n                })\n            ;\n        });\n    };\n\n    public fidjPutInDb(data: any): Promise<string | ErrorInterface> {\n        const self = this;\n        self.logger.log('fidj.sdk.service.fidjPutInDb: ', data);\n\n        if (!self.connection.getClientId()) {\n            return self.promise.reject(new Error(401, 'DB put impossible. Need a user logged in.'));\n        }\n        if (!self.session.isReady()) {\n            return self.promise.reject(new Error(400, 'Need to be synchronised.'));\n        }\n\n        let _id: string;\n        if (data && typeof data === 'object' && Object.keys(data).indexOf('_id')) {\n            _id = data._id;\n        }\n        if (!_id) {\n            _id = self._generateObjectUniqueId(self.connection.fidjId);\n        }\n        let crypto: SessionCryptoInterface;\n        if (self.connection.fidjCrypto) {\n            crypto = {\n                obj: self.connection,\n                method: 'encrypt'\n            }\n        }\n\n        return self.session.put(\n            data,\n            _id,\n            self.connection.getClientId(),\n            self.sdk.org,\n            self.connection.fidjVersion,\n            crypto);\n    };\n\n    public fidjRemoveInDb(data_id: string): Promise<void | ErrorInterface> {\n        const self = this;\n        self.logger.log('fidj.sdk.service.fidjRemoveInDb ', data_id);\n\n        if (!self.session.isReady()) {\n            return self.promise.reject(new Error(400, 'Need to be synchronised.'));\n        }\n\n        if (!data_id || typeof data_id !== 'string') {\n            return self.promise.reject(new Error(400, 'DB remove impossible. ' +\n                'Need the data._id.'));\n        }\n\n        return self.session.remove(data_id);\n    };\n\n    public fidjFindInDb(data_id: string): Promise<any | ErrorInterface> {\n        const self = this;\n        if (!self.connection.getClientId()) {\n            return self.promise.reject(new Error(401, 'Find pb : need a user logged in.'));\n        }\n        if (!self.session.isReady()) {\n            return self.promise.reject(new Error(400, ' Need to be synchronised.'));\n        }\n\n        let crypto: SessionCryptoInterface;\n        if (self.connection.fidjCrypto) {\n            crypto = {\n                obj: self.connection,\n                method: 'decrypt'\n            };\n        }\n\n        return self.session.get(data_id, crypto);\n    };\n\n    public fidjFindAllInDb(): Promise<Array<any> | ErrorInterface> {\n        const self = this;\n\n        if (!self.connection.getClientId()) {\n            return self.promise.reject(new Error(401, 'Need a user logged in.'));\n        }\n        if (!self.session.isReady()) {\n            return self.promise.reject(new Error(400, 'Need to be synchronised.'));\n        }\n\n        let crypto: SessionCryptoInterface;\n        if (self.connection.fidjCrypto) {\n            crypto = {\n                obj: self.connection,\n                method: 'decrypt'\n            };\n        }\n\n        return self.session.getAll(crypto)\n            .then(results => {\n                self.connection.setCryptoSaltAsVerified();\n                return self.promise.resolve((results as Array<any>));\n            });\n    };\n\n    public fidjPostOnEndpoint(key: string, data?: any): Promise<any | ErrorInterface> {\n        const filter: EndpointFilterInterface = {\n            key: key\n        };\n        const endpoints = this.fidjGetEndpoints(filter);\n        if (!endpoints || endpoints.length !== 1) {\n            return this.promise.reject(\n                new Error(400,\n                    'fidj.sdk.service.fidjPostOnEndpoint : endpoint does not exist.'));\n        }\n\n        const endpointUrl = endpoints[0].url;\n        const jwt = this.connection.getIdToken();\n        return new Ajax()\n            .post({\n                url: endpointUrl,\n                // not used : withCredentials: true,\n                headers: {\n                    'Content-Type': 'application/json',\n                    'Accept': 'application/json',\n                    'Authorization': 'Bearer ' + jwt\n                },\n                data: data\n            });\n    };\n\n    public fidjGetIdToken(): string {\n        return this.connection.getIdToken();\n    };\n\n    // Internal functions\n\n    /**\n     * Logout then Login\n     *\n     * @param login\n     * @param password\n     * @param updateProperties\n     */\n    private _loginInternal(login: string, password: string, updateProperties?: any): Promise<any | ErrorInterface> {\n        const self = this;\n        self.logger.log('fidj.sdk.service._loginInternal');\n        if (!self.connection.isReady()) {\n            return self.promise.reject(new Error(403, 'Need an intialized FidjService'));\n        }\n\n        return new self.promise((resolve, reject) => {\n\n                self.connection.logout()\n                    .then(() => {\n                        return self.connection.getClient().login(login, password, updateProperties);\n                    })\n                    .catch((err) => {\n                        return self.connection.getClient().login(login, password, updateProperties);\n                    })\n                    .then(loginUser => {\n                        loginUser.email = login;\n                        resolve(loginUser);\n                    })\n                    .catch(err => {\n                        self.logger.error('fidj.sdk.service._loginInternal error : ' + err);\n                        reject(err);\n                    });\n            }\n        );\n    };\n\n    protected _removeAll(): Promise<void | ErrorInterface> {\n        this.connection.destroy();\n        return this.session.destroy();\n    };\n\n    private _createSession(uid: string): Promise<void | ErrorInterface> {\n        const dbs: EndpointInterface[] = this.connection.getDBs({filter: 'theBestOnes'});\n        if (!dbs || dbs.length === 0) {\n            this.logger.warn('Seems that you are in demo mode, no remote DB.');\n        }\n        this.session.setRemote(dbs);\n        return this.session.create(uid);\n    };\n\n    private _testPromise(a?): Promise<any> {\n        if (a) {\n            return this.promise.resolve('test promise ok ' + a);\n        }\n        return new this.promise((resolve, reject) => {\n            resolve('test promise ok');\n        });\n    };\n\n    private static _srvDataUniqId = 0;\n\n    private _generateObjectUniqueId(appName, type?, name?) {\n\n        // return null;\n        const now = new Date();\n        const simpleDate = '' + now.getFullYear() + '' + now.getMonth() + '' + now.getDate()\n            + '' + now.getHours() + '' + now.getMinutes(); // new Date().toISOString();\n        const sequId = ++InternalService._srvDataUniqId;\n        let UId = '';\n        if (appName && appName.charAt(0)) {\n            UId += appName.charAt(0) + '';\n        }\n        if (type && type.length > 3) {\n            UId += type.substring(0, 4);\n        }\n        if (name && name.length > 3) {\n            UId += name.substring(0, 4);\n        }\n        UId += simpleDate + '' + sequId;\n        return UId;\n    }\n\n}\n","import {Injectable} from '@angular/core';\nimport {\n    LoggerInterface, ModuleServiceInterface, ModuleServiceInitOptionsInterface, ModuleServiceLoginOptionsInterface,\n    ErrorInterface, EndpointInterface, LoggerLevelEnum\n} from './interfaces';\nimport {InternalService} from './internal.service';\nimport {Error as FidjError} from '../connection';\n\n/**\n * Angular2+ FidjService\n * @see ModuleServiceInterface\n *\n * @exemple\n *      // ... after install :\n *      // $ npm install --save-dev fidj\n *      // then init your app.js & use it in your services\n *\n * <script src=\"https://gist.githubusercontent.com/mlefree/ad64f7f6a345856f6bf45fd59ca8db46/raw/5fff69dd9c15f692a856db62cf334b724ef3f4ac/angular.fidj.inject.js\"></script>\n *\n * <script src=\"https://gist.githubusercontent.com/mlefree/ad64f7f6a345856f6bf45fd59ca8db46/raw/5fff69dd9c15f692a856db62cf334b724ef3f4ac/angular.fidj.sync.js\"></script>\n *\n *\n */\n@Injectable()\nexport class FidjService implements ModuleServiceInterface {\n\n    private logger: LoggerInterface;\n    private fidjService: InternalService;\n    private promise: any;\n\n    constructor() {\n        this.logger = new LoggerService();\n        this.promise = Promise;\n        this.fidjService = null;\n        // let pouchdbRequired = PouchDB;\n        // pouchdbRequired.error();\n    };\n\n    public init(fidjId, options?: ModuleServiceInitOptionsInterface): Promise<void | ErrorInterface> {\n        if (!this.fidjService) {\n            this.fidjService = new InternalService(this.logger, this.promise);\n        }\n        return this.fidjService.fidjInit(fidjId, options);\n    };\n\n    public login(login, password): Promise<any | ErrorInterface> {\n        if (!this.fidjService) {\n            return this.promise.reject(new FidjError(303, 'fidj.sdk.angular2.login : not initialized.'));\n        }\n        return this.fidjService.fidjLogin(login, password);\n    };\n\n    public loginAsDemo(options?: ModuleServiceLoginOptionsInterface): Promise<any | ErrorInterface> {\n        if (!this.fidjService) {\n            return this.promise.reject(new FidjError(303, 'fidj.sdk.angular2.loginAsDemo : not initialized.'));\n        }\n        return this.fidjService.fidjLoginInDemoMode(options);\n    };\n\n    public isLoggedIn(): boolean {\n        if (!this.fidjService) {\n            return false; // this.promise.reject('fidj.sdk.angular2.isLoggedIn : not initialized.');\n        }\n        return this.fidjService.fidjIsLogin();\n    };\n\n    public getRoles(): Array<string> {\n        if (!this.fidjService) {\n            return [];\n        }\n        return this.fidjService.fidjRoles();\n    };\n\n    public getEndpoints(): Array<EndpointInterface> {\n        if (!this.fidjService) {\n            return [];\n        }\n        return this.fidjService.fidjGetEndpoints();\n    };\n\n    public postOnEndpoint(key: string, data: any): Promise<any | ErrorInterface> {\n        if (!this.fidjService) {\n            return this.promise.reject(new FidjError(303, 'fidj.sdk.angular2.loginAsDemo : not initialized.'));\n        }\n        return this.fidjService.fidjPostOnEndpoint(key, data);\n    };\n\n    public getIdToken(): string {\n        if (!this.fidjService) {\n            return;\n        }\n        return this.fidjService.fidjGetIdToken();\n    };\n\n    public getMessage(): string {\n        if (!this.fidjService) {\n            return '';\n        }\n        return this.fidjService.fidjMessage();\n    };\n\n    public logout(force?: boolean): Promise<void | ErrorInterface> {\n        if (force || !this.fidjService) {\n            return this.promise.reject(new FidjError(303, 'fidj.sdk.angular2.logout : not initialized.'));\n        }\n        return this.fidjService.fidjLogout(force);\n    };\n\n    /**\n     *\n     * Synchronize DB\n     * @param fnInitFirstData  a function with db as input and that return promise: call if DB is empty\n     * @returns promise with this.session.db\n     * @memberof fidj.angularService\n     *\n     * @example\n     *  let initDb = function() {\n     *     this.fidjService.put('my first row');\n     *  };\n     *  this.fidjService.sync(initDb)\n     *  .then(user => ...)\n     *  .catch(err => ...)\n     *\n     */\n    public sync(fnInitFirstData?): Promise<void | ErrorInterface> {\n        if (!this.fidjService) {\n            return this.promise.reject(new FidjError(401, 'fidj.sdk.angular2.sync : not initialized.'));\n        }\n        return this.fidjService.fidjSync(fnInitFirstData, this);\n    };\n\n    /**\n     * Store data in your session\n     *\n     * @param data to store\n     * @returns\n     */\n    public put(data: any): Promise<string | ErrorInterface> {\n        if (!this.fidjService) {\n            return this.promise.reject(new FidjError(401, 'fidj.sdk.angular2.put : not initialized.'));\n        }\n        return this.fidjService.fidjPutInDb(data);\n    };\n\n    /**\n     * Find object Id and remove it from your session\n     *\n     * @param id of object to find and remove\n     * @returns\n     */\n    public remove(id: string): Promise<void | ErrorInterface> {\n        if (!this.fidjService) {\n            return this.promise.reject(new FidjError(401, 'fidj.sdk.angular2.remove : not initialized.'));\n        }\n        return this.fidjService.fidjRemoveInDb(id);\n    };\n\n    /**\n     * Find\n     */\n    public find(id: string): Promise<any | ErrorInterface> {\n        if (!this.fidjService) {\n            return this.promise.reject(new FidjError(401, 'fidj.sdk.angular2.find : not initialized.'));\n        }\n        return this.fidjService.fidjFindInDb(id);\n    };\n\n    public findAll(): Promise<any[] | ErrorInterface> {\n        if (!this.fidjService) {\n            return this.promise.reject(new FidjError(401, 'fidj.sdk.angular2.findAll : not initialized.'));\n        }\n        return this.fidjService.fidjFindAllInDb();\n    };\n\n}\n\nexport class LoggerService implements LoggerInterface {\n\n    constructor(private level?: LoggerLevelEnum) {\n        if (!level) {\n            this.level = LoggerLevelEnum.ERROR;\n        }\n\n        if (!window.console) {\n            this.level = LoggerLevelEnum.NONE;\n        }\n    }\n\n    log(message: string, args: [any]) {\n        if (this.level === LoggerLevelEnum.LOG) {\n            console.log(message, args);\n        }\n    }\n\n    warn(message: string, args: [any]) {\n        if (this.level === LoggerLevelEnum.LOG || this.level === LoggerLevelEnum.WARN) {\n            console.warn(message, args);\n        }\n    }\n\n    error(message: string, args: [any]) {\n        if (this.level === LoggerLevelEnum.LOG || this.level === LoggerLevelEnum.WARN || this.level === LoggerLevelEnum.ERROR) {\n            console.error(message, args);\n        }\n    }\n\n    setLevel(level: LoggerLevelEnum) {\n        this.level = level;\n    }\n}\n\n","import {ModuleWithProviders, NgModule} from '@angular/core';\nimport {CommonModule} from '@angular/common';\nimport {FidjService} from './angular.service';\n\n\n/**\n * `NgModule` which provides associated services.\n *\n * ...\n *\n * @stable\n */\n@NgModule({\n    imports: [\n        CommonModule\n    ],\n    declarations: [],\n\n    exports: [],\n\n    providers: [FidjService]\n})\nexport class FidjModule {\n    constructor() {\n    }\n}\n\n\n/**\n * module FidjModule\n *\n * exemple\n *      // ... after install :\n *      // $ npm install fidj\n *      // then init your app.js & use it in your services\n *\n * <script src=\"https://gist.github.com/mlefree/ad64f7f6a345856f6bf45fd59ca8db46.js\"></script>\n *\n * <script src=\"https://gist.github.com/mlefree/ad64f7f6a345856f6bf45fd59ca8db46.js\"></script>\n */\n"]}