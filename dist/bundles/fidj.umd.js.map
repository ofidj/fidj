{"version":3,"file":"fidj.umd.js.map","sources":["ng://fidj/tools/base64.ts","ng://fidj/tools/storage.ts","ng://fidj/tools/xor.ts","ng://fidj/version/index.ts","ng://fidj/connection/xhrpromise.ts","ng://fidj/connection/ajax.ts","ng://fidj/connection/client.ts","ng://fidj/sdk/error.ts","ng://fidj/connection/connection.ts","ng://fidj/session/session.ts","ng://fidj/sdk/internal.service.ts","ng://fidj/sdk/angular.service.ts","ng://fidj/sdk/fidj.module.ts"],"sourcesContent":["export class Base64 {\n\n    constructor() {\n    };\n\n    /**\n     * Decodes string from Base64 string\n     */\n    public static encode(input: string): string {\n\n        if (!input) {\n            return null;\n        }\n\n        return btoa(encodeURIComponent(input).replace(/%([0-9A-F]{2})/g,\n            function toSolidBytes(match, p1) {\n                return String.fromCharCode(parseInt('0x' + p1, 16));\n            }));\n\n    }\n\n    public static decode(input: string): string {\n\n        if (!input) {\n            return null;\n        }\n\n        return decodeURIComponent(atob(input).split('').map((c) => {\n            return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);\n        }).join(''));\n\n    }\n}\n","/**\n * localStorage class factory\n * Usage : var LocalStorage = fidj.LocalStorageFactory(window.localStorage); // to create a new class\n * Usage : var localStorageService = new LocalStorage(); // to create a new instance\n */\nexport class LocalStorage {\n\n    public version = '0.1';\n    private storage;\n\n    // Constructor\n    constructor(storageService, private storageKey) {\n        this.storage = storageService || window.localStorage;\n        if (!this.storage) {\n            throw new Error('fidj.LocalStorageFactory needs a storageService!');\n        }\n        // todo LocalStorage refacto\n        //            if (!fidj.Xml) {\n        //                throw new Error('fidj.Xml needs to be loaded before fidj.LocalStorage!');\n        //            }\n        //            if (!fidj.Json) {\n        //                throw new Error('fidj.Json needs to be loaded before fidj.LocalStorage!');\n        //            }\n        //            if (!fidj.Xml.isXml || !fidj.Xml.xml2String || !fidj.Xml.string2Xml) {\n        //                throw new Error('fidj.Xml with isXml(), xml2String()\n        // and string2Xml() needs to be loaded before fidj.LocalStorage!');\n        //            }\n        //            if (!fidj.Json.object2String || !fidj.Json.string2Object) {\n        //                throw new Error('fidj.Json with object2String()\n        // and string2Object() needs to be loaded before fidj.LocalStorage!');\n        //            }\n        //\n    }\n\n    // Public API\n\n    /**\n     * Sets a key's value.\n     *\n     * @param key - Key to set. If this value is not set or not\n     *              a string an exception is raised.\n     * @param value - Value to set. This can be any value that is JSON\n     *              compatible (Numbers, Strings, Objects etc.).\n     * @returns the stored value which is a container of user value.\n     */\n    set(key: string, value) {\n\n        key = this.storageKey + key;\n        this.checkKey(key);\n        // clone the object before saving to storage\n        const t = typeof(value);\n        if (t === 'undefined') {\n            value = 'null';\n        } else if (value === null) {\n            value = 'null';\n        } else if (t === 'string') {\n            value = JSON.stringify({string: value})\n        } else if (t === 'number') {\n            value = JSON.stringify({number: value});\n        } else if (t === 'boolean') {\n            value = JSON.stringify({bool: value});\n        } else if (t === 'object') {\n            value = JSON.stringify({json: value});\n        } else {\n            // reject and do not insert\n            // if (typeof value == \"function\") for example\n            throw new TypeError('Value type ' + t + ' is invalid. It must be null, undefined, xml, string, number, boolean or object');\n        }\n        this.storage.setItem(key, value);\n        return value;\n    };\n\n    /**\n     * Looks up a key in cache\n     *\n     * @param key - Key to look up.\n     * @param def - Default value to return, if key didn't exist.\n     * @returns the key value, default value or <null>\n     */\n    get(key: string, def?) {\n        key = this.storageKey + key;\n        this.checkKey(key);\n        const item = this.storage.getItem(key);\n        if (item !== null) {\n            if (item === 'null') {\n                return null;\n            }\n            const value = JSON.parse(item);\n\n            // var value = fidj.Json.string2Object(item);\n            // if ('xml' in value) {\n            //     return fidj.Xml.string2Xml(value.xml);\n            // } else\n            if ('string' in value) {\n                return value.string;\n            } else if ('number' in value) {\n                return value.number.valueOf();\n            } else if ('bool' in value) {\n                return value.bool.valueOf();\n            } else {\n                return value.json;\n            }\n        }\n        return !def ? null : def;\n    };\n\n    /**\n     * Deletes a key from cache.\n     *\n     * @param  key - Key to delete.\n     * @returns true if key existed or false if it didn't\n     */\n    remove(key: string) {\n        key = this.storageKey + key;\n        this.checkKey(key);\n        const existed = (this.storage.getItem(key) !== null);\n        this.storage.removeItem(key);\n        return existed;\n    };\n\n    /**\n     * Deletes everything in cache.\n     *\n     * @return true\n     */\n    clear() {\n        const existed = (this.storage.length > 0);\n        this.storage.clear();\n        return existed;\n    };\n\n    /**\n     * How much space in bytes does the storage take?\n     *\n     * @returns Number\n     */\n    size() {\n        return this.storage.length;\n    };\n\n    /**\n     * Call function f on the specified context for each element of the storage\n     * from index 0 to index length-1.\n     * WARNING : You should not modify the storage during the loop !!!\n     *\n     * @param f - Function to call on every item.\n     * @param  context - Context (this for example).\n     * @returns Number of items in storage\n     */\n    foreach(f, context) {\n        const n = this.storage.length;\n        for (let i = 0; i < n; i++) {\n            const key = this.storage.key(i);\n            const value = this.get(key);\n            if (context) {\n                // f is an instance method on instance context\n                f.call(context, value);\n            } else {\n                // f is a function or class method\n                f(value);\n            }\n        }\n        return n;\n    };\n\n    // Private API\n    // helper functions and variables hidden within this function scope\n\n    private checkKey(key) {\n        if (!key || (typeof key !== 'string')) {\n            throw new TypeError('Key type must be string');\n        }\n        return true;\n    }\n}\n","import {Base64} from './base64';\n\nexport class Xor {\n\n    static header = 'artemis-lotsum';\n\n    constructor() {\n    };\n\n\n    public static encrypt(value: string, key: string): string {\n\n        let result = '';\n\n        value = Xor.header + value;\n\n        for (let i = 0; i < value.length; i++) {\n            result += String.fromCharCode((value[i].charCodeAt(0).toString(10) as any) ^ Xor.keyCharAt(key, i));\n        }\n        result = Base64.encode(result);\n        return result;\n    };\n\n    public static decrypt(value: string, key: string, oldStyle?: boolean): string {\n        let result = '';\n        value = Base64.decode(value);\n        for (let i = 0; i < value.length; i++) {\n            result += String.fromCharCode((value[i].charCodeAt(0).toString(10) as any) ^ Xor.keyCharAt(key, i));\n        }\n\n        if (!oldStyle && Xor.header !== result.substring(0, Xor.header.length)) {\n            return null;\n        }\n\n        if (!oldStyle) {\n            result = result.substring(Xor.header.length);\n        }\n        return result;\n    }\n\n    public static keyCharAt(key, i) {\n        return key[Math.floor(i % key.length)].charCodeAt(0).toString(10);\n    }\n\n\n}\n","// bumped version via gulp\nexport const version = '2.1.12';\n","export class XHRPromise {\n\n    public DEFAULT_CONTENT_TYPE = 'application/x-www-form-urlencoded; charset=UTF-8';\n    private _xhr;\n    private _unloadHandler: any;\n\n    constructor() {\n    };\n\n    /*\n     * XHRPromise.send(options) -> Promise\n     * - options (Object): URL, method, data, etc.\n     *\n     * Create the XHR object and wire up event handlers to use a promise.\n     */\n    send(options): Promise<any> {\n        let defaults;\n        if (options == null) {\n            options = {};\n        }\n        defaults = {\n            method: 'GET',\n            data: null,\n            headers: {},\n            async: true,\n            username: null,\n            password: null,\n            withCredentials: false\n        };\n        options = Object.assign({}, defaults, options);\n        return new Promise(( (_this: XHRPromise) => {\n            return  (resolve, reject) => {\n                let e, header, ref, value, xhr;\n                if (!XMLHttpRequest) {\n                    _this._handleError('browser', reject, null, 'browser doesn\\'t support XMLHttpRequest');\n                    return;\n                }\n                if (typeof options.url !== 'string' || options.url.length === 0) {\n                    _this._handleError('url', reject, null, 'URL is a required parameter');\n                    return;\n                }\n                _this._xhr = xhr = new XMLHttpRequest;\n                xhr.onload =  ()  => {\n                    let responseText;\n                    _this._detachWindowUnload();\n                    try {\n                        responseText = _this._getResponseText();\n                    } catch (_error) {\n                        _this._handleError('parse', reject, null, 'invalid JSON response');\n                        return;\n                    }\n                    return resolve({\n                        url: _this._getResponseUrl(),\n                        status: xhr.status,\n                        statusText: xhr.statusText,\n                        responseText: responseText,\n                        headers: _this._getHeaders(),\n                        xhr: xhr\n                    });\n                };\n                xhr.onerror =  () => {\n                    return _this._handleError('error', reject);\n                };\n                xhr.ontimeout =  () => {\n                    return _this._handleError('timeout', reject);\n                };\n                xhr.onabort =  () => {\n                    return _this._handleError('abort', reject);\n                };\n                _this._attachWindowUnload();\n                xhr.open(options.method, options.url, options.async, options.username, options.password);\n                if (options.withCredentials) {\n                    xhr.withCredentials = true;\n                }\n                if ((options.data != null) && !options.headers['Content-Type']) {\n                    options.headers['Content-Type'] = _this.DEFAULT_CONTENT_TYPE;\n                }\n                ref = options.headers;\n                for (header in ref) {\n                    if (ref.hasOwnProperty(header)) {\n                        value = ref[header];\n                        xhr.setRequestHeader(header, value);\n                    }\n                }\n                try {\n                    return xhr.send(options.data);\n                } catch (_error) {\n                    e = _error;\n                    return _this._handleError('send', reject, null, e.toString());\n                }\n            };\n        })(this));\n    };\n\n\n    /*\n     * XHRPromise.getXHR() -> XMLHttpRequest\n     */\n    getXHR() {\n        return this._xhr;\n    };\n\n\n    /*\n     * XHRPromise._attachWindowUnload()\n     *\n     * Fix for IE 9 and IE 10\n     * Internet Explorer freezes when you close a webpage during an XHR request\n     * https://support.microsoft.com/kb/2856746\n     *\n     */\n    private _attachWindowUnload() {\n        this._unloadHandler = this._handleWindowUnload.bind(this);\n        if ((window as any).attachEvent) {\n            return (window as any).attachEvent('onunload', this._unloadHandler);\n        }\n    };\n\n\n    /*\n     * XHRPromise._detachWindowUnload()\n     */\n    private _detachWindowUnload() {\n        if ((window as any).detachEvent) {\n            return (window as any).detachEvent('onunload', this._unloadHandler);\n        }\n    };\n\n\n    /*\n     * XHRPromise._getHeaders() -> Object\n     */\n    private _getHeaders() {\n        return this._parseHeaders(this._xhr.getAllResponseHeaders());\n    };\n\n\n    /*\n     * XHRPromise._getResponseText() -> Mixed\n     *\n     * Parses response text JSON if present.\n     */\n    private _getResponseText() {\n        let responseText;\n        responseText = typeof this._xhr.responseText === 'string' ? this._xhr.responseText : '';\n        switch ((this._xhr.getResponseHeader('Content-Type') || '').split(';')[0]) {\n            case 'application/json':\n            case 'text/javascript':\n                responseText = JSON.parse(responseText + '');\n        }\n        return responseText;\n    };\n\n\n    /*\n     * XHRPromise._getResponseUrl() -> String\n     *\n     * Actual response URL after following redirects.\n     */\n    private _getResponseUrl() {\n        if (this._xhr.responseURL != null) {\n            return this._xhr.responseURL;\n        }\n        if (/^X-Request-URL:/m.test(this._xhr.getAllResponseHeaders())) {\n            return this._xhr.getResponseHeader('X-Request-URL');\n        }\n        return '';\n    };\n\n\n    /*\n     * XHRPromise._handleError(reason, reject, status, statusText)\n     * - reason (String)\n     * - reject (Function)\n     * - status (String)\n     * - statusText (String)\n     */\n    private _handleError(reason, reject, status?, statusText?) {\n        this._detachWindowUnload();\n\n        // _this._handleError('browser', reject, null, 'browser doesn\\'t support XMLHttpRequest');\n        // _this._handleError('url', reject, null, 'URL is a required parameter');\n        // _this._handleError('parse', reject, null, 'invalid JSON response');\n        // return _this._handleError('error', reject);\n        // return _this._handleError('timeout', reject);\n        // return _this._handleError('abort', reject);\n        // return _this._handleError('send', reject, null, e.toString());\n        // console.log('_handleError:', reason, this._xhr.status);\n        let code = 404;\n        if (reason === 'timeout') {\n            code = 408;\n        } else if (reason === 'abort') {\n            code = 408;\n        }\n\n        return reject({\n            reason: reason,\n            status: status || this._xhr.status || code,\n            code: status || this._xhr.status || code,\n            statusText: statusText || this._xhr.statusText,\n            xhr: this._xhr\n        });\n    };\n\n\n    /*\n     * XHRPromise._handleWindowUnload()\n     */\n    private _handleWindowUnload() {\n        return this._xhr.abort();\n    };\n\n\n    private trim(str) {\n        return str.replace(/^\\s*|\\s*$/g, '');\n    }\n\n    private isArray(arg) {\n        return Object.prototype.toString.call(arg) === '[object Array]';\n    }\n\n\n    private forEach(list, iterator) {\n        if (toString.call(list) === '[object Array]') {\n            this.forEachArray(list, iterator, this)\n        } else if (typeof list === 'string') {\n            this.forEachString(list, iterator, this)\n        } else {\n            this.forEachObject(list, iterator, this)\n        }\n    }\n\n    private forEachArray(array, iterator, context) {\n        for (let i = 0, len = array.length; i < len; i++) {\n            if (array.hasOwnProperty(i)) {\n                iterator.call(context, array[i], i, array)\n            }\n        }\n    }\n\n    private forEachString(string, iterator, context) {\n        for (let i = 0, len = string.length; i < len; i++) {\n            // no such thing as a sparse string.\n            iterator.call(context, string.charAt(i), i, string)\n        }\n    }\n\n    private forEachObject(object, iterator, context) {\n        for (const k in object) {\n            if (object.hasOwnProperty(k)) {\n                iterator.call(context, object[k], k, object)\n            }\n        }\n    }\n\n    private _parseHeaders(headers) {\n        if (!headers) {\n            return {};\n        }\n\n        const result = {};\n\n        this.forEach(\n            this.trim(headers).split('\\n')\n            , (row) => {\n                const index = row.indexOf(':')\n                    , key = this.trim(row.slice(0, index)).toLowerCase()\n                    , value = this.trim(row.slice(index + 1));\n\n                if (typeof(result[key]) === 'undefined') {\n                    result[key] = value\n                } else if (this.isArray(result[key])) {\n                    result[key].push(value)\n                } else {\n                    result[key] = [result[key], value]\n                }\n            }\n        );\n\n        return result;\n    }\n\n\n}\n","import {XHRPromise} from './xhrpromise';\n\nexport interface XhrOptionsInterface {\n    url: string,\n    data?: any,\n    headers?: any,\n    async?: boolean,\n    username?: string,\n    password?: string,\n    withCredentials?: boolean\n}\n\nexport class Ajax {\n\n    // private static xhr: XHRPromise = new XHRPromise();\n    private xhr: XHRPromise;\n\n    constructor() {\n        this.xhr = new XHRPromise();\n    };\n\n    public post(args: XhrOptionsInterface): Promise<any> {\n\n        const opt: any = {\n            method: 'POST',\n            url: args.url,\n            data: JSON.stringify(args.data)\n        };\n        if (args.headers) {\n            opt.headers = args.headers;\n        }\n\n        return this.xhr\n            .send(opt)\n            .then(res => {\n                if (res.status &&\n                    (parseInt(res.status, 10) < 200 || parseInt(res.status, 10) >= 300)) {\n                    res.reason = 'status';\n                    res.code = parseInt(res.status, 10);\n                    return Promise.reject(res);\n                }\n                return Promise.resolve(res.responseText);\n            })\n            .catch(err => {\n\n                // _this._handleError('browser', reject, null, 'browser doesn\\'t support XMLHttpRequest');\n                // _this._handleError('url', reject, null, 'URL is a required parameter');\n                // _this._handleError('parse', reject, null, 'invalid JSON response');\n                // return _this._handleError('error', reject);\n                // return _this._handleError('timeout', reject);\n                // return _this._handleError('abort', reject);\n                // return _this._handleError('send', reject, null, e.toString());\n\n                // if (err.reason === 'timeout') {\n                //     err.code = 408;\n                // } else {\n                //     err.code = 404;\n                // }\n                return Promise.reject(err);\n            });\n    }\n\n    public put(args: XhrOptionsInterface): Promise<any> {\n        const opt: any = {\n            method: 'PUT',\n            url: args.url,\n            data: JSON.stringify(args.data)\n        };\n        if (args.headers) {\n            opt.headers = args.headers;\n        }\n        return this.xhr\n            .send(opt)\n            .then(res => {\n                if (res.status &&\n                    (parseInt(res.status, 10) < 200 || parseInt(res.status, 10) >= 300)) {\n                    res.reason = 'status';\n                    res.code = parseInt(res.status, 10);\n                    return Promise.reject(res);\n                }\n                return Promise.resolve(res.responseText);\n            })\n            .catch(err => {\n                // if (err.reason === 'timeout') {\n                //     err.code = 408;\n                // } else {\n                //     err.code = 404;\n                // }\n                return Promise.reject(err);\n            });\n    }\n\n    public delete(args: XhrOptionsInterface): Promise<any> {\n        const opt: any = {\n            method: 'DELETE',\n            url: args.url,\n            data: JSON.stringify(args.data)\n        };\n        if (args.headers) {\n            opt.headers = args.headers;\n        }\n        return this.xhr\n            .send(opt)\n            .then(res => {\n                if (res.status &&\n                    (parseInt(res.status, 10) < 200 || parseInt(res.status, 10) >= 300)) {\n                    res.reason = 'status';\n                    res.code = parseInt(res.status, 10);\n                    return Promise.reject(res);\n                }\n                return Promise.resolve(res.responseText);\n            })\n            .catch(err => {\n                // if (err.reason === 'timeout') {\n                //     err.code = 408;\n                // } else {\n                //     err.code = 404;\n                // }\n                return Promise.reject(err);\n            });\n    }\n\n    public get(args: XhrOptionsInterface): Promise<any> {\n        const opt: any = {\n            method: 'GET',\n            url: args.url\n        };\n        if (args.data) {\n            opt.data = args.data;\n        }\n        if (args.headers) {\n            opt.headers = args.headers;\n        }\n        return this.xhr\n            .send(opt)\n            .then(res => {\n                if (res.status &&\n                    (parseInt(res.status, 10) < 200 || parseInt(res.status, 10) >= 300)) {\n                    res.reason = 'status';\n                    res.code = parseInt(res.status, 10);\n                    return Promise.reject(res);\n                }\n                return Promise.resolve(res.responseText);\n            })\n            .catch(err => {\n                // if (err.reason === 'timeout') {\n                //     err.code = 408;\n                // } else {\n                //     err.code = 404;\n                // }\n                return Promise.reject(err);\n            });\n    }\n}\n","import {Ajax} from './ajax';\nimport {LocalStorage} from '../tools';\nimport {SdkInterface, ErrorInterface} from '../sdk/interfaces';\n\nexport class Client {\n\n    public clientId: string;\n    private clientUuid: string;\n    private clientInfo: string;\n    private refreshToken: string;\n    private static refreshCount = 0;\n    private static _clientUuid = 'v2.clientUuid';\n    private static _clientId = 'v2.clientId';\n    private static _refreshCount = 'v2.refreshCount';\n\n    constructor(private appId: string,\n                private URI: string,\n                private storage: LocalStorage,\n                private sdk: SdkInterface) {\n\n        let uuid: string = this.storage.get(Client._clientUuid) || 'uuid-' + Math.random();\n        let info = '_clientInfo'; // this.storage.get(Client._clientInfo);\n        if (window && window.navigator) {\n            info = window.navigator.appName + '@' + window.navigator.appVersion + '-' + window.navigator.userAgent;\n        }\n        if (window && window['device'] && window['device'].uuid) {\n            uuid = window['device'].uuid;\n        }\n        this.setClientUuid(uuid);\n        this.setClientInfo(info);\n        this.clientId = this.storage.get(Client._clientId);\n        Client.refreshCount = this.storage.get(Client._refreshCount) || 0;\n    };\n\n    public setClientId(value: string) {\n        this.clientId = '' + value;\n        this.storage.set(Client._clientId, this.clientId);\n    }\n\n    public setClientUuid(value: string) {\n        this.clientUuid = '' + value;\n        this.storage.set(Client._clientUuid, this.clientUuid);\n    }\n\n    public setClientInfo(value: string) {\n        this.clientInfo = '' + value;\n        // this.storage.set('clientInfo', this.clientInfo);\n    }\n\n    public login(login: string, password: string, updateProperties?: any): Promise<any | ErrorInterface> {\n\n        if (!this.URI) {\n            console.error('no api uri');\n            return Promise.reject({code: 408, reason: 'no-api-uri'});\n        }\n\n        const urlLogin = this.URI + '/users';\n        const dataLogin = {\n            name: login,\n            username: login,\n            email: login,\n            password: password\n        };\n\n        return new Ajax()\n            .post({\n                url: urlLogin,\n                data: dataLogin,\n                headers: {'Content-Type': 'application/json', 'Accept': 'application/json'}\n            })\n            .then(createdUser => {\n\n                this.setClientId(createdUser._id);\n                const urlToken = this.URI + '/oauth/token';\n                const dataToken = {\n                    grant_type: 'client_credentials',\n                    client_id: this.clientId,\n                    client_secret: password,\n                    client_udid: this.clientUuid,\n                    client_info: this.clientInfo,\n                    audience: this.appId,\n                    scope: JSON.stringify(this.sdk)\n                };\n                return new Ajax()\n                    .post({\n                        url: urlToken,\n                        data: dataToken,\n                        headers: {'Content-Type': 'application/json', 'Accept': 'application/json'}\n                    });\n            });\n    }\n\n    public reAuthenticate(refreshToken: string): Promise<any | ErrorInterface> {\n\n        if (!this.URI) {\n            console.error('no api uri');\n            return Promise.reject({code: 408, reason: 'no-api-uri'});\n        }\n\n        const url = this.URI + '/oauth/token';\n        const data = {\n            grant_type: 'refresh_token',\n            client_id: this.clientId,\n            client_udid: this.clientUuid,\n            client_info: this.clientInfo,\n            audience: this.appId,\n            scope: JSON.stringify(this.sdk),\n            refresh_token: refreshToken,\n            refresh_extra: Client.refreshCount,\n        };\n\n        return new Ajax()\n            .post({\n                url: url,\n                data: data,\n                headers: {'Content-Type': 'application/json', 'Accept': 'application/json'}\n            })\n            .then((obj: any) => {\n                Client.refreshCount++;\n                this.storage.set(Client._refreshCount, Client.refreshCount);\n                return Promise.resolve(obj);\n            });\n    }\n\n    public logout(refreshToken?: string): Promise<void | ErrorInterface> {\n\n        if (!this.URI) {\n            console.error('no api uri');\n            return Promise.reject({code: 408, reason: 'no-api-uri'});\n        }\n\n        // delete this.clientUuid;\n        // delete this.clientId;\n        // this.storage.remove(Client._clientUuid);\n        this.storage.remove(Client._clientId);\n        this.storage.remove(Client._refreshCount);\n        Client.refreshCount = 0;\n\n        if (!refreshToken || !this.clientId) {\n            return Promise.resolve();\n        }\n\n        const url = this.URI + '/oauth/revoke';\n        const data = {\n            token: refreshToken,\n            client_id: this.clientId,\n            client_udid: this.clientUuid,\n            client_info: this.clientInfo,\n            audience: this.appId,\n            scope: JSON.stringify(this.sdk)\n        };\n\n        return new Ajax()\n            .post({\n                url: url,\n                data: data,\n                headers: {'Content-Type': 'application/json', 'Accept': 'application/json'}\n            });\n    }\n\n    public isReady(): boolean {\n        return !!this.URI;\n    }\n}\n","import {ErrorInterface} from './interfaces';\n\nexport class Error implements ErrorInterface {\n\n    constructor(public code: number, public reason: string) {\n    };\n\n    equals(err: Error) {\n        return this.code === err.code && this.reason === err.reason;\n    }\n\n    toString(): string {\n        const msg: string = (typeof this.reason === 'string') ? this.reason : JSON.stringify(this.reason);\n        return '' + this.code + ' - ' + msg;\n    }\n\n}\n","import {Client} from './client';\nimport {ModuleServiceLoginOptionsInterface, SdkInterface, ErrorInterface, EndpointInterface} from '../sdk/interfaces';\nimport {Base64, LocalStorage, Xor} from '../tools';\nimport {Ajax} from './ajax';\nimport {ConnectionFindOptionsInterface} from './interfaces';\n\nexport class Connection {\n\n    public fidjId: string;\n    public fidjVersion: string;\n    public fidjCrypto: boolean;\n    public accessToken: string;\n    public accessTokenPrevious: string;\n    public idToken: string;\n    public refreshToken: string;\n    public states: { [s: string]: { state: boolean, time: number, lastTimeWasOk: number }; }; // Map<string, boolean>;\n    public apis: Array<EndpointInterface>;\n\n    private cryptoSalt: string;\n    private cryptoSaltNext: string;\n    private client: Client;\n    private user: any;\n\n    private static _accessToken = 'v2.accessToken';\n    private static _accessTokenPrevious = 'v2.accessTokenPrevious';\n    private static _idToken = 'v2.idToken';\n    private static _refreshToken = 'v2.refreshToken';\n    private static _states = 'v2.states';\n    private static _cryptoSalt = 'v2.cryptoSalt';\n    private static _cryptoSaltNext = 'v2.cryptoSalt.next';\n\n    constructor(private _sdk: SdkInterface,\n                private _storage: LocalStorage) {\n        this.client = null;\n        this.user = null;\n        this.cryptoSalt = this._storage.get(Connection._cryptoSalt) || null;\n        this.cryptoSaltNext = this._storage.get(Connection._cryptoSaltNext) || null;\n        this.accessToken = this._storage.get(Connection._accessToken) || null;\n        this.accessTokenPrevious = this._storage.get('v2.accessTokenPrevious') || null;\n        this.idToken = this._storage.get(Connection._idToken) || null;\n        this.refreshToken = this._storage.get(Connection._refreshToken) || null;\n        this.states = this._storage.get(Connection._states) || {};\n        this.apis = [];\n    };\n\n    isReady(): boolean {\n        return !!this.client && this.client.isReady();\n    }\n\n    destroy(force?: boolean): void {\n\n        this._storage.remove(Connection._accessToken);\n        this._storage.remove(Connection._idToken);\n        this._storage.remove(Connection._refreshToken);\n        this._storage.remove(Connection._states);\n\n        if (this.accessToken) {\n            this.accessTokenPrevious = this.accessToken;\n            this._storage.set(Connection._accessTokenPrevious, this.accessTokenPrevious);\n        }\n\n        if (force) {\n            this._storage.remove(Connection._cryptoSalt);\n            this._storage.remove(Connection._cryptoSaltNext);\n            this._storage.remove(Connection._accessTokenPrevious);\n        }\n\n        this.user = null;\n        if (this.client) {\n            // this.client.setClientId(null);\n            this.client.logout();\n        }\n        this.accessToken = null;\n        this.idToken = null;\n        this.refreshToken = null;\n        this.states = {}; // new Map<string, boolean>();\n    }\n\n    setClient(client: Client): void {\n\n        this.client = client;\n        if (!this.user) {\n            this.user = {};\n        }\n\n        // this._user._id = this._client.clientId;\n        this.user._name = JSON.parse(this.getIdPayload({name: ''})).name;\n    }\n\n    setUser(user: any): void {\n        this.user = user;\n        if (this.user._id) {\n            this.client.setClientId(this.user._id);\n\n            // store only clientId\n            delete this.user._id;\n        }\n    }\n\n    getUser(): any {\n        return this.user;\n    }\n\n    getClient(): Client {\n        return this.client;\n    }\n\n    setCryptoSalt(value: string) {\n        if (this.cryptoSalt !== value && this.cryptoSaltNext !== value) {\n            this.cryptoSaltNext = value;\n            this._storage.set(Connection._cryptoSaltNext, this.cryptoSaltNext);\n        }\n\n        if (!this.cryptoSalt) {\n            this.setCryptoSaltAsVerified();\n        }\n    }\n\n    setCryptoSaltAsVerified() {\n        if (this.cryptoSaltNext) {\n            this.cryptoSalt = this.cryptoSaltNext;\n            this._storage.set(Connection._cryptoSalt, this.cryptoSalt);\n        }\n        this.cryptoSaltNext = null;\n        this._storage.remove(Connection._cryptoSaltNext);\n    }\n\n    encrypt(data: any): string {\n\n        if (typeof data !== 'string') {\n            data = JSON.stringify(data);\n        } else {\n            const dataAsObj = {string: data};\n            data = JSON.stringify(dataAsObj);\n        }\n\n        if (this.fidjCrypto && this.cryptoSalt) {\n            const key = this.cryptoSalt;\n            return Xor.encrypt(data, key);\n        } else {\n            return data;\n        }\n    }\n\n    decrypt(data: string): any {\n        let decrypted = null;\n\n        try {\n            if (!decrypted && this.fidjCrypto && this.cryptoSaltNext) {\n                const key = this.cryptoSaltNext;\n                decrypted = Xor.decrypt(data, key);\n                decrypted = JSON.parse(decrypted);\n                // if (decrypted) {\n                //    this.setCryptoSaltAsVerified();\n                // }\n            }\n        } catch (err) {\n            decrypted = null;\n        }\n\n        try {\n            if (!decrypted && this.fidjCrypto && this.cryptoSalt) {\n                const key = this.cryptoSalt;\n                decrypted = Xor.decrypt(data, key);\n                decrypted = JSON.parse(decrypted);\n            }\n        } catch (err) {\n            decrypted = null;\n        }\n\n        try {\n            if (!decrypted && this.fidjCrypto && this.cryptoSalt) {\n                const key = this.cryptoSalt;\n                decrypted = Xor.decrypt(data, key, true);\n                decrypted = JSON.parse(decrypted);\n            }\n        } catch (err) {\n            decrypted = null;\n        }\n\n\n        try {\n\n            if (!decrypted) {\n                decrypted = JSON.parse(data);\n            }\n\n            if (decrypted && decrypted.string) {\n                decrypted = decrypted.string;\n            }\n\n        } catch (err) {\n            decrypted = null;\n        }\n\n        return decrypted;\n    }\n\n    isLogin(): boolean {\n        let exp = true;\n        try {\n            const payload = this.refreshToken.split('.')[1];\n            const decoded = JSON.parse(Base64.decode(payload));\n            exp = ((new Date().getTime() / 1000) >= decoded.exp);\n\n        } catch (e) {\n        }\n        return !exp;\n    }\n\n    // todo reintegrate client.login()\n\n    logout(): Promise<void | ErrorInterface> {\n        return this.getClient().logout(this.refreshToken);\n    }\n\n    getClientId(): string {\n        if (!this.client) {\n            return null;\n        }\n        return this.client.clientId;\n    }\n\n    getIdToken(): string {\n        return this.idToken;\n    }\n\n    getIdPayload(def?: any): string {\n        if (def && typeof def !== 'string') {\n            def = JSON.stringify(def);\n        }\n\n        try {\n            const payload = this.getIdToken().split('.')[1];\n            if (payload) {\n                return Base64.decode(payload);\n            }\n        } catch (e) {\n        }\n        return def ? def : null;\n    }\n\n    getAccessPayload(def?: any): string {\n        if (def && typeof def !== 'string') {\n            def = JSON.stringify(def);\n        }\n\n        try {\n            const payload = this.accessToken.split('.')[1];\n            if (payload) {\n                return Base64.decode(payload);\n            }\n        } catch (e) {\n        }\n        return def ? def : null;\n    }\n\n    getPreviousAccessPayload(def?: any): string {\n        if (def && typeof def !== 'string') {\n            def = JSON.stringify(def);\n        }\n\n        try {\n            const payload = this.accessTokenPrevious.split('.')[1];\n            if (payload) {\n                return Base64.decode(payload);\n            }\n        } catch (e) {\n        }\n        return def ? def : null;\n    }\n\n    refreshConnection(): Promise<any | ErrorInterface> {\n\n        // store states\n        this._storage.set(Connection._states, this.states);\n\n        // token not expired : ok\n        if (this.accessToken) {\n            const payload = this.accessToken.split('.')[1];\n            const decoded = Base64.decode(payload);\n            // console.log('new Date().getTime() < JSON.parse(decoded).exp :', (new Date().getTime() / 1000), JSON.parse(decoded).exp);\n            if ((new Date().getTime() / 1000) < JSON.parse(decoded).exp) {\n                return Promise.resolve(this.getUser());\n            }\n        }\n\n        // remove expired refreshToken\n        if (this.refreshToken) {\n            const payload = this.refreshToken.split('.')[1];\n            const decoded = Base64.decode(payload);\n            if ((new Date().getTime() / 1000) >= JSON.parse(decoded).exp) {\n                this._storage.remove(Connection._refreshToken);\n            }\n        }\n\n        // remove expired accessToken & idToken & store it as Previous one\n        this.accessTokenPrevious = this.accessToken;\n        this._storage.set('v2.accessTokenPrevious', this.accessTokenPrevious);\n        this._storage.remove(Connection._accessToken);\n        this._storage.remove(Connection._idToken);\n        this.accessToken = null;\n        this.idToken = null;\n\n        // refresh authentication\n        return new Promise((resolve, reject) => {\n            this.getClient().reAuthenticate(this.refreshToken)\n                .then(user => {\n                    this.setConnection(user);\n                    resolve(this.getUser());\n                })\n                .catch(err => {\n\n                    // if (err && err.code === 408) {\n                    //     code = 408; // no api uri or basic timeout : offline\n                    // } else if (err && err.code === 404) {\n                    //     code = 404; // page not found : offline\n                    // } else if (err && err.code === 410) {\n                    //     code = 403; // token expired or device not sure : need relogin\n                    // } else if (err) {\n                    //     code = 403; // forbidden : need relogin\n                    // }\n\n                    // resolve(code);\n                    reject(err);\n                });\n        });\n    };\n\n    setConnection(clientUser: any): void {\n\n        // only in private storage\n        if (clientUser.access_token) {\n            this.accessToken = clientUser.access_token;\n            this._storage.set(Connection._accessToken, this.accessToken);\n            delete clientUser.access_token;\n\n            const salt: string = JSON.parse(this.getAccessPayload({salt: ''})).salt;\n            if (salt) {\n                this.setCryptoSalt(salt);\n            }\n        }\n        if (clientUser.id_token) {\n            this.idToken = clientUser.id_token;\n            this._storage.set(Connection._idToken, this.idToken);\n            delete clientUser.id_token;\n        }\n        if (clientUser.refresh_token) {\n            this.refreshToken = clientUser.refresh_token;\n            this._storage.set(Connection._refreshToken, this.refreshToken);\n            delete clientUser.refresh_token;\n        }\n\n        // store changed states\n        this._storage.set(Connection._states, this.states);\n\n        // expose roles, message\n        // clientUser.roles = self.fidjRoles();\n        // clientUser.message = self.fidjMessage();\n        clientUser.roles = JSON.parse(this.getIdPayload({roles: []})).roles;\n        clientUser.message = JSON.parse(this.getIdPayload({message: ''})).message;\n        this.setUser(clientUser);\n    };\n\n    setConnectionOffline(options: ModuleServiceLoginOptionsInterface): void {\n\n        if (options.accessToken) {\n            this.accessToken = options.accessToken;\n            this._storage.set(Connection._accessToken, this.accessToken);\n        }\n        if (options.idToken) {\n            this.idToken = options.idToken;\n            this._storage.set(Connection._idToken, this.idToken);\n        }\n        if (options.refreshToken) {\n            this.refreshToken = options.refreshToken;\n            this._storage.set(Connection._refreshToken, this.refreshToken);\n        }\n\n        this.setUser({\n            roles: JSON.parse(this.getIdPayload({roles: []})).roles,\n            message: JSON.parse(this.getIdPayload({message: ''})).message,\n            _id: 'demo'\n        });\n    }\n\n    getApiEndpoints(options?: ConnectionFindOptionsInterface): Array<EndpointInterface> {\n\n        // todo : let ea = ['https://fidj/api', 'https://fidj-proxy.herokuapp.com/api'];\n        let ea: EndpointInterface[] = [\n            {key: 'fidj.default', url: 'https://fidj.ovh/api', blocked: false}];\n        let filteredEa = [];\n\n        if (!this._sdk.prod) {\n            ea = [\n                {key: 'fidj.default', url: 'http://localhost:5894/api', blocked: false},\n                {key: 'fidj.default', url: 'https://fidj-sandbox.herokuapp.com/api', blocked: false}\n            ];\n        }\n\n        if (this.accessToken) {\n            const val = this.getAccessPayload({apis: []});\n            const apiEndpoints: EndpointInterface[] = JSON.parse(val).apis;\n            if (apiEndpoints && apiEndpoints.length) {\n                ea = [];\n                apiEndpoints.forEach((endpoint) => {\n                    if (endpoint.url) {\n                        ea.push(endpoint);\n                    }\n                });\n            }\n        }\n\n        if (this.accessTokenPrevious) {\n            const apiEndpoints: EndpointInterface[] = JSON.parse(this.getPreviousAccessPayload({apis: []})).apis;\n            if (apiEndpoints && apiEndpoints.length) {\n                apiEndpoints.forEach((endpoint) => {\n                    if (endpoint.url && ea.filter((r) => r.url === endpoint.url).length === 0) {\n                        ea.push(endpoint);\n                    }\n                });\n            }\n        }\n\n        let couldCheckStates = true;\n        if (this.states && Object.keys(this.states).length) {\n            for (let i = 0; (i < ea.length) && couldCheckStates; i++) {\n                if (!this.states[ea[i].url]) {\n                    couldCheckStates = false;\n                }\n            }\n        } else {\n            couldCheckStates = false;\n        }\n\n        if (options && options.filter) {\n\n            if (couldCheckStates && options.filter === 'theBestOne') {\n                for (let i = 0; (i < ea.length) && (filteredEa.length === 0); i++) {\n                    const endpoint = ea[i];\n                    if (this.states[endpoint.url] &&\n                        this.states[endpoint.url].state) {\n                        filteredEa.push(endpoint);\n                    }\n                }\n            } else if (couldCheckStates && options.filter === 'theBestOldOne') {\n                let bestOldOne: EndpointInterface;\n                for (let i = 0; (i < ea.length); i++) {\n                    const endpoint = ea[i];\n                    if (this.states[endpoint.url] &&\n                        this.states[endpoint.url].lastTimeWasOk &&\n                        (!bestOldOne || this.states[endpoint.url].lastTimeWasOk > this.states[bestOldOne.url].lastTimeWasOk)) {\n\n                        bestOldOne = endpoint;\n                    }\n                }\n                if (bestOldOne) {\n                    filteredEa.push(bestOldOne);\n                }\n            } else if (ea.length) {\n                filteredEa.push(ea[0]);\n            }\n        } else {\n            filteredEa = ea;\n        }\n\n        return filteredEa;\n    };\n\n    getDBs(options?: ConnectionFindOptionsInterface): EndpointInterface[] {\n\n        if (!this.accessToken) {\n            return [];\n        }\n\n        // todo test random DB connection\n        const random = Math.random() % 2;\n        let dbs = JSON.parse(this.getAccessPayload({dbs: []})).dbs || [];\n\n        // need to synchronize db\n        if (random === 0) {\n            dbs = dbs.sort();\n        } else if (random === 1) {\n            dbs = dbs.reverse();\n        }\n\n        let filteredDBs = [];\n        let couldCheckStates = true;\n        if (this.states && Object.keys(this.states).length) {\n            for (let i = 0; (i < dbs.length) && couldCheckStates; i++) {\n                if (!this.states[dbs[i].url]) {\n                    couldCheckStates = false;\n                }\n            }\n        } else {\n            couldCheckStates = false;\n        }\n\n        if (couldCheckStates && options && options.filter === 'theBestOne') {\n            for (let i = 0; (i < dbs.length) && (filteredDBs.length === 0); i++) {\n                const endpoint = dbs[i];\n                if (this.states[endpoint.url] &&\n                    this.states[endpoint.url].state) {\n                    filteredDBs.push(endpoint);\n                }\n            }\n        } else if (couldCheckStates && options && options.filter === 'theBestOnes') {\n            for (let i = 0; (i < dbs.length); i++) {\n                const endpoint = dbs[i];\n                if (this.states[endpoint.url] &&\n                    this.states[endpoint.url].state) {\n                    filteredDBs.push(endpoint);\n                }\n            }\n        } else if (options && options.filter === 'theBestOne' && dbs.length) {\n            filteredDBs.push(dbs[0]);\n        } else {\n            filteredDBs = dbs;\n        }\n\n        return filteredDBs;\n    };\n\n    verifyConnectionStates(): Promise<any | ErrorInterface> {\n\n        const currentTime = new Date().getTime();\n\n        // todo need verification ? not yet (cache)\n        // if (Object.keys(this.states).length > 0) {\n        //     const time = this.states[Object.keys(this.states)[0]].time;\n        //     if (currentTime < time) {\n        //         return Promise.resolve();\n        //     }\n        // }\n\n        // verify via GET status on Endpoints & DBs\n        const promises = [];\n        // this.states = {};\n        this.apis = this.getApiEndpoints();\n        this.apis.forEach((endpointObj) => {\n            let endpointUrl: string = endpointObj.url;\n            if (!endpointUrl) {\n                endpointUrl = endpointObj.toString();\n            }\n            promises.push(new Promise((resolve, reject) => {\n                new Ajax()\n                    .get({\n                        url: endpointUrl + '/status?isok=' + this._sdk.version,\n                        headers: {'Content-Type': 'application/json', 'Accept': 'application/json'}\n                    })\n                    .then(data => {\n                        let state = false;\n                        if (data && data.isok) {\n                            state = true;\n                        }\n                        this.states[endpointUrl] = {state: state, time: currentTime, lastTimeWasOk: currentTime};\n                        resolve();\n                    })\n                    .catch(err => {\n                        let lastTimeWasOk = 0;\n                        if (this.states[endpointUrl]) {\n                            lastTimeWasOk = this.states[endpointUrl].lastTimeWasOk;\n                        }\n                        this.states[endpointUrl] = {state: false, time: currentTime, lastTimeWasOk: lastTimeWasOk};\n                        resolve();\n                    });\n            }));\n        });\n\n        const dbs = this.getDBs();\n        dbs.forEach((dbEndpointObj) => {\n            let dbEndpoint: string = dbEndpointObj.url;\n            if (!dbEndpoint) {\n                dbEndpoint = dbEndpointObj.toString();\n            }\n            promises.push(new Promise((resolve, reject) => {\n                new Ajax()\n                    .get({\n                        url: dbEndpoint,\n                        headers: {'Content-Type': 'application/json', 'Accept': 'application/json'}\n                    })\n                    .then(data => {\n                        this.states[dbEndpoint] = {state: true, time: currentTime, lastTimeWasOk: currentTime};\n                        resolve();\n                    })\n                    .catch(err => {\n                        let lastTimeWasOk = 0;\n                        if (this.states[dbEndpoint]) {\n                            lastTimeWasOk = this.states[dbEndpoint].lastTimeWasOk;\n                        }\n                        this.states[dbEndpoint] = {state: false, time: currentTime, lastTimeWasOk: lastTimeWasOk};\n                        resolve();\n                    });\n            }));\n        });\n        return Promise.all(promises);\n    };\n\n}\n","// import PouchDB from 'pouchdb';\n// let PouchDB: any;\n\nimport PouchDB from 'pouchdb/dist/pouchdb.js';\nimport {Error} from '../sdk/error';\nimport {EndpointInterface, ErrorInterface} from '../sdk/interfaces';\n\nconst FidjPouch = window['PouchDB'] ? window['PouchDB'] : require('pouchdb').default; // .default;\n\n// load cordova adapter : https://github.com/pouchdb-community/pouchdb-adapter-cordova-sqlite/issues/22\nconst PouchAdapterCordovaSqlite = require('pouchdb-adapter-cordova-sqlite');\nFidjPouch.plugin(PouchAdapterCordovaSqlite);\n\nexport interface SessionCryptoInterface {\n    obj: Object,\n    method: string\n}\n\nexport class Session {\n\n    public dbRecordCount: number;\n    public dbLastSync: number; // Date().getTime();\n\n    private db: PouchDB; // PouchDB\n    private remoteDb: PouchDB; // PouchDB;\n    private remoteUri: string;\n    private dbs: Array<EndpointInterface>;\n\n    constructor() {\n        this.db = null;\n        this.dbRecordCount = 0;\n        this.dbLastSync = null;\n        this.remoteDb = null;\n        this.dbs = [];\n    };\n\n    public isReady(): boolean {\n        return !!this.db;\n    }\n\n\n    public create(uid: string, force?: boolean): Promise<void | ErrorInterface> {\n\n        if (!force && this.db) {\n            return Promise.resolve();\n        }\n\n        this.dbRecordCount = 0;\n        this.dbLastSync = null; // new Date().getTime();\n        this.db = null;\n\n        return new Promise((resolve, reject) => {\n\n            let opts: any = {location: 'default'};\n            try {\n                if (window['cordova']) {\n                    opts = {location: 'default', adapter: 'cordova-sqlite'};\n                    //    const plugin = require('pouchdb-adapter-cordova-sqlite');\n                    //    if (plugin) { Pouch.plugin(plugin); }\n                    //    this.db = new Pouch('fidj_db', {adapter: 'cordova-sqlite'});\n                }\n                // } else {\n                this.db = new FidjPouch('fidj_db_' + uid, opts); // , {adapter: 'websql'} ???\n                // }\n\n                this.db.info()\n                    .then((info) => {\n\n                        // todo if (info.adapter !== 'websql') {\n                        return resolve(this.db);\n                        // }\n\n                        // const newopts: any = opts || {};\n                        // newopts.adapter = 'idb';\n                        //\n                        // const newdb = new Pouch('fidj_db', opts);\n                        // this.db.replicate.to(newdb)\n                        //     .then(() => {\n                        //         this.db = newdb;\n                        //         resolve();\n                        //     })\n                        //     .catch((err) => {\n                        //         reject(new Error(400, err.toString()))\n                        //     });\n\n                    }).catch((err) => {\n                    reject(new Error(400, err))\n                });\n            } catch (err) {\n                reject(new Error(500, err));\n            }\n        });\n    }\n\n    public destroy(): Promise<void | ErrorInterface> {\n\n        if (!this.db) {\n            this.dbRecordCount = 0;\n            this.dbLastSync = null;\n            return Promise.resolve();\n        }\n\n        if (this.db && !this.db.destroy) {\n            return Promise.reject(new Error(408, 'Need a valid db'));\n        }\n\n        return new Promise((resolve, reject) => {\n            this.db.destroy((err, info) => {\n                if (err) {\n                    reject(new Error(500, err));\n                } else {\n                    this.dbRecordCount = 0;\n                    this.dbLastSync = null;\n                    this.db = null;\n                    resolve();\n                }\n            });\n        });\n    };\n\n    public setRemote(dbs: Array<EndpointInterface>): void {\n        this.dbs = dbs;\n    }\n\n    public sync(userId: string): Promise<void | ErrorInterface> {\n\n        if (!this.db) {\n            return Promise.reject(new Error(408, 'need db'));\n        }\n        if (!this.dbs || !this.dbs.length) {\n            return Promise.reject(new Error(408, 'need a remote db'));\n        }\n\n        return new Promise((resolve, reject) => {\n            try {\n\n                if (!this.remoteDb || this.remoteUri !== this.dbs[0].url) {\n                    this.remoteUri = this.dbs[0].url;\n                    this.remoteDb = new FidjPouch(this.remoteUri);\n                    // todo , {headers: {'Authorization': 'Bearer ' + id_token}});\n                }\n\n                this.db.replicate.to(this.remoteDb)\n                    .on('complete', (info) => {\n                        return this.remoteDb.replicate.to(this.db,\n                            {\n                                filter: (doc) => {\n                                    return (!!userId && !!doc && doc.fidjUserId === userId);\n                                }\n                            })\n                            .on('complete', () => {\n                                // this.logger\n                                resolve();\n                            })\n                            .on('denied', (err) => reject({code: 403, reason: err}))\n                            .on('error', (err) => reject({code: 401, reason: err}));\n\n                    })\n                    .on('denied', (err) => reject({code: 403, reason: err}))\n                    .on('error', (err) => reject({code: 401, reason: err}));\n\n            } catch (err) {\n                reject(new Error(500, err));\n            }\n        });\n    }\n\n    public put(data: any,\n               _id: string,\n               uid: string,\n               oid: string,\n               ave: string,\n               crypto?: SessionCryptoInterface): Promise<any | ErrorInterface> {\n\n        if (!this.db) {\n            return Promise.reject(new Error(408, 'need db'));\n        }\n\n        if (!data || !_id || !uid || !oid || !ave) {\n            return Promise.reject(new Error(400, 'need formated data'));\n        }\n\n        const dataWithoutIds = JSON.parse(JSON.stringify(data));\n        const toStore: any = {\n            _id: _id,\n            fidjUserId: uid,\n            fidjOrgId: oid,\n            fidjAppVersion: ave\n        };\n        if (dataWithoutIds._rev) {\n            toStore._rev = '' + dataWithoutIds._rev;\n        }\n        delete dataWithoutIds._id;\n        delete dataWithoutIds._rev;\n        delete dataWithoutIds.fidjUserId;\n        delete dataWithoutIds.fidjOrgId;\n        delete dataWithoutIds.fidjAppVersion;\n        delete dataWithoutIds.fidjData;\n\n        let resultAsString = Session.write(Session.value(dataWithoutIds));\n        if (crypto) {\n            resultAsString = crypto.obj[crypto.method](resultAsString);\n            toStore.fidjDacr = resultAsString;\n        } else {\n            toStore.fidjData = resultAsString;\n        }\n\n        return new Promise((resolve, reject) => {\n            this.db.put(toStore, (err, response) => {\n                if (response && response.ok && response.id && response.rev) {\n                    this.dbRecordCount++;\n\n                    // propagate _rev & _id\n                    if (typeof data === 'object') {\n                        (data as any)._rev = response.rev;\n                        (data as any)._id = response.id;\n                        resolve(data);\n                    } else {\n                        resolve(response.id);\n                    }\n\n                } else {\n                    reject(new Error(500, err));\n                }\n            });\n        });\n    }\n\n    public remove(data_id: string): Promise<void | ErrorInterface> {\n\n        if (!this.db) {\n            return Promise.reject(new Error(408, 'need db'));\n        }\n\n        return new Promise((resolve, reject) => {\n            this.db.get(data_id)\n                .then((doc) => {\n                    doc._deleted = true;\n                    return this.db.put(doc);\n                })\n                .then((result) => {\n                    resolve();\n                })\n                .catch((err) => {\n                    reject(err);\n                });\n        });\n    }\n\n    public get(data_id: string, crypto?: SessionCryptoInterface): Promise<any | ErrorInterface> {\n\n        if (!this.db) {\n            return Promise.reject(new Error(408, 'Need db'));\n        }\n\n        return new Promise((resolve, reject) => {\n            this.db.get(data_id)\n                .then(row => {\n                    if (!!row && (!!row.fidjDacr || !!row.fidjData)) {\n                        let data = row.fidjDacr;\n                        if (crypto && data) {\n                            data = crypto.obj[crypto.method](data);\n                        } else if (row.fidjData) {\n                            data = JSON.parse(row.fidjData);\n                        }\n                        const resultAsJson = Session.extractJson(data);\n                        if (resultAsJson) {\n                            resultAsJson._id = row._id;\n                            resultAsJson._rev = row._rev;\n                            resolve(JSON.parse(JSON.stringify(resultAsJson)));\n                        } else {\n                            // row._deleted = true;\n                            this.remove(row._id);\n                            reject(new Error(400, 'Bad encoding'));\n                        }\n                    } else {\n                        reject(new Error(400, 'No data found'));\n                    }\n                })\n                .catch(err => reject(new Error(500, err)));\n        });\n    }\n\n    public getAll(crypto?: SessionCryptoInterface): Promise<Array<any> | ErrorInterface> {\n\n        if (!this.db || !(this.db as any).allDocs) {\n            return Promise.reject(new Error(408, 'Need a valid db'));\n        }\n\n        return new Promise((resolve, reject) => {\n            (this.db as any).allDocs({include_docs: true, descending: true})\n                .then(rows => {\n                    const all = [];\n                    rows.rows.forEach(row => {\n                        if (!!row && !!row.doc._id && (!!row.doc.fidjDacr || !!row.doc.fidjData)) {\n                            let data = row.doc.fidjDacr;\n                            if (crypto && data) {\n                                data = crypto.obj[crypto.method](data);\n                            } else if (row.doc.fidjData) {\n                                data = JSON.parse(row.doc.fidjData);\n                            }\n                            const resultAsJson = Session.extractJson(data);\n                            if (resultAsJson) {\n                                resultAsJson._id = row.doc._id;\n                                resultAsJson._rev = row.doc._rev;\n                                all.push(JSON.parse(JSON.stringify(resultAsJson)));\n                            } else {\n                                console.error('Bad encoding : delete row');\n                                // resultAsJson = {};\n                                // resultAsJson._id = row.doc._id;\n                                // resultAsJson._rev = row.doc._rev;\n                                // resultAsJson._deleted = true;\n                                // all.push(resultAsJson);\n                                this.remove(row.doc._id);\n                            }\n                        } else {\n                            console.error('Bad encoding');\n                        }\n                    });\n                    resolve(all);\n                })\n                .catch(err => reject(new Error(400, err)));\n        });\n    }\n\n    public isEmpty(): Promise<boolean | ErrorInterface> {\n\n        if (!this.db || !(this.db as any).allDocs) {\n            return Promise.reject(new Error(408, 'No db'));\n        }\n\n        return new Promise((resolve, reject) => {\n            (this.db as any).allDocs({\n                // filter:  (doc) => {\n                //    if (!self.connection.user || !self.connection.user._id) return doc;\n                //    if (doc.fidjUserId === self.connection.user._id) return doc;\n                // }\n            })\n                .then((response) => {\n                    if (!response) {\n                        reject(new Error(400, 'No response'));\n                    } else {\n                        this.dbRecordCount = response.total_rows;\n                        if (response.total_rows && response.total_rows > 0) {\n                            resolve(false);\n                        } else {\n                            resolve(true);\n                        }\n                    }\n                })\n                .catch((err) => reject(new Error(400, err)));\n        });\n    }\n\n    public info(): Promise<any> {\n        if (!this.db) {\n            return Promise.reject(new Error(408, 'No db'));\n        }\n        return this.db.info();\n    }\n\n    static write(item: any): string {\n        let value = 'null';\n        const t = typeof(item);\n        if (t === 'undefined') {\n            value = 'null';\n        } else if (value === null) {\n            value = 'null';\n        } else if (t === 'string') {\n            value = JSON.stringify({string: item})\n        } else if (t === 'number') {\n            value = JSON.stringify({number: item});\n        } else if (t === 'boolean') {\n            value = JSON.stringify({bool: item});\n        } else if (t === 'object') {\n            value = JSON.stringify({json: item});\n        }\n        return value;\n    }\n\n    static value(item: any): any {\n        let result = item;\n        if (typeof(item) !== 'object') {\n            // return item;\n        } else if ('string' in item) {\n            result = item.string;\n        } else if ('number' in item) {\n            result = item.number.valueOf();\n        } else if ('bool' in item) {\n            result = item.bool.valueOf();\n        } else if ('json' in item) {\n            result = item.json;\n            if (typeof(result) !== 'object') {\n                result = JSON.parse(result);\n            }\n        }\n        return result;\n    }\n\n    static extractJson(item: any): any {\n        let result = item;\n        if (!item) {\n            return null;\n        }\n        if (typeof (item) === 'object' && 'json' in item) {\n            result = item.json;\n        }\n        if (typeof (result) === 'string') {\n            result = JSON.parse(result);\n        }\n        if (typeof (result) === 'object' && 'json' in result) {\n            result = (result as any).json;\n        }\n        if (typeof result !== 'object') {\n            result = null;\n        }\n        return result;\n    }\n\n}\n","// import PouchDB from 'pouchdb';\n// import * as PouchDB from 'pouchdb/dist/pouchdb.js';\n// import PouchDB from 'pouchdb/dist/pouchdb.js';\nimport * as version from '../version';\nimport * as tools from '../tools';\nimport * as connection from '../connection';\nimport * as session from '../session';\nimport {\n    LoggerInterface,\n    ModuleServiceInitOptionsInterface,\n    ModuleServiceLoginOptionsInterface,\n    SdkInterface,\n    ErrorInterface, EndpointInterface, EndpointFilterInterface\n} from './interfaces';\nimport {SessionCryptoInterface} from '../session/session';\nimport {Error} from './error';\nimport {Ajax} from '../connection/ajax';\n\n// const PouchDB = window['PouchDB'] || require('pouchdb').default;\n\n/**\n * please use its angular.js or angular.io wrapper\n * usefull only for fidj dev team\n */\nexport class InternalService {\n\n    private sdk: SdkInterface;\n    private logger: LoggerInterface;\n    private promise: PromiseConstructor;\n    private storage: tools.LocalStorage;\n    private session: session.Session;\n    private connection: connection.Connection;\n\n    constructor(logger: LoggerInterface, promise: PromiseConstructor) {\n\n        this.sdk = {\n            org: 'fidj',\n            version: version.version,\n            prod: false\n        };\n        this.logger = {\n            log: () => {\n            },\n            error: () => {\n            },\n            warn: () => {\n            }\n        };\n        if (logger && window.console && logger === window.console) {\n            this.logger.error = window.console.error;\n            this.logger.warn = window.console.warn;\n        }\n        this.logger.log('fidj.sdk.service : constructor');\n        if (promise) {\n            this.promise = promise;\n        }\n        this.storage = new tools.LocalStorage(window.localStorage, 'fidj.');\n        this.session = new session.Session();\n        this.connection = new connection.Connection(this.sdk, this.storage);\n    }\n\n    /**\n     * Init connection & session\n     * Check uri\n     * Done each app start\n     *\n     * @param options Optional settings\n     * @param options.fidjId  required use your customized endpoints\n     * @param options.fidjSalt required use your customized endpoints\n     * @param options.fidjVersion required use your customized endpoints\n     * @param options.devMode optional default false, use your customized endpoints\n     * @returns\n     */\n    public fidjInit(fidjId: string, options?: ModuleServiceInitOptionsInterface): Promise<void | ErrorInterface> {\n\n        const self = this;\n        self.logger.log('fidj.sdk.service.fidjInit : ', options);\n        if (!fidjId) {\n            self.logger.error('fidj.sdk.service.fidjInit : bad init');\n            return self.promise.reject(new Error(400, 'Need a fidjId'));\n        }\n\n        self.sdk.prod = !options ? true : options.prod;\n\n        return new self.promise((resolve, reject) => {\n            self.connection.verifyConnectionStates()\n                .then(() => {\n                    self.connection.fidjId = fidjId;\n                    self.connection.fidjVersion = self.sdk.version;\n                    self.connection.fidjCrypto = (!options || !options.hasOwnProperty('crypto')) ? true : options.crypto;\n\n                    let theBestUrl: any = self.connection.getApiEndpoints({filter: 'theBestOne'})[0];\n                    let theBestOldUrl: any = self.connection.getApiEndpoints({filter: 'theBestOldOne'})[0];\n                    const isLogin = self.fidjIsLogin();\n\n                    if (theBestUrl && theBestUrl.url) {\n                        theBestUrl = theBestUrl.url;\n                    }\n                    if (theBestOldUrl && theBestOldUrl.url) {\n                        theBestOldUrl = theBestOldUrl.url;\n                    }\n\n                    if (theBestUrl) {\n                        self.connection.setClient(new connection.Client(self.connection.fidjId, theBestUrl, self.storage, self.sdk));\n                        resolve();\n                    } else if (isLogin && theBestOldUrl) {\n                        self.connection.setClient(new connection.Client(self.connection.fidjId, theBestOldUrl, self.storage, self.sdk));\n                        resolve();\n                    } else {\n                        reject(new Error(404, 'Need one connection - or too old SDK version (check update)'));\n                    }\n\n                })\n                .catch((err) => {\n                    self.logger.error('fidj.sdk.service.fidjInit: ', err);\n                    reject(new Error(500, err.toString()));\n                });\n        });\n    };\n\n    /**\n     * Call it if fidjIsLogin() === false\n     * Erase all (db & storage)\n     *\n     * @param login\n     * @param password\n     * @returns\n     */\n    public fidjLogin(login: string, password: string): Promise<any | ErrorInterface> {\n        const self = this;\n        self.logger.log('fidj.sdk.service.fidjLogin');\n        if (!self.connection.isReady()) {\n            return self.promise.reject(new Error(404, 'Need an intialized FidjService'));\n        }\n\n        return new self.promise((resolve, reject) => {\n            self._removeAll()\n                .then(() => {\n                    return self.connection.verifyConnectionStates();\n                })\n                .then(() => {\n                    return self._createSession(self.connection.fidjId);\n                })\n                .then(() => {\n                    return self._loginInternal(login, password);\n                })\n                .then((user) => {\n                    self.connection.setConnection(user);\n                    self.session.sync(self.connection.getClientId())\n                        .then(() => resolve(self.connection.getUser()))\n                        .catch((err) => resolve(self.connection.getUser()));\n                })\n                .catch((err) => {\n                    self.logger.error('fidj.sdk.service.fidjLogin: ', err.toString());\n                    reject(err);\n                });\n        });\n    };\n\n    /**\n     *\n     * @param options\n     * @param options.accessToken optional\n     * @param options.idToken  optional\n     * @returns\n     */\n    public fidjLoginInDemoMode(options?: ModuleServiceLoginOptionsInterface): Promise<any | ErrorInterface> {\n        const self = this;\n\n        // generate one day tokens if not set\n        if (!options || !options.accessToken) {\n            const now = new Date();\n            now.setDate(now.getDate() + 1);\n            const tomorrow = now.getTime();\n            const payload = tools.Base64.encode(JSON.stringify({\n                roles: [],\n                message: 'demo',\n                apis: [],\n                endpoints: {},\n                dbs: [],\n                exp: tomorrow\n            }));\n            const jwtSign = tools.Base64.encode(JSON.stringify({}));\n            const token = jwtSign + '.' + payload + '.' + jwtSign;\n            options = {\n                accessToken: token,\n                idToken: token,\n                refreshToken: token\n            };\n        }\n\n        return new self.promise((resolve, reject) => {\n            self._removeAll()\n                .then(() => {\n                    return self._createSession(self.connection.fidjId);\n                })\n                .then(() => {\n                    self.connection.setConnectionOffline(options);\n                    resolve(self.connection.getUser());\n                })\n                .catch((err) => {\n                    self.logger.error('fidj.sdk.service.fidjLogin error: ', err);\n                    reject(err);\n                });\n        });\n    };\n\n    public fidjGetEndpoints(filter?: EndpointFilterInterface): Array<EndpointInterface> {\n\n        if (!filter) {\n            filter = {showBlocked: false};\n        }\n        let endpoints = JSON.parse(this.connection.getAccessPayload({endpoints: []})).endpoints;\n        if (!endpoints) {\n            return [];\n        }\n\n        endpoints = endpoints.filter((endpoint: EndpointInterface) => {\n            let ok = true;\n            if (ok && filter.key) {\n                ok = (endpoint.key === filter.key);\n            }\n            if (ok && !filter.showBlocked) {\n                ok = !endpoint.blocked;\n            }\n            return ok;\n        });\n        return endpoints;\n    };\n\n    public fidjRoles(): Array<string> {\n        return JSON.parse(this.connection.getIdPayload({roles: []})).roles;\n    };\n\n    public fidjMessage(): string {\n        return JSON.parse(this.connection.getIdPayload({message: ''})).message;\n    };\n\n    public fidjIsLogin(): boolean {\n        return this.connection.isLogin();\n    };\n\n    public fidjLogout(): Promise<void | ErrorInterface> {\n        const self = this;\n        if (!self.connection.getClient()) {\n            return self._removeAll()\n                .then(() => {\n                    return this.session.create(self.connection.fidjId, true);\n                });\n        }\n\n        return self.connection.logout()\n            .then(() => {\n                return self._removeAll();\n            })\n            .catch(() => {\n                return self._removeAll();\n            })\n            .then(() => {\n                return this.session.create(self.connection.fidjId, true);\n            });\n    };\n\n    /**\n     * Synchronize DB\n     *\n     *\n     * @param fnInitFirstData a function with db as input and that return promise: call if DB is empty\n     * @param fnInitFirstData_Arg arg to set to fnInitFirstData()\n     * @returns  promise\n     */\n    public fidjSync(fnInitFirstData?, fnInitFirstData_Arg?): Promise<void | ErrorInterface> {\n        const self = this;\n        self.logger.log('fidj.sdk.service.fidjSync');\n        // if (!self.session.isReady()) {\n        //    return self.promise.reject('fidj.sdk.service.fidjSync : DB sync impossible. Did you login ?');\n        // }\n\n        const firstSync = (self.session.dbLastSync === null);\n\n        return new self.promise((resolve, reject) => {\n\n            self._createSession(self.connection.fidjId)\n                .then(() => {\n                    return self.session.sync(self.connection.getClientId());\n                })\n                .then(() => {\n                    self.logger.log('fidj.sdk.service.fidjSync resolved');\n                    return self.session.isEmpty();\n                })\n                .catch((err) => {\n                    self.logger.warn('fidj.sdk.service.fidjSync warn: ', err);\n                    return self.session.isEmpty();\n                })\n                .then((isEmpty) => {\n                    self.logger.log('fidj.sdk.service.fidjSync isEmpty : ', isEmpty, firstSync);\n\n                    return new Promise((resolveEmpty, rejectEmptyNotUsed) => {\n                        if (isEmpty && firstSync && fnInitFirstData) {\n                            const ret = fnInitFirstData(fnInitFirstData_Arg);\n                            if (ret && ret['catch'] instanceof Function) {\n                                ret.then(resolveEmpty).catch(reject);\n                            }\n                            if (typeof ret === 'string') {\n                                self.logger.log(ret);\n                            }\n                        }\n                        resolveEmpty(); // self.connection.getUser());\n                    });\n                })\n                .then((info) => {\n                    self.logger.log('fidj.sdk.service.fidjSync fnInitFirstData resolved: ', info);\n                    self.session.dbLastSync = new Date().getTime();\n                    return self.session.info();\n                })\n                .then((result: any) => {\n                    self.session.dbRecordCount = 0;\n                    if (result && result.doc_count) {\n                        self.session.dbRecordCount = result.doc_count;\n                    }\n                    self.logger.log('fidj.sdk.service.fidjSync _dbRecordCount : ' + self.session.dbRecordCount);\n\n                    return self.connection.refreshConnection();\n                })\n                .then((user) => {\n                    resolve(); // self.connection.getUser()\n                })\n                .catch((err: ErrorInterface) => {\n                    // console.error(err);\n\n                    if (err && (err.code === 403 || err.code === 410)) {\n                        this.fidjLogout()\n                            .then(() => {\n                                reject({code: 403, reason: 'Synchronization unauthorized : need to login again.'});\n                            })\n                            .catch(() => {\n                                reject({code: 403, reason: 'Synchronization unauthorized : need to login again.'});\n                            });\n                    } else if (err && err.code) {\n                        // todo what to do with this err ?\n                        resolve();\n                    } else {\n                        const errMessage = 'Error during syncronisation: ' + err.toString();\n                        // self.logger.error(errMessage);\n                        reject({code: 500, reason: errMessage});\n                    }\n                })\n            ;\n        });\n    };\n\n    public fidjPutInDb(data: any): Promise<string | ErrorInterface> {\n        const self = this;\n        self.logger.log('fidj.sdk.service.fidjPutInDb: ', data);\n\n        if (!self.connection.getClientId() || !self.session.isReady()) {\n            return self.promise.reject(new Error(401, 'DB put impossible. Need a user logged in.'));\n        }\n\n        let _id: string;\n        if (data && typeof data === 'object' && Object.keys(data).indexOf('_id')) {\n            _id = data._id;\n        }\n        if (!_id) {\n            _id = self._generateObjectUniqueId(self.connection.fidjId);\n        }\n        let crypto: SessionCryptoInterface;\n        if (self.connection.fidjCrypto) {\n            crypto = {\n                obj: self.connection,\n                method: 'encrypt'\n            }\n        }\n\n        return self.session.put(\n            data,\n            _id,\n            self.connection.getClientId(),\n            self.sdk.org,\n            self.connection.fidjVersion,\n            crypto);\n    };\n\n    public fidjRemoveInDb(data_id: string): Promise<void | ErrorInterface> {\n        const self = this;\n        self.logger.log('fidj.sdk.service.fidjRemoveInDb ', data_id);\n\n        if (!self.session.isReady()) {\n            return self.promise.reject(new Error(401, 'DB remove impossible. ' +\n                'Need a user logged in.'));\n        }\n\n        if (!data_id || typeof data_id !== 'string') {\n            return self.promise.reject(new Error(400, 'DB remove impossible. ' +\n                'Need the data._id.'));\n        }\n\n        return self.session.remove(data_id);\n    };\n\n    public fidjFindInDb(data_id: string): Promise<any | ErrorInterface> {\n        const self = this;\n        if (!self.connection.getClientId() || !self.session.isReady()) {\n            return self.promise.reject(new Error(401, 'fidj.sdk.service.fidjFindInDb : need a user logged in.'));\n        }\n\n        let crypto: SessionCryptoInterface;\n        if (self.connection.fidjCrypto) {\n            crypto = {\n                obj: self.connection,\n                method: 'decrypt'\n            };\n        }\n\n        return self.session.get(data_id, crypto);\n    };\n\n    public fidjFindAllInDb(): Promise<Array<any> | ErrorInterface> {\n        const self = this;\n\n        if (!self.connection.getClientId() || !self.session.isReady()) {\n            return self.promise.reject(new Error(401, 'Need a user logged in.'));\n        }\n\n        let crypto: SessionCryptoInterface;\n        if (self.connection.fidjCrypto) {\n            crypto = {\n                obj: self.connection,\n                method: 'decrypt'\n            };\n        }\n\n        return self.session.getAll(crypto)\n            .then(results => {\n                self.connection.setCryptoSaltAsVerified();\n                return self.promise.resolve((results as Array<any>));\n            });\n    };\n\n    public fidjPostOnEndpoint(key: string, data?: any): Promise<any | ErrorInterface> {\n        const filter: EndpointFilterInterface = {\n            key: key\n        };\n        const endpoints = this.fidjGetEndpoints(filter);\n        if (!endpoints || endpoints.length !== 1) {\n            return this.promise.reject(\n                new Error(400,\n                    'fidj.sdk.service.fidjPostOnEndpoint : endpoint does not exist.'));\n        }\n\n        const endpointUrl = endpoints[0].url;\n        const jwt = this.connection.getIdToken();\n        return new Ajax()\n            .post({\n                url: endpointUrl,\n                // not used : withCredentials: true,\n                headers: {\n                    'Content-Type': 'application/json',\n                    'Accept': 'application/json',\n                    'Authorization': 'Bearer ' + jwt\n                },\n                data: data\n            });\n    };\n\n    public fidjGetIdToken(): string {\n        return this.connection.getIdToken();\n    };\n\n    // Internal functions\n\n    /**\n     * Logout then Login\n     *\n     * @param login\n     * @param password\n     * @param updateProperties\n     */\n    private _loginInternal(login: string, password: string, updateProperties?: any): Promise<any | ErrorInterface> {\n        const self = this;\n        self.logger.log('fidj.sdk.service._loginInternal');\n        if (!self.connection.isReady()) {\n            return self.promise.reject(new Error(403, 'Need an intialized FidjService'));\n        }\n\n        return new self.promise((resolve, reject) => {\n\n                self.connection.logout()\n                    .then(() => {\n                        return self.connection.getClient().login(login, password, updateProperties);\n                    })\n                    .catch((err) => {\n                        return self.connection.getClient().login(login, password, updateProperties);\n                    })\n                    .then(loginUser => {\n                        loginUser.email = login;\n                        resolve(loginUser);\n                    })\n                    .catch(err => {\n                        self.logger.error('fidj.sdk.service._loginInternal error : ' + err);\n                        reject(err);\n                    });\n            }\n        );\n    };\n\n    protected _removeAll(): Promise<void | ErrorInterface> {\n        this.connection.destroy();\n        return this.session.destroy();\n    };\n\n    private _createSession(uid: string): Promise<void | ErrorInterface> {\n        this.session.setRemote(this.connection.getDBs({filter: 'theBestOnes'}));\n        return this.session.create(uid);\n    };\n\n    private _testPromise(a?): Promise<any> {\n        if (a) {\n            return this.promise.resolve('test promise ok ' + a);\n        }\n        return new this.promise((resolve, reject) => {\n            resolve('test promise ok');\n        });\n    };\n\n    private static _srvDataUniqId = 0;\n\n    private _generateObjectUniqueId(appName, type?, name?) {\n\n        // return null;\n        const now = new Date();\n        const simpleDate = '' + now.getFullYear() + '' + now.getMonth() + '' + now.getDate()\n            + '' + now.getHours() + '' + now.getMinutes(); // new Date().toISOString();\n        const sequId = ++InternalService._srvDataUniqId;\n        let UId = '';\n        if (appName && appName.charAt(0)) {\n            UId += appName.charAt(0) + '';\n        }\n        if (type && type.length > 3) {\n            UId += type.substring(0, 4);\n        }\n        if (name && name.length > 3) {\n            UId += name.substring(0, 4);\n        }\n        UId += simpleDate + '' + sequId;\n        return UId;\n    }\n\n}\n","import {Injectable} from '@angular/core';\nimport {\n    LoggerInterface, ModuleServiceInterface, ModuleServiceInitOptionsInterface, ModuleServiceLoginOptionsInterface,\n    ErrorInterface, EndpointInterface\n} from './interfaces';\nimport {InternalService} from './internal.service';\nimport {Error as FidjError} from '../connection';\n\n/**\n * Angular2+ FidjService\n * @see ModuleServiceInterface\n *\n * @exemple\n *      // ... after install :\n *      // $ npm install --save-dev fidj\n *      // then init your app.js & use it in your services\n *\n * <script src=\"https://gist.githubusercontent.com/mlefree/ad64f7f6a345856f6bf45fd59ca8db46/raw/5fff69dd9c15f692a856db62cf334b724ef3f4ac/angular.fidj.inject.js\"></script>\n *\n * <script src=\"https://gist.githubusercontent.com/mlefree/ad64f7f6a345856f6bf45fd59ca8db46/raw/5fff69dd9c15f692a856db62cf334b724ef3f4ac/angular.fidj.sync.js\"></script>\n *\n *\n */\n@Injectable()\nexport class FidjService implements ModuleServiceInterface {\n\n    private logger: LoggerInterface;\n    private fidjService: InternalService;\n    private promise: any;\n\n    constructor() {\n        this.logger = new LoggerService();\n        this.promise = Promise;\n        this.fidjService = null;\n        // let pouchdbRequired = PouchDB;\n        // pouchdbRequired.error();\n    };\n\n    public init(fidjId, options?: ModuleServiceInitOptionsInterface): Promise<void | ErrorInterface> {\n        if (!this.fidjService) {\n            this.fidjService = new InternalService(this.logger, this.promise);\n        }\n        /*\n        if (options && options.forcedEndpoint) {\n            this.fidjService.setAuthEndpoint(options.forcedEndpoint);\n        }\n        if (options && options.forcedDBEndpoint) {\n            this.fidjService.setDBEndpoint(options.forcedDBEndpoint);\n        }*/\n        return this.fidjService.fidjInit(fidjId, options);\n    };\n\n    public login(login, password): Promise<any | ErrorInterface> {\n        if (!this.fidjService) {\n            return this.promise.reject(new FidjError(303, 'fidj.sdk.angular2.login : not initialized.'));\n        }\n        return this.fidjService.fidjLogin(login, password);\n    };\n\n    public loginAsDemo(options?: ModuleServiceLoginOptionsInterface): Promise<any | ErrorInterface> {\n        if (!this.fidjService) {\n            return this.promise.reject(new FidjError(303, 'fidj.sdk.angular2.loginAsDemo : not initialized.'));\n        }\n        return this.fidjService.fidjLoginInDemoMode(options);\n    };\n\n    public isLoggedIn(): boolean {\n        if (!this.fidjService) {\n            return false; // this.promise.reject('fidj.sdk.angular2.isLoggedIn : not initialized.');\n        }\n        return this.fidjService.fidjIsLogin();\n    };\n\n    public getRoles(): Array<string> {\n        if (!this.fidjService) {\n            return [];\n        }\n        return this.fidjService.fidjRoles();\n    };\n\n    public getEndpoints(): Array<EndpointInterface> {\n        if (!this.fidjService) {\n            return [];\n        }\n        return this.fidjService.fidjGetEndpoints();\n    };\n\n    public postOnEndpoint(key: string, data: any): Promise<any | ErrorInterface> {\n        if (!this.fidjService) {\n            return this.promise.reject(new FidjError(303, 'fidj.sdk.angular2.loginAsDemo : not initialized.'));\n        }\n        return this.fidjService.fidjPostOnEndpoint(key, data);\n    };\n\n    public getIdToken(): string {\n        if (!this.fidjService) {\n            return;\n        }\n        return this.fidjService.fidjGetIdToken();\n    };\n\n    public getMessage(): string {\n        if (!this.fidjService) {\n            return '';\n        }\n        return this.fidjService.fidjMessage();\n    };\n\n    public logout(): Promise<void | ErrorInterface> {\n        if (!this.fidjService) {\n            return this.promise.reject(new FidjError(303, 'fidj.sdk.angular2.logout : not initialized.'));\n        }\n        return this.fidjService.fidjLogout();\n    };\n\n    /**\n     *\n     * Synchronize DB\n     * @param fnInitFirstData  a function with db as input and that return promise: call if DB is empty\n     * @returns promise with this.session.db\n     * @memberof fidj.angularService\n     *\n     * @example\n     *  let initDb = function() {\n     *     this.fidjService.put('my first row');\n     *  };\n     *  this.fidjService.sync(initDb)\n     *  .then(user => ...)\n     *  .catch(err => ...)\n     *\n     */\n    public sync(fnInitFirstData?): Promise<void | ErrorInterface> {\n        if (!this.fidjService) {\n            return this.promise.reject(new FidjError(401, 'fidj.sdk.angular2.sync : not initialized.'));\n        }\n        return this.fidjService.fidjSync(fnInitFirstData, this);\n    };\n\n    /**\n     * Store data in your session\n     *\n     * @param data to store\n     * @returns\n     */\n    public put(data: any): Promise<string | ErrorInterface> {\n        if (!this.fidjService) {\n            return this.promise.reject(new FidjError(401, 'fidj.sdk.angular2.put : not initialized.'));\n        }\n        return this.fidjService.fidjPutInDb(data);\n    };\n\n    /**\n     * Find object Id and remove it from your session\n     *\n     * @param id of object to find and remove\n     * @returns\n     */\n    public remove(id: string): Promise<void | ErrorInterface> {\n        if (!this.fidjService) {\n            return this.promise.reject(new FidjError(401, 'fidj.sdk.angular2.remove : not initialized.'));\n        }\n        return this.fidjService.fidjRemoveInDb(id);\n    };\n\n    /**\n     * Find\n     */\n    public find(id: string): Promise<any | ErrorInterface> {\n        if (!this.fidjService) {\n            return this.promise.reject(new FidjError(401, 'fidj.sdk.angular2.find : not initialized.'));\n        }\n        return this.fidjService.fidjFindInDb(id);\n    };\n\n    public findAll(): Promise<any[] | ErrorInterface> {\n        if (!this.fidjService) {\n            return this.promise.reject(new FidjError(401, 'fidj.sdk.angular2.findAll : not initialized.'));\n        }\n        return this.fidjService.fidjFindAllInDb();\n    };\n\n}\n\nexport class LoggerService implements LoggerInterface {\n    log(message: string) {\n        // console.log(message);\n    }\n\n    error(message: string) {\n        console.error(message);\n    }\n\n    warn(message: string) {\n        console.warn(message);\n    }\n}\n\n","import {ModuleWithProviders, NgModule} from '@angular/core';\nimport {CommonModule} from '@angular/common';\nimport {FidjService} from './angular.service';\n\n\n/**\n * `NgModule` which provides associated services.\n *\n * ...\n *\n * @stable\n */\n@NgModule({\n    imports: [\n        CommonModule\n    ],\n    declarations: [],\n\n    exports: [],\n\n    providers: [FidjService]\n})\nexport class FidjModule {\n    constructor() {\n    }\n}\n\n\n/**\n * module FidjModule\n *\n * exemple\n *      // ... after install :\n *      // $ npm install fidj\n *      // then init your app.js & use it in your services\n *\n * <script src=\"https://gist.github.com/mlefree/ad64f7f6a345856f6bf45fd59ca8db46.js\"></script>\n *\n * <script src=\"https://gist.github.com/mlefree/ad64f7f6a345856f6bf45fd59ca8db46.js\"></script>\n */\n"],"names":["Error","version.version","tools.LocalStorage","session.Session","connection.Connection","connection.Client","tools.Base64","FidjError","Injectable","NgModule","CommonModule"],"mappings":"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"}
